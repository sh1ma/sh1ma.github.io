<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=UTF-8" http-equiv="content-type"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="format-detection" content="telephone=no"/>

    <title>Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢ - lilyum ensemble</title>
    <meta itemprop="name" content="Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢ - lilyum ensemble"/>
    <meta name="keywords" content="Lua"/>
    <meta name="thumbnail" content="https://nymphium.github.io/pictures/github_icon.png"/>
    <meta itemprop="image" content="https://nymphium.github.io/pictures/github_icon.png"/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="lilyum ensemble"/>
    <meta name="twitter:title" content="Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢ - lilyum ensemble"/>
    <meta name="twitter:url" content="https://nymphium.github.io/2016/06/17/luaexpression.html"/> 
    <meta name="twitter:text:description" content="ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡æ¥µã‚ã¦çœ ã„ãƒ›ãƒˆãƒˆã‚®ã‚¹1. ã¯ã˜ã‚ã«Lua5.2ã®VMã®ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ç‰©ä½“ã‚’ç”¨ã„ã¦ï½¤Lua5.3ã®VMã®ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ãŸã‚‰çµæ§‹ã¤ã¾ã¥ãã¾..."/>
    <meta name="twitter:image:src" content="https://nymphium.github.io/pictures/github_icon.png"/>

    <link rel="icon" type="image/x-icon" href="/favicon.ico"/>
    <link rel="stylesheet" href="/css/main.css"/>
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="https://nymphium.github.io/feed.xml"/>
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:300%7CDroid+Sans+Mono%7CCrimson+Text:400,400i" rel="stylesheet"/>
<!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢" />
<meta name="author" content="Satoru Kawahara" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡æ¥µã‚ã¦çœ ã„ãƒ›ãƒˆãƒˆã‚®ã‚¹" />
<meta property="og:description" content="ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡æ¥µã‚ã¦çœ ã„ãƒ›ãƒˆãƒˆã‚®ã‚¹" />
<link rel="canonical" href="https://nymphium.github.io/2016/06/17/luaexpression.html" />
<meta property="og:url" content="https://nymphium.github.io/2016/06/17/luaexpression.html" />
<meta property="og:site_name" content="lilyum ensemble" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-06-17T00:00:00+09:00" />
<script type="application/ld+json">
{"description":"ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡æ¥µã‚ã¦çœ ã„ãƒ›ãƒˆãƒˆã‚®ã‚¹","@type":"BlogPosting","headline":"Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢","dateModified":"2016-06-17T00:00:00+09:00","datePublished":"2016-06-17T00:00:00+09:00","url":"https://nymphium.github.io/2016/06/17/luaexpression.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://nymphium.github.io/2016/06/17/luaexpression.html"},"author":{"@type":"Person","name":"Satoru Kawahara"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta property="og:image" content="https://nymphium.github.io/pictures/github_icon.png"/>
  </head>

  <body>
    <header class="site-header">
      <div class="wrapper" style="font-family: 'Comfortaa';">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/aboutme.html">About</a>
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">Lua5.2ã‹ã‚‰5.3ã¸ã®å†…éƒ¨è¡¨ç¾ã«ã¤ã„ã¦ğŸ’¢</h1>
            <span class="post-meta">
              <time datetime="2016-06-17T00:00:00+09:00" itemprop="datePublished">Jun 17, 2016</time>
              <p>tag: {<a href="/tags.html#Lua-ref">Lua</a>}</p>
            </span>
            <script type="text/javascript" src="/js/GithubRepoWidget.min.js"></script>
            <script type="text/javascript">setTimeout(GithubRepoWidget.init, 3000);</script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
            <!-- The loading of KaTeX is deferred to speed up page rendering -->
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js" integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous"></script>
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js" integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
<p>ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡æ¥µã‚ã¦çœ ã„ãƒ›ãƒˆãƒˆã‚®ã‚¹</p>
<h1 id="1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><a class="headerlink" href="#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">1. ã¯ã˜ã‚ã«</a></h1>
<p>Lua5.2ã®VMã®ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ç‰©ä½“ã‚’ç”¨ã„ã¦ï½¤Lua5.3ã®VMã®ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨ã—ãŸã‚‰çµæ§‹ã¤ã¾ã¥ãã¾ã—ãŸï½¡ã¨ã„ã†è©±ï½¡
Luaã¯ã‚ã‚Šã¨ï½¤é–¢æ•°ãŒæ¸›ã£ãŸã å¢—ãˆãŸã ç¨‹åº¦ã®å¤‰æ›´ã—ã‹ç„¡ãï½¤äº’æ›æ€§ã¯é«˜ã„ã‹ã®ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒï½¤å†…éƒ¨ã§ã¯ã‚¬ãƒƒãƒ„ãƒªå¤‰ã‚ã£ã¦ã‚‹ã‚“ã§ã™ã­ã‡ã“ã“2ãƒ¶æœˆã§æ€ã„çŸ¥ã‚‰ã•ã‚Œã¾ã—ãŸï½¡</p>
<h1 id="2.+internal+constant+expression"><a class="headerlink" href="#2.+internal+constant+expression">2. internal constant expression</a></h1>
<p>luaãƒ•ã‚¡ã‚¤ãƒ«ã‚’<code>luac</code>ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨<em>luac.out</em>ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¾—ã‚‰ã‚Œã¾ã™ï½¡</p>
<p>ã¨ã“ã‚ã§<code>"hoge"</code>ã¨ã‹<code>3</code>ãªã©ã®å®šæ•°ã¯luac.outã®function blockã®constants listã¨ã„ã†éƒ¨åˆ†ã«ï½¤ã‚³ãƒ¼ãƒ‰ä¸­ã§ã®å‡ºç¾é †ã«æ ¼ç´ã•ã‚Œã¾ã™ï½¡
ã‚‚ã†å°‘ã—è§£èª¬ã™ã‚‹ã¨ï½¤constants listã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã£ã¦ã„ã‚‹ï½¡</p>
<p>\[
[æ ¼ç´ã•ã‚Œã¦ã„ã‚‹å®šæ•°ã®æ•°(4\mathsf{byte})][å®šæ•°[ç¨®é¡(1\mathsf{byte}) ç¨®é¡åˆ¥(n\ \mathsf{byte})]â€¦]
\]</p>
<p>ã“ã®ç¨®é¡ãŒã‚¯ã‚»ãƒ¢ãƒãªã‚“ã§ã™ã­ã‡â€¦ï½¡</p>
<h1 id="3.+%E5%9E%8B%E3%81%8C%E5%A2%97%E3%81%88%E3%81%9F%3F+integer%2C+long+string"><a class="headerlink" href="#3.+%E5%9E%8B%E3%81%8C%E5%A2%97%E3%81%88%E3%81%9F%3F+integer%2C+long+string">3. å‹ãŒå¢—ãˆãŸ? integer, long string</a></h1>
<p>ã¾ãšã“ã®ç¨®é¡ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã™ï½¡constants listã«ç¾ã‚Œã‚‹ç¨®é¡ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï½¡</p>
<table>
<thead>
<tr>
<th style="text-align: left">type</th>
<th style="text-align: right">value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">nil</td>
<td style="text-align: right">00</td>
</tr>
<tr>
<td style="text-align: left">bool</td>
<td style="text-align: right">01</td>
</tr>
<tr>
<td style="text-align: left">number</td>
<td style="text-align: right">03</td>
</tr>
<tr>
<td style="text-align: left">string</td>
<td style="text-align: right">04</td>
</tr>
</tbody>
</table>
<p>æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’è€ƒãˆã‚‹ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="c1">-- hoge.lua</span>
<span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"aaaaaaaa...aaaa"</span> <span class="c1">-- 256æ–‡å­—ä»¥ä¸Šã§é©å½“ã«ï½¤ã“ã“ã§ã¯256æ–‡å­—ã¨ã™ã‚‹</span>
<span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">0</span>
<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">4</span>
</code></pre></div>
<h2 id="3-1.+until+Lua+5.2"><a class="headerlink" href="#3-1.+until+Lua+5.2">3-1. until Lua 5.2</a></h2>
<p>ã¾ãšLua5.2ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã¿ã‚‹ï½¡</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ luac5.2  hoge.lua
$ xxd -g 1 luac.out
00000000: 1b 4c 75 61 52 00 01 04 08 04 08 00 19 93 0d 0a  .LuaR...........
00000010: 1a 0a 00 00 00 00 00 00 00 00 00 01 03 04 00 00  ................
00000020: 00 01 00 00 00 41 40 00 00 81 80 00 00 1f 00 80  .....A@.........
00000030: 00 03 00 00 00 04 01 01 00 00 00 00 00 00 61 61  ..............aa
00000040: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61  aaaaaaaaaaaaaaaa
......
00000130: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 00 03  aaaaaaaaaaaaaa..
00000140: 00 00 00 00 00 00 08 40 03 00 00 00 00 00 00 10  .......@........
00000150: 40 00 00 00 00 01 00 00 00 01 00 0a 00 00 00 00  @...............
......
</code></pre></div>
<p>ãƒ˜ãƒƒãƒ€ãŒã‚ã‚Šï½¤(ä¸­ç•¥)ï½¤0x00000031ã‹ã‚‰constants listã§ã™ï½¡
ã¡ãªã¿ã«ãƒ˜ãƒƒãƒ€ã‹ã‚‰ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã®ã§ï½¤æœ€åˆã®<code>03 00 00 00</code>ã¯ã¤ã¾ã‚Š"3"ï½¤å®šæ•°ã®æ•°ã§ã™ï½¡ä¸€è‡´ã—ã¦ã„ã¾ã™ã­ï½¡</p>
<p>æ¬¡ã«å®šæ•°ãŒ3ã¤å‡ºç¾é †ã«è¦‹ãˆã¾ã™ã¯ã„ï½¡ã“ã“ã‹ã‚‰æœ¬é¡Œãªã‚“ã‚„ãªï½¡</p>
<h3 id="3-1-1.+string+%3Ccode%3Ea%3C%2Fcode%3E%0A"><a class="headerlink" href="#3-1-1.+string+%3Ccode%3Ea%3C%2Fcode%3E%0A">3-1-1. string <code>a</code>
</a></h3>
<p>ã¾ãš1byteï½¤ç¨®é¡ãŒã¿ãˆã¦ãã‚‹ã‚ã‘ã§ã™ãŒ<code>04</code>ã¨ã„ã†ã“ã¨ã¯ã¤ã¾ã‚Šstringï½¤ã“ã‚Œã¯ã¤ã¾ã‚Šå¤‰æ•°<code>a</code>ã«æ ¼ç´ã•ã‚Œã‚‹å®šæ•°<code>"aaaaaa....aa"</code>ã§ã™ã­ï½¡
æ¬¡ã®8byteã¯å®Ÿã¯æ–‡å­—åˆ—ã®é•·ã•ãªã‚“ã§ã™ã­ã‡ï½¤ã¯ã„ï½¡<code>01 01 00 00 00 00 00 00</code>ã¨ã„ã†ã“ã¨ã§ï½¤ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§è§£é‡ˆã™ã‚‹ã¨257æ–‡å­—ã§ã™ã‹ï½¤ã“ã®+1ã¯<code>\0</code>ã§ã™ã­ã‚ã‹ã‚Šã¾ã™ï½¡
ã•ã¦257byteã¿ã¦ã„ãã¨ï½¤ãŸã—ã‹ã«0x61ãŒ256å€‹ä¸¦ã‚“ã§æœ€å¾Œã«0x00ãŒã‚ã‚Šã¾ã™ï½¡ã„ã„ã§ã™ã­ï½¡ã“ã“ã¾ã§ã§0x0000013eã¾ã§èª­ã¿ã¾ã—ãŸï½¡</p>
<h3 id="3-1-2.+number+%3Ccode%3Eb%3C%2Fcode%3E%2C+%3Ccode%3Ec%3C%2Fcode%3E%0A"><a class="headerlink" href="#3-1-2.+number+%3Ccode%3Eb%3C%2Fcode%3E%2C+%3Ccode%3Ec%3C%2Fcode%3E%0A">3-1-2. number <code>b</code>, <code>c</code>
</a></h3>
<p>ã•ã¦ç¶šãã¾ã—ã¦1byteè¦‹ã‚‹ã¨<code>03</code>ã¨ã„ã†ã“ã¨ã§ï½¤numberã§ã™ã‹ï½¡8byteèª­ã‚“ã§ã¿ã¦ãã ã•ã„ï½¡ã¯ã„<code>00 00 00 00 00 00 08 40</code>ã¨ã„ã†ã“ã¨ã§ã™ãŒã¾ãšã“ã‚Œã‚’IEEE 754 å˜ç²¾åº¦æµ®å‹•å°æ•°ç‚¹æ•°ã«ã™ã‚‹ã‚“ã‚„ãªâ€¦ï½¡
ã§ã¯ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">decodenum</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">mantissa</span> <span class="o">=</span> <span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">byte</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">%</span> <span class="mi">16</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
    <span class="n">mantissa</span> <span class="o">=</span> <span class="n">mantissa</span> <span class="o">*</span> <span class="p">(</span><span class="mi">256</span> <span class="o">+</span> <span class="n">input</span><span class="p">:</span><span class="n">byte</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
  <span class="k">end</span>

  <span class="kd">local</span> <span class="n">exponent</span> <span class="o">=</span> <span class="p">((</span><span class="n">input</span><span class="p">:</span><span class="n">byte</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">%</span> <span class="mi">128</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">byte</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">//</span> <span class="mi">16</span>

  <span class="k">if</span> <span class="n">exponent</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">then</span>
    <span class="k">return</span> <span class="mi">0</span>
  <span class="k">end</span>

  <span class="n">mantissa</span> <span class="o">=</span> <span class="p">(</span><span class="nb">math.ldexp</span><span class="p">(</span><span class="n">mantissa</span><span class="p">,</span> <span class="o">-</span><span class="mi">52</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">input</span><span class="p">:</span><span class="n">byte</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">127</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>

  <span class="k">return</span> <span class="nb">math.ldexp</span><span class="p">(</span><span class="n">mantissa</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">-</span> <span class="mi">1023</span><span class="p">)</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="n">ieee754</span> <span class="o">=</span> <span class="nb">string.char</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">decodenum</span><span class="p">(</span><span class="n">ieee754</span><span class="p">))</span> <span class="c1">--&gt; 3.0</span>
</code></pre></div>
<p>ã¯ã„ï½¤<code>3.0</code>ã¨ã„ã†ã“ã¨ã§ï½¤<code>b</code>ã§ã™ã­ï½¡OKï½¡0x00000147ã¾ã§èª­ã¿ã¾ã—ãŸï½¡</p>
<p>åŒæ§˜ã«ã—ã¦æ¬¡ã¯<code>4.0</code>ã§ã™ã­ã¯ã„è«–ç ´</p>
<h2 id="3-2.+Lua+5.3"><a class="headerlink" href="#3-2.+Lua+5.3">3-2. Lua 5.3</a></h2>
<p>ã„ã‚„ã„ã‚„å†…éƒ¨è¡¨ç¾å¤‰ã‚ã‚‰ã‚“ã§ã—ã‚‡â†’æ­»</p>
<p>ã§ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã¿ã‚‹ï½¡</p>
<div class="highlight"><pre><code class="language-" data-lang="">$ luac5.3 hoge.lua
$ xxd -g 1 luac.out
00000000: 1b 4c 75 61 53 00 19 93 0d 0a 1a 0a 04 08 04 08  .LuaS...........
00000010: 08 78 56 00 00 00 00 00 00 00 00 00 00 00 28 77  .xV...........(w
00000020: 40 01 0a 40 68 6f 67 65 2e 6c 75 61 00 00 00 00  @..@hoge.lua....
00000030: 00 00 00 00 00 02 03 04 00 00 00 01 00 00 00 41  ...............A
00000040: 40 00 00 81 80 00 00 26 00 80 00 03 00 00 00 14  @......&amp;........
00000050: ff 01 01 00 00 00 00 00 00 61 61 61 61 61 61 61  .........aaaaaaa
00000060: 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61 61  aaaaaaaaaaaaaaaa
......
00000150: 61 61 61 61 61 61 61 61 61 03 00 00 00 00 00 00  aaaaaaaaa.......
00000160: 08 40 13 04 00 00 00 00 00 00 00 01 00 00 00 01  .@..............
......
</code></pre></div>
<p>ã‚¦ãƒ¼ãƒ³ï½¤ãã†ã§ã™ã‹â€¦ï½¡0x0000004bã‹ã‚‰constants listãŒå§‹ã¾ã‚Šï½¤<code>03 00 00 00</code>ã‹ã‚‰constantã¯3ã¤ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹ã‚“ã§ã™ãŒâ€¦ï½¡</p>
<h3 id="3-2-1.+long+string+%E2%86%90%E3%81%AF%3F"><a class="headerlink" href="#3-2-1.+long+string+%E2%86%90%E3%81%AF%3F">3-2-1. long string â†ã¯?</a></h3>
<p>1byteèª­ã¿ã™ã™ã‚ã‚‹ã¨æ—©é€Ÿ0x14ã¨ã„ã†è¬ã®ç¨®é¡ãŒçˆ†èª•ã™ã‚‹ã‚“ã§ã™ã­ã‡å®Ÿã¯ã‚³ãƒ¬Lua5.3ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸlong stringã§ã™ãŒå†…éƒ¨è¡¨ç¾ã®ã¿ã«ç¾ã‚Œã‚‹ã®ã§çš†ã•ã‚“å®‰å¿ƒã—ã¦ãã ã•ã„ï½¡</p>
<p>ã•ã‚‰ã«é€²ã‚ã¦ã¿ã‚‹ã¨<code>ff 01 01 00 00 00 00 00 00 61 61 61 61 61 ......</code>ã¨ã„ã†ã‚ˆãã‚ã‹ã‚‰ãªã„æ„Ÿã˜ã«ãªã£ã¦ã¾ã™ã­ï½¡
0x61ã¯'a'ã ã¨ã„ã†ã®ã¯ã‚ã‹ã‚‹ï½¡ãã®å‰ã®<code>ff 01 01 00 00 00 00 00 00</code>ã¯ãŠãã‚‰ãæ–‡å­—åˆ—ã®é•·ã•ãªã‚“ã§ã™ãŒï½¤ãªã‚“ã ã“ã‚Œã¯ï½¡
256æ–‡å­—ãªã®ã§ï½¤0x0100ã‹â€™\0'ã‚’è¿½åŠ ã—ãŸ0x0101ã¨ã„ã†è¡¨ç¾ãŒã©ã“ã‹ã«ã‚ã‚‹ã¯ãšã§ï½¤ã‚ã‚Šã¾ã™ã­ <code>01 01 00 00 00 00 00 00</code>ï½¡
é ­ã®<code>ff</code>ã¯å¤‰ã‚ã‚‰ãªã„ã‚“ã§ï½¤<code>14 ff</code>ãŒobject typeã ã¨æ€ã£ã¦ã„ã„ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ï½¡
ã§ï½¤0x100æ–‡å­—ã§<code>a</code>ãŒå‡ºåœŸã—ãŸã¨ï½¡ãƒã‚¤ãƒ³ãƒˆã¯ï½¤â€™\0'ã¯ã„ã‚‰ãªããªã£ãŸã®ã§<code>0x101 - 1</code> ã§ã™ã­ï½¡</p>
<p>ãƒã‚¿ãƒãƒ¬ã‚’ã„ã†ã¨ï½¤255æ–‡å­—ä»¥ä¸‹ã¯Lua 5.2ã¾ã§ã¨åŒã˜ã§ã™ï½¡0xffæ–‡å­—ä»¥ä¸‹ã¨ãã‚Œã‚ˆã‚Šä¸Šã‚’åˆ¥ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã™ã‚‹ã“ã¨ã§ï½¤ä½•ã‹è‰¯ã„ã“ã¨ãŒã‚ã‚‹ã‚“ã§ã™ã‹ã­ã‡è¬ï½¡</p>
<h3 id="3-2-2.+integer+%E2%86%90%E3%81%AF%3F"><a class="headerlink" href="#3-2-2.+integer+%E2%86%90%E3%81%AF%3F">3-2-2. integer â†ã¯?</a></h3>
<p>ã¾ããˆãˆã‚ï½¡æ¬¡ã¯<code>b</code>ã§ã™ã­ã€œãƒã‚¤ãƒã‚¤åŒã˜æ„Ÿã˜ã§<code>03 00 00 00 00 00 00 08 40</code>ã§ã™ã­çµ‚ã‚ã‚Šï½¡ã“ã®æ™‚ç‚¹ã§0x00000161ã¾ã§èª­ã¿ã¾ã—ãŸï½¡</p>
<p>æ¬¡ã«<code>13</code>ã¨ã„ã†ã®ãŒæ¥ã¦ï½¤æ°‘è¡†ã¯å›°æƒ‘ã™ã‚‹ã‚“ã§ã™ã­ã‡â€¦ï½¡ã¨æ€ã£ãŸã‘ã©ã˜ã¤ã¯ã ã„ã¶ç´ ç›´ã§ï½¤8byteèª­ã‚“ã§ã¿ã‚‹ã¨<code>04 00 00 00 00 00 00 00</code>ã§ã“ã‚Œã¯ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã§èª­ã‚€ã¨ãŸã¡ã©ã“ã‚ã«<code>4</code>ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã—ã¾ã†ï½¡</p>
<p><em>ã¾ã•ã«integerã£ã¦æ„Ÿã˜ã§ã™ã­!</em> Lua 5.3ã‹ã‚‰bitwise operation(<code>&amp;</code>, <code>|</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>bit32</code>ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«)ãŒè¿½åŠ ã•ã‚ŒãŸã®ã§ï½¤ã“ã‚Œã‚’é€Ÿãå‹•ã‹ã—ãŸã„ã¨ã„ã†ç‹™ã„ãªã®ã‹ã‚‚ã—ã‚Œãªã„ï½¡ã¡ãªã¿ã«signed integerãªã®ã§0x7fffffffffffffff(16æ¡)ãŒINT_MAXãƒƒã‚·ãƒ¥</p>
<h3 id="3-2-3.+Lua+5.3%E3%81%A7%E3%81%AE%E5%86%85%E9%83%A8%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%A8%AE%E9%A1%9E"><a class="headerlink" href="#3-2-3.+Lua+5.3%E3%81%A7%E3%81%AE%E5%86%85%E9%83%A8%E3%81%AE%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E7%A8%AE%E9%A1%9E">3-2-3. Lua 5.3ã§ã®å†…éƒ¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç¨®é¡</a></h3>
<p>ã¤ã¾ã‚Šã“ã†ï½¡</p>
<table>
<thead>
<tr>
<th style="text-align: left">type</th>
<th style="text-align: right">value</th>
<th style="text-align: left">å‚™è€ƒ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">nil</td>
<td style="text-align: right">00</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">bool</td>
<td style="text-align: right">01</td>
<td style="text-align: left"></td>
</tr>
<tr>
<td style="text-align: left">number</td>
<td style="text-align: right">03</td>
<td style="text-align: left">64bit float</td>
</tr>
<tr>
<td style="text-align: left">integer</td>
<td style="text-align: right">13</td>
<td style="text-align: left">64bit signed int</td>
</tr>
<tr>
<td style="text-align: left">string</td>
<td style="text-align: right">04</td>
<td style="text-align: left">é•·ã•255ä»¥ä¸‹ã®æ–‡å­—åˆ—</td>
</tr>
<tr>
<td style="text-align: left">long string</td>
<td style="text-align: right">14</td>
<td style="text-align: left">é•·ã•256ä»¥ä¸Šã®æ–‡å­—åˆ—</td>
</tr>
</tbody>
</table>
<p>nilã¨boolã£ã¦ã•ãâ€¦<code>LOADNIL</code>å‘½ä»¤ã¨<code>LOADBOOL</code>å‘½ä»¤ãŒã‚ã‚‹ã‚“ã ã‹ã‚‰å®šæ•°ã¨ã—ã¦ãªã‚“ã¦ã„ã‚‰ãªã„ã‚“ã ã‚ˆãªãâ€¦ï½¡</p>
<h1 id="4.+%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83%BC%E3%82%AF"><a class="headerlink" href="#4.+%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83%BC%E3%82%AF">4. ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯</a></h1>
<p>long stringã¯ã©ã‚Œãã‚‰ã„æ´»ãã‚‹ã®ã‹ï½¤integerã¯ï½¤ãƒ•ã‚¡ã‚¤ãƒƒ</p>
<h2 id="4-1.+%E7%92%B0%E5%A2%83"><a class="headerlink" href="#4-1.+%E7%92%B0%E5%A2%83">4-1. ç’°å¢ƒ</a></h2>
<table>
<thead>
<tr>
<th style="text-align: right">key</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right">CPU</td>
<td>IntelÂ® Coreâ„¢ i5-5200U CPU @ 2.20GHz</td>
</tr>
<tr>
<td style="text-align: right">OS</td>
<td>Arch Linux 4.6.2-1-ARCH</td>
</tr>
</tbody>
</table>
<p>å‡¦ç†ç³»ã¯Lua 5.2.5ï½¤5.3.3ã‚’ä½¿ç”¨</p>
<h2 id="4-2.+Prerequirement"><a class="headerlink" href="#4-2.+Prerequirement">4-2. Prerequirement</a></h2>
<div class="highlight"><pre><code class="language-" data-lang="">$ luarocls --local install luasock
$ luarocls-5.2 --local install luasock
</code></pre></div>
<p>ã“ã‚“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="cm">--[[
testsuite.lua
]]</span>

<span class="kd">local</span> <span class="n">sock</span> <span class="o">=</span> <span class="nb">require</span><span class="s1">'socket'</span>

<span class="k">return</span> <span class="p">{</span>
  <span class="n">REP</span> <span class="o">=</span> <span class="mi">500000000</span><span class="p">,</span> <span class="c1">-- æ„Ÿè¬ã®5å„„å›ãƒ«ãƒ¼ãƒ—</span>

  <span class="c1">-- é–¢æ•°fnã®å®Ÿè¡Œæ™‚é–“ã‚’æ¸¬ã‚‹</span>
  <span class="n">get_exectime</span> <span class="o">=</span> <span class="k">function</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">gettime</span><span class="p">()</span>
    <span class="n">fn</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="n">gettime</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span>
  <span class="k">end</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="4-3.+long+string"><a class="headerlink" href="#4-3.+long+string">4-3. long string</a></h2>
<p>æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã‚’è€ƒãˆã‚‹ï½¡ãƒ¡ãƒ¢ãƒªã®ç¢ºä¿ï½¥é–‹æ”¾ã‚’è¦‹ã‚‹ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
    <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">"aaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<p>ã“ã†ã„ã†ã¨ãbashãŒä¾¿åˆ©ãªã‚“ã§ã™ã‚ˆã€œã€œ</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">for</span> <span class="o">((</span><span class="nv">i</span><span class="o">=</span>0<span class="p">;</span>i&lt;10<span class="p">;</span>i++<span class="o">))</span> <span class="o">{</span>
  lua alloc.lua<span class="p">;</span>
  <span class="nb">sleep </span>3
<span class="o">}</span> | <span class="nb">awk</span> <span class="s1">'{i+= $1}END{print i / 10.00}'</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">5.25221</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">3.72571</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">"aaaaaaaaaaaaaaaaaaaaaaaaaaa"</span> <span class="c1">-- &lt; 256</span>

  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
    <span class="n">str</span><span class="p">:</span><span class="n">upper</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">67.8894</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">68.0755</td>
</tr>
</tbody>
</table>
<p>long stringã‚’è¦‹ã‚‹ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
    <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">"aaaaaaaaaaa......aaaaa"</span> <span class="c1">-- 256æ–‡å­—</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">5.25645</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">3.72407</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">"aaaaaaaaaaa......aaaaa"</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
    <span class="n">str</span><span class="p">:</span><span class="n">upper</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">224.461</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">217.083</td>
</tr>
</tbody>
</table>
<p>ã‚ã‚“ã¾ãŠã‚‚ã‚“ãªã„ã§ã™ã­ï½¡</p>
<p>ã¨ã‚Šã‚ãˆãštableã®keyã«ã¤ã£ã“ã‚€ã‹ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">"aaaaaaaaaaa......aaaaa"</span>
    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">_</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">str</span><span class="p">]</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">13.2316</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">13.4676</td>
</tr>
</tbody>
</table>
<p>ã‚ã‚“ã¾ãŠã‚‚ã‚“ãªã„ã§ã™ã­ï½¡</p>
<h2 id="4-4.+integer%2Fnumber"><a class="headerlink" href="#4-4.+integer%2Fnumber">4-4. integer/number</a></h2>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">5.53783</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">3.91654</td>
</tr>
</tbody>
</table>
<p>ãŠã‚‚ã‚€ã‚ã«tableã®keyã«ã¤ã£ã“ã‚“ã§ã¿ã¾ã™ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span> <span class="c1">-- number</span>
    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">_</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">9.43846</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">9.59013</td>
</tr>
</tbody>
</table>
<p>ã¯ã„ï½¡</p>
<p>ã§ã¯integer vs numberã§ã¯ãƒ‰ã‚¦ã‚«ãƒŠâ€¦</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">4</span> <span class="c1">-- integer</span>
    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">_</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">9.13759</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">6.32312</td>
</tr>
</tbody>
</table>
<p>ï½²ï½²ï¾ˆï½¥</p>
<p>ã¨ã“ã‚ã§! ã¨ã“ã‚ã§ã§ã™ã‚ˆå¥¥ã•ã‚“ï½¡Lua 5.3ã«ã¯<code>math.tointeger()</code>ã¨ã„ã†é–¢æ•°ãŒè¿½åŠ ã•ã‚Œã¦ï½¤æ©Ÿèƒ½ã¯åå‰ã®é€šã‚Šã§ã™ï½¡</p>
<div class="highlight"><pre><code class="language-lua" data-lang="lua"><span class="kd">local</span> <span class="n">_ENV</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">(</span><span class="nb">require</span><span class="s1">'testsuite'</span><span class="p">,</span> <span class="p">{</span><span class="n">__index</span><span class="o">=</span><span class="n">_ENV</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">get_exectime</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">4</span><span class="p">.</span><span class="mi">0</span>
    <span class="kd">local</span> <span class="n">numi</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">tointeger</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">REP</span> <span class="k">do</span>
        <span class="kd">local</span> <span class="n">_</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">numi</span><span class="p">]</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">))</span>
</code></pre></div>
<p>ã¦ãªæ„Ÿã˜ã§numberã‹ã‚‰integerã«å¤‰æ›ã™ã‚‹ã¨ï½¤</p>
<table>
<thead>
<tr>
<th style="text-align: left">version</th>
<th style="text-align: right">time(sec)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left">5.2</td>
<td style="text-align: right">â€”</td>
</tr>
<tr>
<td style="text-align: left">5.3</td>
<td style="text-align: right">6.38205</td>
</tr>
</tbody>
</table>
<p>ã¨ã„ã†å…·åˆã§ã™ã­ï½¡</p>
<h2 id="4-5.+%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E8%A9%B3%E7%B4%B0"><a class="headerlink" href="#4-5.+%E3%81%95%E3%82%89%E3%81%AA%E3%82%8B%E8%A9%B3%E7%B4%B0">4-5. ã•ã‚‰ãªã‚‹è©³ç´°</a></h2>
<p><code>grep -rE 'LUA_(TNUMINT|TLNGSTR)' lua-5.3.3/src</code> ã—ã¦ãã ã•ã„(é£½ããŸ)ï½¡</p>
<h1 id="5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><a class="headerlink" href="#5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">5. ãŠã‚ã‚Šã«</a></h1>
<p>stringã¯ä½•ã‚‚å¤‰ã‚ã‚‰ãªãã¦ã¤ã¾ã‚‰ãªã„æ„Ÿã˜ã§ã—ãŸãŒï½¤integerå‹ã¯tableã®indexingã§ãã“ãã“ã®æ€§èƒ½ãŒã‚ã‚Šã¾ã™ã­ï½¡
ãƒœã‚¯ã¯bytecodeã®è§£ææ™‚ã«Lua 5.2ã®ãƒãƒªã§5.3ã‚’ã‚„ã£ãŸã‚‰çªç„¶ã®ç¨®é¡è¿½åŠ ã«ã¤ã¾ã¥ã„ãŸã®ã§ï½¤ã¿ãªã•ã‚“ã‚‚ã¤ã¾ã¥ã„ã¦ãã ã•ã„ï½¡</p>
<hr>
<p>ã“ã®ã‚µã‚¤ãƒˆã®CSSã‚„ã‚‰ä½•ã‚„ã‚‰ã‚’ã„ã˜ã£ã¦å¯æ„›ã„æ„Ÿã˜ã«ãªã£ãŸã®ã§ï½¤å¯æ„›ã„æ°—æŒã¡ã«ãªã£ã¦ãã ã•ã„ï½¡</p>
          </div>
        </article>

      </div>
    </div>
    <footer>
      <div class="pagination btn-group" style="text-align: center; font-family: 'Comfortaa';">
        <a class="btn prev" href="/2016/06/11/%E4%BB%8A%E6%97%A5%E3%81%AFSB69%E3%81%AE%E6%97%A5.html" title="ä»Šæ—¥ã¯SB69ã®æ—¥">â† Prev</a>
        /<a class="btn" href="/">Top</a>/
        <a class="btn next" href="/2016/06/26/RAID0%E3%81%AAF2FS%E3%81%ABArch%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B.html" title="RAID0ãªF2FSã«Archã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹">Next â†’</a>
      </div>
    </footer>

  </body>
</html>
