<!DOCTYPE html>
<html>
  <head>
    <title>うわ〜ん変わっちゃった〜〜! kindleのフォントが変わっちゃった〜! どうか､しましたか? kindleのフォントが変わってしまったのですが…｡ &#47; lilyum ensemble</title>
    <meta content="text/html;charset=UTF-8" http-equiv="content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Satoru Kawahara">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="lilyum ensemble">
    <meta name="twitter:creator" content="Satoru Kawahara"> 
    <meta name="twitter:text:description" content="うわ〜ん変わっちゃった〜〜! kindleのフォントが変わっちゃった〜! どうか､しましたか? kindleのフォントが変わってしまったのですが…｡">
    <meta name="twitter:title" content="うわ〜ん変わっちゃった〜〜! kindleのフォントが変わっちゃった〜! どうか､しましたか? kindleのフォントが変わってしまったのですが…｡"> 
    <meta name="twitter:url" content="https://nymphium.github.io/2016/07/21/kindle_font.html"> 
    <meta name="twitter:description" content="はじめにKindleの最安モデルがホコリをかぶっていたのですがなんとなくマウントしてみたところフォントの変更に成功した｡こんなんググればいっぱい出てくると思うので今更書くまでもない話ですが､体験として面白かったので書いておく｡">
    <meta name="twitter:image:src" content="https://nymphium.github.io/pictures/github_icon.png">
    <meta name="description" content="はじめにKindleの最安モデルがホコリをかぶっていたのですがなんとなくマウントしてみたところフォントの変更に成功した｡こんなんググればいっぱい出てくると思うので今更書くまでもない話ですが､体験として面白かったので書いておく｡">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://nymphium.github.io/2016/07/21/kindle_font.html">
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="https://nymphium.github.io/feed.xml">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:300%7CDroid+Sans+Mono%7CCrimson+Text:400,400i" rel="stylesheet">
  </head>

  <body>
    <header class="site-header">
      <div class="wrapper" style="font-family: 'Comfortaa';">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/aboutme.html">About</a>
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">うわ〜ん変わっちゃった〜〜! kindleのフォントが変わっちゃった〜! どうか､しましたか? kindleのフォントが変わってしまったのですが…｡</h1>
            <span class="post-meta">
              <time datetime="2016-07-21T00:00:00+09:00" itemprop="datePublished">Jul 21, 2016</time>
              <p>tag: {<a href="/tags.html#Kindle-ref">Kindle</a>, <a href="/tags.html#%E9%9B%91%E6%84%9F-ref">雑感</a>}</p>
            </span>
            <script type="text/javascript" src="/js/GithubRepoWidget.min.js"></script>
            <script type="text/javascript">setTimeout(GithubRepoWidget.init, 3000);</script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
            <!-- The loading of KaTeX is deferred to speed up page rendering -->
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js" integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous"></script>
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js" integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
<h1 id="part-2a064f37de75b4c9">はじめに</h1>
<p>Kindleの最安モデルがホコリをかぶっていたのですがなんとなくマウントしてみたところフォントの変更に成功した｡
こんなんググればいっぱい出てくると思うので今更書くまでもない話ですが､体験として面白かったので書いておく｡</p>
<h1 id="mount-ls">mount, ls</h1>
<p>USB接続すると､/dev/sdc1というものが生える｡
<code>lsblk -f</code>とすると､どうやらvfatのようだ｡マウントする｡<code>ls</code>を撃ち込むと､document､systemというディレクトリ､名前がハッシュのファイルなどがある｡</p>
<h1 id="system">怪しいsystem</h1>
<p>あきらかにsystemディレクトリに何かありそうだ｡<em>fonts</em>というディレクトリがぶら下がっており､フォントを変えたい気持ちが突然わいてきた｡</p>
<h1 id="fonts">fonts</h1>
<p>中を見ると､<em>ja.font</em>というファイルがある｡これやな｡</p>
<h1 id="cramfs">cramfsやんけこれ</h1>
<p><code>xxd -g 1 ja.font | head</code>してみると<strong>45 3d cd 28</strong>というのが見える｡もちろん知らないのでググる｡Comressed ROMFSということが分かった｡
これもマウントしてみる｡
01-ja.confというfontconfigファイルとimage_manifestというフォント情報などが書かれたjsonファイルっぽいもの､ありましたねぇttfファイルが置かれているfontsディレクトリ｡</p>
<h1 id="read-only">read-onlyじゃんハゲ! コピーする</h1>
<p>とのこと</p>
<h1 id="font">fontをつっこむ</h1>
<p>好きなフォントを突っ込もう!! ライセンスを無視するのは <img class="emoji" title=":no_good:" alt=":no_good:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f645.png" height="20" width="20"></p>
<p>JSONに書かれた情報を更新する｡<code>"FONTFILE.ttf.md5"</code>というパラメーターがあるので､<code>md5sum FONTFILE.ttf</code>で得た値を差し込む｡
<code>"fonts.ja"</code>には明朝体をローマ字で書く(のか?)｡<code>"font.MINCHOROMAN.display"</code>パラメーターにはUTF-8でフォント名を埋め込みたい｡
ここでLua5.3の<code>utf8</code>モジュールが役に立つわけですね! MoonScriptのリスト内包表記も便利だ!!</p>
<div class="highlight"><pre><code class="language-moon" data-lang="moon"><span class="nb">print</span><span class="w"> </span><span class="nb">table.concat</span><span class="w"> </span><span class="p">[</span><span class="s2">"\\u%x"</span><span class="o">\</span><span class="n">format</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">utf8</span><span class="p">.</span><span class="n">codes</span><span class="w"> </span><span class="s2">"FONT-NAME"</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<h1 id="mkfs-cramfs">mkfs.cramfs</h1>
<p>コピーおよび変更したディレクトリをComressed ROMFSにもどす｡</p>
<h1 id="part-627ea342d1983c22">すっとする</h1>
<p>Comressed ROMFSに戻したイメージファイルをja.fontとしてスッと戻す</p>
<h1 id="umount">umount､確認</h1>
<p>ええな</p>
<h1 id="part-2a00357080695c85">おわりに</h1>
<p>買ってすぐ(2015年1月あたり)にフォントの変更を試み､ググってみたりはしたものの結局フォントの変更に至らなかったので､今回はよくやったと思いました｡
<code>file</code>コマンドなどの使用をパッと思いつけばもう少し早くできましたね､反省してください｡</p>
          </div>
        </article>

      </div>
    </div>
    <footer>
      <div class="pagination btn-group" style="text-align: center; font-family: 'Comfortaa';">
        <a class="btn prev" href="/2016/06/26/RAID0%E3%81%AAF2FS%E3%81%ABArch%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B.html" title="RAID0なF2FSにArchをインストールする">← Prev</a>
        /<a class="btn" href="/">Top</a>/
        <a class="btn next" href="/2016/09/07/yourname.html" title="『君の名は｡』考察">Next →</a>
      </div>
    </footer>

  </body>
</html>
