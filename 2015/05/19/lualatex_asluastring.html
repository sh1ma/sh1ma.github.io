<!DOCTYPE html>
<html>
  <head>
    <title>texluaとtex.print &#47; lilyum ensemble</title>
    <meta content="text/html;charset=UTF-8" http-equiv="content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Satoru Kawahara">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="lilyum ensemble">
    <meta name="twitter:creator" content="Satoru Kawahara"> 
    <meta name="twitter:text:description" content="texluaとtex.print">
    <meta name="twitter:title" content="texluaとtex.print"> 
    <meta name="twitter:url" content="https://nymphium.github.io/2015/05/19/lualatex_asluastring.html"> 
    <meta name="twitter:description" content="こんにちは､びしょ〜じょです｡アイカツ劇場版のBD発売ももうすぐですね｡もちろん予約注文してあります｡ソウルマリオネットコーデがあとブーツだけなので皆さんよろしくお願いします｡当方トップスが被っております｡">
    <meta name="twitter:image:src" content="https://nymphium.github.io/pictures/github_icon.png">
    <meta name="description" content="こんにちは､びしょ〜じょです｡アイカツ劇場版のBD発売ももうすぐですね｡もちろん予約注文してあります｡ソウルマリオネットコーデがあとブーツだけなので皆さんよろしくお願いします｡当方トップスが被っております｡">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://nymphium.github.io/2015/05/19/lualatex_asluastring.html">
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="https://nymphium.github.io/feed.xml">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:300%7CDroid+Sans+Mono%7CCrimson+Text:400,400i" rel="stylesheet">
  </head>

  <body>
    <header class="site-header">
      <div class="wrapper" style="font-family: 'Comfortaa';">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/aboutme.html">About</a>
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">texluaとtex.print</h1>
            <span class="post-meta">
              <time datetime="2015-05-19T00:00:00+09:00" itemprop="datePublished">May 19, 2015</time>
              <p>tag: &#123;<a href="/tags.html#LaTeX-ref">LaTeX</a>, <a href="/tags.html#Lua-ref">Lua</a>&#125;</p>
            </span>
            <script type="text/javascript" src="/js/GithubRepoWidget.min.js"></script>
            <script type="text/javascript">setTimeout(GithubRepoWidget.init, 3000);</script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
            <!-- The loading of KaTeX is deferred to speed up page rendering -->
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js" integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous"></script>
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js" integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous"
                    onload="renderMathInElement(document.body);"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
<p>こんにちは､びしょ〜じょです｡アイカツ劇場版のBD発売ももうすぐですね｡もちろん予約注文してあります｡ソウルマリオネットコーデがあとブーツだけなので皆さんよろしくお願いします｡当方トップスが被っております｡</p>
<hr>
<h2 id="texlua">クソッタレtexluaを使う</h2>
<p>texluaとは､LuaTeXにねじ込まれているLuaの処理系であり､クソッタレである｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex"><span class="k">\documentclass</span><span class="p">{</span>ltjsarticle<span class="p">}</span>

<span class="nt">\begin{document}</span>
<span class="k">\directlua</span><span class="p">{</span>
for i = 1, 10 do
tex.print("<span class="p">$</span><span class="m">2</span><span class="p">^{</span><span class="nb">" .. i  .. "</span><span class="p">}$</span>")
end

tex.print("")

for i = 1, 10 do
tex.write("<span class="p">$</span><span class="m">2</span><span class="p">^{</span><span class="nb">" .. i .. "</span><span class="p">}$</span>")
end
<span class="p">}</span>
<span class="nt">\end{document}</span>
</code></pre></div>
<p>適当なファイル名にして､<code>lualatex tekitou.tex</code>とでもすると､こんな感じのPDFが出る｡</p>
<p></p><center><img src="/pictures/2015-05-19-lualatex1.png" alt="hello" title="tekitou.pdf"></center>
<p><code>tex.print</code>は受け取った文字列を<em>LaTeXの入力として</em>受け取り､コンパイル(実行)時に出力先に吐き出す｡<code>tex.write</code>は受け取った文字列をただの文字列として受け取る｡</p>
<p>画像を見ると､<code>tex.print</code>で出力した\(2^i\)は意図通りに出力されており<sup id="fnref1" title="(jekyll + redcarpetでは意図通り2^iが出ませんね💢) (追記2015/06/04:と思ったけどMatJax使えるじゃねーか｡ごめんなさい｡) "><a href="#fn1" rel="footnote">1</a></sup>､<code>tex.write</code>を用いた部分では"$2^-1$“とかよく分からない感じになっている｡</p>
<p>ここで､｢おっこれはLaTeXコマンドもいけるんちゃうか〜｣と思った好奇心旺盛な少年が多いことは間違いない｡しかし､texluaはちょっとここで少年たちを嘲笑う｡</p>
<hr>
<p><code>tex.print("\LaTeX")</code>などとすると､まぁLuaを学んだ人間はわかるがバックスラッシュのところで怒られる｡正しい｡</p>
<p>ではバックスラッシュを2つ重ねるとOK､と思うだろうがそうは問屋が云々｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">...
tex.print"(Hello, <span class="k">\\</span>LaTeX")
...
</code></pre></div>
<p><code>! Undefined control seq</code> <strong><em>ファーーーック</em></strong> だバカヤロウど畜生めが｡ここで名案閃き､Luaは<code>[[]]</code>で文字列を囲むことでバックスラッシュも解決するのだ〜ハハハハ</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">...
tex.print([[Hello, <span class="k">\LaTeX</span>]])
...
</code></pre></div>
<p><code>! Undefined control seq</code> <strong><em>ファーーーック</em></strong> 慈悲はない｡</p>
<h3 id="part-37870d0ca98db96">解決法</h3>
<div class="highlight"><pre><code class="language-" data-lang="">...
tex.print(\asluastring{Hello, \LaTeX})
...
</code></pre></div>
<p>ltj{,s}articleには<code>\asluastring</code>というLaTeXコマンドがあり､良い感じになってくれる｡</p>
<p>もうちょっと良い感じの例</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex"><span class="k">\documentclass</span><span class="p">{</span>ltjsarticle<span class="p">}</span>

<span class="k">\directlua</span><span class="p">{</span>
    tex.print(
        <span class="k">\asluastring</span><span class="p">{</span><span class="nt">\begin{document}</span><span class="p">}</span> ..
        <span class="k">\asluastring</span><span class="p">{</span>Lua<span class="k">\LaTeX</span><span class="p">}</span> ..
        <span class="k">\asluastring</span><span class="p">{</span><span class="nt">\end{document}</span><span class="p">}</span>
    )
<span class="p">}</span>
</code></pre></div>
<p></p><center> <img src="/pictures/2015-05-19-lualatex.png" alt="LuaLaTeX" title="こんなものを書くな.pdf"> </center>
<p>プレアンブルでも<code>\directlua</code>は使うことができ､こういった悲劇を編み出すことも可能<em>(全然良い感じじゃないんだよなぁ…)</em>｡</p>
<p>しかし<code>tex.print</code>を2個使って<code>\begin{document}</code>と<code>\end{document}</code>を､環境を分けることができない｡うーん､<code>tex.print</code>で環境をネストさせたい時は滅茶苦茶にキモくなるので､
<del>こういうことはやめておこう</del>環境の中身は適当な変数に突っ込むべきだろう｡</p>
<p>一気に話が飛んでしまった｡<code>{\texttt hoge}</code>みたいなことをしたいときはどうするか｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">...
tex.print("<span class="p">{</span>" .. <span class="k">\asluastring</span><span class="p">{</span><span class="k">\texttt</span><span class="p">}</span> .. "fuck<span class="p">}</span>")
...
</code></pre></div>
<p>こんな感じにすることで漏れを防ぐ｡<code>\asluastring{\texttt{}</code>みたいな感じにするとコンパイルエラーになるので注意｡</p>
<h2 id="part-b8a957a">他</h2>
<p>luatexja-presetにdeluxeオプションを渡すと編集中のtexファイルとは無関係そうな場所を指摘され､なんだか腹が立つ｡これはluatexja-fontspecのバグで､<a href="http://osdn.jp/projects/luatex-ja/wiki/FrontPage#h3-.E3.83.90.E3.82.B0.E6.83.85.E5.A0.B1">こちら</a>を参照｡これはtexluaとあまり関係はないですね､はい｡</p>
<h2 id="2">他2</h2>
<p>LuaLaTeXはコンパイル時にTwitterのタイムラインを取得できる数少ないLaTeX処理系なので好きですよ｡</p>
<div class="enclosed-tweet" align="center">
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">LuaLaTeXはツイッタークライアント <a href="http://t.co/K7p0rn6gAA">pic.twitter.com/K7p0rn6gAA</a></p>— びしょ〜じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/599485391658352641?ref_src=twsrc%5Etfw">May 16, 2015</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<hr>
<p>今期は単位がいっぱい取れそうな予感｡</p>
<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>(jekyll + redcarpetでは意図通り2^iが出ませんね💢) (追記2015/06/04:と思ったけどMatJax使えるじゃねーか｡ごめんなさい｡) <a href="#fnref1" rev="footnote">↩</a></p>
</li>

</ol>
</div>
          </div>
        </article>

      </div>
    </div>
    <footer>
      <div class="pagination btn-group" style="text-align: center; font-family: 'Comfortaa';">
        <a class="btn prev" href="/2015/05/10/apriled.html" title="Apriled">&larr; Prev</a>
        &#47;<a class="btn" href="/">Top</a>&#47;
        <a class="btn next" href="/2015/06/29/staranis_live.html" title="STAR☆ANIS アイカツ！スペシャルLIVE TOUR 2015 SHINING STAR*">Next &rarr;</a>
      </div>
    </footer>

  </body>
</html>
