<!DOCTYPE html>
<html>
  <head>
    <title>subfilesを使ってみんなで記事を書く､しおりも出す &#47; lilyum ensemble</title>
    <meta content="text/html;charset=UTF-8" http-equiv="content-type">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Satoru Kawahara">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="lilyum ensemble">
    <meta name="twitter:creator" content="Satoru Kawahara"> 
    <meta name="twitter:text:description" content="subfilesを使ってみんなで記事を書く､しおりも出す">
    <meta name="twitter:title" content="subfilesを使ってみんなで記事を書く､しおりも出す"> 
    <meta name="twitter:url" content="https://nymphium.github.io/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F-%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99.html"> 
    <meta name="twitter:description" content="こんにちは､びしょ〜じょです｡">
    <meta name="twitter:image:src" content="https://nymphium.github.io/pictures/github_icon.png">
    <meta name="description" content="こんにちは､びしょ〜じょです｡">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://nymphium.github.io/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F-%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99.html">
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="https://nymphium.github.io/feed.xml">
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:300%7CDroid+Sans+Mono%7CCrimson+Text:400,400i" rel="stylesheet">
  </head>

  <body>
    <header class="site-header">
      <div class="wrapper" style="font-family: 'Comfortaa';">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/aboutme.html">About</a>
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">subfilesを使ってみんなで記事を書く､しおりも出す</h1>
            <span class="post-meta">
              <time datetime="2018-10-17T00:00:00+09:00" itemprop="datePublished">Oct 17, 2018</time>
              <p>tag: &#123;<a href="/tags.html#LaTeX-ref">LaTeX</a>&#125;</p>
            </span>
            <script type="text/javascript" src="/js/GithubRepoWidget.min.js"></script>
            <script type="text/javascript">setTimeout(GithubRepoWidget.init, 3000);</script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
            <!-- The loading of KaTeX is deferred to speed up page rendering -->
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js" integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous"></script>
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js" integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous"
                    onload="renderMathInElement(document.body);"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
<p>こんにちは､びしょ〜じょです｡</p>
<p>この度､『Dragon University 技術書典5』を手にとっていただいて誠にありがとうございました｡</p>
<div class="enclosed-tweet" align="center">
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">70部弱売れたのでええ感じでした。ありがとうございました。 <a href="https://t.co/dYxhhgDnnx">pic.twitter.com/dYxhhgDnnx</a></p>— びしょ〜じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/1049208145816350721?ref_src=twsrc%5Etfw">October 8, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<p>“70部<strong><em>弱</em></strong>"とありますが実際は"70部<strong><em>強</em></strong>"です｡
重ねてありがとございました｡</p>
<p>さて､ここからが大事だ｡
大事な話をする｡</p>
<div class="enclosed-tweet" align="center">
<blockquote class="twitter-tweet">
<p lang="ja" dir="ltr">Dragon Universityは近々ダウンロード販売をやるようなのでお待ち下さい､物理媒体を購入した方はnページ目m行目s文字目～t文字などのパスフレーズを入力すると無料でゲットできるようにする(はず)</p>— びしょ〜じょ (@Nymphium) <a href="https://twitter.com/Nymphium/status/1049334128800219137?ref_src=twsrc%5Etfw">October 8, 2018</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
<p>してました｡</p>
<h2 id="20181018">追記20181018</h2>
<p>もうはじまってる!!!</p>
<p><a href="https://dragonuniversity.booth.pm/items/1055860">https://dragonuniversity.booth.pm/items/1055860</a></p>
<p>追記おわり</p>
<hr>
<p>さて､LaTeX文書からPDFを作成してpublishした人の多くはhyperrefパッケージを使っているかと思います｡
hyperrefにはしおりを作る機能があります(図<a href="#bookmarks">0.1</a>)｡</p>
<p></p><center>
<label id="bookmarks"></label>
<img src="/pictures/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F%EF%BD%A4%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99/bookmarks.png" alt="しおり" title="しおり">
図<a href="#bookmarks">0.1</a> evinceで正しく表示されるしおり
</center>
<p>今回我々はsubfilesで各々がファイルを書いてプロジェクトのルートのmain.texで各人のmainファイルを読むようにしました｡</p>
<p><a href="https://github.com/Nymphium/nymphium.github.io/tree/source/src/latex-subfiles">src/latex-subfiles</a></p>
<div class="highlight"><pre><code class="language-" data-lang="">.
├── authors
│   ├── ore
│   │   └── main.tex
│   └── other
│       └── main.tex
└── main.tex
</code></pre></div>
<p><a href="/src/latex-subfiles/main.tex">src/latex-subfiles/main.tex</a></p>
<div class="highlight">
<span class="listing-name">main.tex</span><pre><code class="language-tex" data-lang="tex">......
<span class="nt">\begin{document}</span>
<span class="k">\subfile</span><span class="p">{</span>authors/ore/main.tex<span class="p">}</span>
<span class="k">\subfile</span><span class="p">{</span>authors/other/main.tex<span class="p">}</span>
<span class="nt">\end{document}</span>
</code></pre>
</div>
<p><a href="/src/latex-subfiles/authors/ore/main.tex">src/latex-subfiles/authors/ore/main.tex</a></p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex"><span class="k">\documentclass</span><span class="p">{</span>subfiles<span class="p">}</span>

<span class="k">\author</span><span class="p">{</span>ほげほげ<span class="p">}</span>
<span class="k">\title</span><span class="p">{</span>あああ<span class="p">}</span>

<span class="nt">\begin{document}</span>
<span class="k">\maketitle</span>
<span class="k">\section</span><span class="p">{</span>はじめに<span class="p">}</span>
<span class="k">\subsection</span><span class="p">{</span>ほげ<span class="p">}</span>
<span class="k">\section</span><span class="p">{</span>おわりに<span class="p">}</span>
<span class="nt">\end{document}</span>
</code></pre></div>
<p><a href="/src/latex-subfiles/authors/other/main.tex">src/latex-subfiles/authors/other/main.tex</a></p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex"><span class="k">\documentclass</span><span class="p">{</span>subfiles<span class="p">}</span>
<span class="k">\author</span><span class="p">{</span>other<span class="p">}</span>
<span class="k">\title</span><span class="p">{</span>別の話<span class="p">}</span>
<span class="nt">\begin{document}</span>
<span class="k">\maketitle</span>
<span class="k">\section</span><span class="p">{</span>はじめに<span class="p">}</span>
<span class="k">\subsection</span><span class="p">{</span>ほげ<span class="p">}</span>
<span class="k">\section</span><span class="p">{</span>おわりに<span class="p">}</span>
<span class="nt">\end{document}</span>
</code></pre></div>
<p>subfilesで<code>\maketitle</code>を使うと各記事のタイトルを良い感じにいれられないので改造する｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">
......
<span class="k">\makeatletter</span>
<span class="k">\renewcommand</span><span class="p">{</span><span class="k">\maketitle</span><span class="p">}{</span><span class="c">%</span>
  <span class="k">\clearpage</span>
  <span class="k">\newpage\null</span>
  <span class="k">\vskip</span> 2em
  <span class="nt">\begin{center}</span><span class="c">%</span>
    <span class="k">\let\footnote\thanks</span>
    <span class="p">{</span><span class="k">\LARGE</span> <span class="k">\textbf</span><span class="p">{</span><span class="k">\@</span>title<span class="p">}</span> <span class="k">\par</span><span class="p">}</span><span class="c">% タイトル</span>
    <span class="k">\vskip</span> 1.5em
    <span class="p">{</span><span class="k">\large</span>
      <span class="k">\lineskip</span> .5em
        <span class="nt">\begin{flushright}</span>
          <span class="k">\@</span>author <span class="c">% 著者名</span>
        <span class="nt">\end{flushright}</span>
      <span class="k">\par</span><span class="p">}</span><span class="c">%</span>
  <span class="nt">\end{center}</span><span class="c">%</span>
  <span class="k">\par\vskip</span> 1.5em
  <span class="k">\ifvoid\@</span>abstractbox<span class="k">\else\centerline</span><span class="p">{</span><span class="k">\box\@</span>abstractbox<span class="p">}</span><span class="k">\vskip</span>1.5em<span class="k">\fi</span>
  <span class="k">\setcounter</span><span class="p">{</span>section<span class="p">}{</span>0<span class="p">}</span><span class="c">% ミソ</span>
  <span class="k">\setcounter</span><span class="p">{</span>subsection<span class="p">}{</span>0<span class="p">}</span>
  <span class="k">\setcounter</span><span class="p">{</span>subsubsection<span class="p">}{</span>0<span class="p">}</span>
  <span class="k">\setcounter</span><span class="p">{</span>footnote<span class="p">}{</span>0<span class="p">}</span>
<span class="p">}</span>
<span class="k">\makeatother</span>
......

</code></pre></div>
<p>この辺は好みによる｡
今回はltjsarticleの<code>\maketitle</code>コマンドを改造している｡
section等のカウンタを0で初期化しているのがミソで､これをしないと各記事のカウンタが連番になってしまう｡
しかしそうするとしおりが壊れる(図<a href="#brokenbm">0.2</a>)｡</p>
<p></p><center>
<label id="brokenbm"></label>
記事<code>あああ</code>のサブセクション位置に次の記事が来てしまっている｡
<img src="/pictures/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F%EF%BD%A4%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99/broken.png" alt="壊れたしおり" title="壊れたしおり">
図<a href="#brokenbm">0.2</a> 壊れたしおり
</center>
<p>hyperrefパッケージのオプションに<code>hypertexnames=false</code>を渡すことで解決する｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">......
<span class="k">\usepackage</span>[<span class="c">%</span>
  pdfencoding=auto<span class="c">% 文字化け防止</span>
, hypertexnames=false<span class="c">% ←</span>
, luatex]<span class="p">{</span>hyperref<span class="p">}</span>
......
</code></pre></div>
<p></p><center>
<label id="ok1"></label>
<img src="/pictures/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F%EF%BD%A4%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99/ok1.png" alt="ok1" title="ok1">
図<a href="#ok1">0.3</a> ok1
</center>
<p>図<a href="#bookmarks">0.1</a>のように記事名もしおりに入れたい｡
記事名の子に各セクションが来てほしいので｡<code>\maketitle</code>に手を加える｡</p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">
......
<span class="k">\renewcommand</span><span class="p">{</span><span class="k">\maketitle</span><span class="p">}{</span><span class="c">%</span>
  <span class="k">\clearpage</span>
  <span class="k">\addcontentsline</span><span class="p">{</span>toc<span class="p">}{</span>part<span class="p">}{{</span><span class="k">\large</span> <span class="k">\@</span>title<span class="p">}}</span><span class="c">% これ</span>
  <span class="k">\newpage\null</span>
......

</code></pre></div>
<p>この<code>\large</code>指定は目次のためである｡
親子関係はsectionの上に来てほしいのでchapterかpartにする｡
目次はchapterよりもpartのほうが見栄えが良かったのでpartにした｡</p>
<p>そしてまた壊れる｡壊れるなぁ…｡
</p><center>
<label id="broken2"></label>
<img src="/pictures/2018/10/17/subfiles%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%93%E3%81%AA%E3%81%A7%E8%A8%98%E4%BA%8B%E3%82%92%E6%9B%B8%E3%81%8F%EF%BD%A4%E3%81%97%E3%81%8A%E3%82%8A%E3%82%82%E5%87%BA%E3%81%99/broken2.png" alt="broken2" title="broken2">
図<a href="#broken2">0.4</a> こわれる
</center>
<p>ここでおもむろに<code>\phantomsection</code>を挿入する｡</p>
<p><a href="https://tex.stackexchange.com/questions/44088/when-do-i-need-to-invoke-phantomsection">hyperref - When do I need to invoke \phantomsection? - TeX - LaTeX Stack Exchange</a></p>
<div class="highlight"><pre><code class="language-tex" data-lang="tex">
......
<span class="k">\renewcommand</span><span class="p">{</span><span class="k">\maketitle</span><span class="p">}{</span><span class="c">%</span>
  <span class="k">\clearpage</span>
  <span class="k">\phantomsection</span><span class="c">% addcontenstlineの前に追加</span>
  <span class="k">\addcontentsline</span><span class="p">{</span>toc<span class="p">}{</span>part<span class="p">}{{</span><span class="k">\large</span> <span class="k">\@</span>title<span class="p">}}</span>
  <span class="k">\newpage\null</span>
......

</code></pre></div>
<p>これでやっと図<a href="#bookmarks">0.1</a>のようになった｡</p>
<hr>
<p>ということでpdf版制作にもワザがありました｡
表紙の"interpr <em>i</em> ter"も修正されていると思いますので､近々出るpdf版もよろしくおねがいします｡</p>
          </div>
        </article>

      </div>
    </div>
    <footer>
      <div class="pagination btn-group" style="text-align: center; font-family: 'Comfortaa';">
        <a class="btn prev" href="/2018/10/05/ML-Day%E3%82%84%E3%81%A3%E3%81%9F,-%E6%96%B0%E3%81%9F%E3%81%AA%E3%83%90%E3%82%A4%E3%83%88%E5%A7%8B%E3%81%BE%E3%81%A3%E3%81%9F,-%E6%8A%80%E8%A1%93%E6%9B%B8%E5%85%B8%E3%81%8C%E3%81%82%E3%82%8B.html" title="ML Dayやった, 新たなバイト始まった, 技術書典がある">&larr; Prev</a>
        &#47;<a class="btn" href="/">Top</a>&#47;
        <span class="btn next disabled">Next &rarr;</span>
      </div>
    </footer>

  </body>
</html>
