<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>lilyum ensemble</title>
    <description>lily, Aikatsu, Programming language, and more</description>
    <link>https://nymphium.github.io/</link>
    <atom:link href="https://nymphium.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 08 May 2020 02:13:13 +0900</pubDate>
    <lastBuildDate>Fri, 08 May 2020 02:13:13 +0900</lastBuildDate>
    <generator>Jekyll v3.8.6</generator>
    
      <item>
        <title>æ—¥åˆŠPromise(4) ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã§æ˜æ—¥ã¸ã®å¸ƒçŸ³</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/05/08/nikkan-promise4/thumb.png"></enclosure>
        <description>&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;1. ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
å‰å›ã¯Promiseã®å®Ÿè£…ã«å¤±æ•—ã—ã¦ã„ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã—ãŸï½¡
ãã“ã§ä»Šå›ã¯ï½¤Promiseã®å®Ÿè£…ã«å¿…è¦ã¨ãªã‚‹ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã®å°å…¥ã‚’ã—ã¾ã™ï½¡&lt;/p&gt;&lt;h1 id=&quot;2.+%E7%B6%99%E7%B6%9A%3F+%E3%83%A2%E3%83%8A%E3%83%89%3F+%E3%81%AF%3F+%E3%83%9E%E3%83%9E%3F&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+%E7%B6%99%E7%B6%9A%3F+%E3%83%A2%E3%83%8A%E3%83%89%3F+%E3%81%AF%3F+%E3%83%9E%E3%83%9E%3F&quot;&gt;2. ç¶™ç¶š? ãƒ¢ãƒŠãƒ‰? ã¯? ãƒãƒ?&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã¯å®Ÿã¯ã¿ã‚“ãªã®ãƒãƒãªã®ã§ã™ãŒ&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/the-mother-of-all-monads&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;/pictures/no_image.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/the-mother-of-all-monads&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;The Mother of all Monads - School of Haskell | School of Haskell&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ä»Šå›ã¯å˜ç´”ã«è©•ä¾¡å™¨ã‚’CPSã«ã™ã‚‹ã«ã‚ãŸã£ã¦ç¶™ç¶šã‚’æ¸¡ã—ã¾ãã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ï½¤ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã‚’å°å…¥ã—ã¦å®Ÿè£…ã‚’ã‚¹ãƒƒã‚­ãƒªã•ã›ã‚‹ã¤ã‚‚ã‚Šã§ã™ï½¡&lt;/p&gt;&lt;p&gt;evalãŒCPSã¨ã¯ã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ï½¤evalãŒCPSã«ãªã£ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨â€¦â€¦ï½¡
ã‚ã‹ã‚Šã‚„ã™ã„äºŒé …æ¼”ç®—ã‚’ä¾‹ã«è¦‹ã¦ã¿ã‚‹ã¨ï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Op&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;eval_k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;eval_k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;binop_k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã“ã‚“ãªé›°å›²æ°—ï½¡
è‹¥å¹²ã‚ƒã ã‚‹ã„ã®ã§ï½¤ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã‚’ä½¿ã£ã¦ã‚¹ãƒãƒ¼ãƒˆã«å®Ÿè£…ã™ã‚‹ï½¡
ã“ã“ã§ã„ã†&quot;ãƒ¢ãƒŠãƒ‰&quot;ã¨ã¯ &lt;code&gt;&amp;gt;&amp;gt;=&lt;/code&gt; ã‚„ &lt;code&gt;return&lt;/code&gt; ã®ã‚ã‚‹ä¾¿åˆ©ãªä»£æ•°æ§‹é€ ã‚’æŒ‡ã—ã¦ã„ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ç¶™ç¶šãƒ¢ãƒŠãƒ‰ã‚’å°å…¥ã™ã‚‹ã¨ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Cont&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Op&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lift&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binop_k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã“ã†ã„ã†æ„Ÿã˜ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã‚‹ï½¡&lt;/p&gt;&lt;h1 id=&quot;3.+%3Ccode%3Econt.ml%3C%2Fcode%3E+%E5%AE%9F%E8%A3%85&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+%3Ccode%3Econt.ml%3C%2Fcode%3E+%E5%AE%9F%E8%A3%85&quot;&gt;3. &lt;code&gt;cont.ml&lt;/code&gt; å®Ÿè£…&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ç¶™ç¶šã¯æ®‹ã‚Šã®è¨ˆç®—ãªã‚“ã§ã™ãŒï½¤å‹ã§è¡¨ã™ã¨&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hole&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¨ˆç®—ã«ç©´(&lt;code&gt;'hole&lt;/code&gt;)ãŒç©ºã„ã¦ãŠã‚Šï½¤ãã‚Œã«ä½•ã‹å€¤ã‚’æ¸¡ã™ã¨æ®‹ã‚Šã®è¨ˆç®—(&lt;code&gt;'hole -&amp;gt; 'ans&lt;/code&gt;)ãŒèµ°ã£ã¦å®Ÿè¡Œçµæœ(&lt;code&gt;'ans&lt;/code&gt;)ãŒè¿”ã£ã¦ãã‚‹ï½¤ã¨èª­ã‚ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ã‚ã¨ã¯ã‚„ã‚‹ã ã‘ãªã®ã§ã“ã®ã‚ˆã†ãªã‚·ã‚°ãƒãƒãƒ£ã¨å¯¾å¿œã™ã‚‹å®Ÿè£…ã‚’ç”¨æ„ã™ã‚Œ&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ans&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lift&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_identity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç‰¹ã«ï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cont&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cont&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cont'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cont'&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k'&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŠ ãˆã¦ï½¤&lt;code&gt;List.map&lt;/code&gt;ã‚‚ç¶™ç¶šãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ¬²ã—ããªã£ãŸã®ã§è¿½åŠ ã—ãŸï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;List&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ys&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€èˆ¬çš„ãª&lt;code&gt;List.map&lt;/code&gt;ã¨ã»ã¨ã‚“ã©åŒã˜ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã«CPSã«ãªã£ã¦ã„ã‚‹ã®ãŒé¢ç™½ã„ï½¡
ã“ã‚ŒãŒæŠ½è±¡åŒ–ã®åŠ›ã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;h1 id=&quot;4.+eval%E3%82%92CPSify&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+eval%E3%82%92CPSify&quot;&gt;4. evalã‚’CPSify&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;code&gt;eval_exp&lt;/code&gt;ãŠã‚ˆã³&lt;code&gt;eval_stmts&lt;/code&gt;ã‚‚ï½¤&lt;code&gt;List.map&lt;/code&gt;ã¨åŒæ§˜ã«ï½¤ã¡ã‚‡ã£ã¨æ›¸ãæ›ãˆã‚‹ã ã‘ã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt;&lt;span class=&quot;err&quot;&gt;......&lt;/span&gt;
+and eval_exp : type ans. env -&amp;gt; exp -&amp;gt; (runtime_value, ans) Cont.t =
&lt;span class=&quot;gi&quot;&gt;+ fun env exp -&amp;gt;
+  let open Cont in
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-and eval_exp env exp =
&lt;/span&gt;   let () = Thread_pool.run () |&amp;gt; ignore in
   match exp with
&lt;span class=&quot;gi&quot;&gt;+  | Value v -&amp;gt; return @@ rtv_of_value env v
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-  | Value v -&amp;gt; rtv_of_value env v
&lt;/span&gt;   | Op (op, e1, e2) -&amp;gt;
&lt;span class=&quot;gi&quot;&gt;+    let* v1 = eval_exp env e1 in
+    let* v2 = eval_exp env e2 in
+    return @@ binop op v1 v2
+  | Call (e, es) -&amp;gt;
+    let* fn = eval_exp env e in
+    let* args = Cont.List.map ~f:(eval_exp env) es in
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-    let v1 = eval_exp env e1 in
-    let v2 = eval_exp env e2 in
-    binop op v1 v2
-  | Call (e1, e2) -&amp;gt;
-    let fn = eval_exp env e1 in
-    let args = List.map ~f:(eval_exp env) e2 in
&lt;/span&gt;     (match fn with
     | Closure (env', xs, body) -&amp;gt;
       let env'' = bind_args xs args @ env' in
&lt;span class=&quot;err&quot;&gt;......&lt;/span&gt;

&lt;span class=&quot;gi&quot;&gt;+and eval_stmts : type ans. env -&amp;gt; stmts -&amp;gt; (runtime_value, ans) Cont.t =
+ fun env stmts -&amp;gt;
+  let open Cont in
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-and eval_stmts env stmts =
&lt;/span&gt;   match stmts with
   | End stmt -&amp;gt;
     (match stmt with
     | Expression e | Def (_, e) -&amp;gt;
&lt;span class=&quot;gi&quot;&gt;+      let* _ = eval_exp env e in
+      return RUnit
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-      let () = eval_exp env e |&amp;gt; ignore in
-      RUnit
&lt;/span&gt;     | Return e -&amp;gt; eval_exp env e)
   | Last (stmt, tl) -&amp;gt;
     (match stmt with
     | Expression e -&amp;gt;
&lt;span class=&quot;gi&quot;&gt;+      let* _ = eval_exp env e in
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-      let () = eval_exp env e |&amp;gt; ignore in
&lt;/span&gt;       eval_stmts env tl
     | Def (x, e) -&amp;gt;
&lt;span class=&quot;gi&quot;&gt;+      let* rtv = eval_exp env e in
+      let env' = (x, rtv) :: env in
&lt;/span&gt;&lt;span class=&quot;gd&quot;&gt;-      let env' = (x, eval_exp env e) :: env in
&lt;/span&gt;       eval_stmts env' tl
     | Return e -&amp;gt; eval_exp env e)
 ;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;answer typeã‚’å¤šç›¸ã«ã—ãŸã‹ã£ãŸã®ã§&lt;code&gt;forall&lt;/code&gt;ã§å‹æ³¨é‡ˆã‚’ä»˜ã‘ãŸï½¡
GADTsã‚„recordä»¥å¤–ã§OCamlã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‹æ³¨é‡ˆã‚’ä»˜ã‘ãŸããªã‚‹æ•°å°‘ãªã„ã‚·ãƒ¼ãƒ³ãªæ°—ãŒã™ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;å®Ÿéš›ã®ã¨ã“ã‚ï½¤ã‚ã¾ã‚Šå¤‰ã‚ã£ã¦ãªã„ã®ã¯ã¨ã‚Šã‚ãˆãšCPSã£ã½ãã—ãŸã¨ã„ã†ã ã‘ã§æœ¬å½“ã«ã‚„ã‚‹ã¹ãã“ã¨ã‚’ã‚„ã£ã¦ãªã„ã‹ã‚‰ã§ã™ï½¡
æ¬¡ã‚„ã‚‹ã¹ãã“ã¨ã¯ï½¤&lt;code&gt;Promise(Wait(-))&lt;/code&gt;ã§ç¶™ç¶šã‚’ã‚¬ãƒãƒƒã¨å–ã£ã¦ï½¤å‰å›ç¢ºèªã—ãŸã‚ˆã†ã«&lt;code&gt;.then&lt;/code&gt;ã«å–ã£ã¦ããŸç¶™ç¶šã‚’æ¸¡ã—ã¦æ®‹ã‚Šã®æ–‡ã‚’1ã¤ã®å¤§ããªpromise objectã«ã™ã‚‹ã¨ã“ã‚ã§ã™ã­ï½¡&lt;/p&gt;&lt;h1 id=&quot;5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;5. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;jane streetãŒ&lt;code&gt;Core.Cont&lt;/code&gt;ã‚’ç”¨æ„ã—ã¦ãã‚Œã‚Œã°ç¡çœ æ™‚é–“ãŒé•·ããªã£ãŸã‚“ã˜ã‚ƒãªã„ã§ã™ã‹? ã§ã‚‚æ¥½ã—ã‹ã£ãŸã‹ã‚‰ã‚ªãƒƒã‚±ãƒ¼ã§ã™!&lt;/p&gt;</description>
        <pubDate>Fri, 08 May 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/05/08/nikkan-promise4.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/05/08/nikkan-promise4.html</guid>
        
        <category>æ—¥åˆŠPromise</category>
        
        
      </item>
    
      <item>
        <title>æ—¥åˆŠPromise(3) ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã£ã½ã„ã‚‚ã®ã‚’ä½œã£ã¦setTimeoutã‚’æ”¹ä¿®</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/05/06/nikkan-promise3/thumb.png"></enclosure>
        <description>&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;1. ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
â€œæ—¥åˆŠ&quot;ã§ã™ãŒæ˜¨æ—¥ã¯ç¥çµµå¸«æ´»å‹•ã®ãŸã‚ãŠä¼‘ã¿ã‚’ã„ãŸã ã„ãŸãŸã‚ï½¤ã»ã¼æ—¥ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸï½¡&lt;/p&gt;&lt;p&gt;ä»Šå›ã¯ï½¤å‰å›ã®èª²é¡Œã§ã‚ã£ãŸ&lt;code&gt;setTimeout&lt;/code&gt;ãŒãªã‚“ã‹ãŠã‹ã—ã„ã®ã‚’ç›´ã—ã¾ã—ãŸï½¡
æœ¬å½“ã¯&lt;code&gt;Promise&lt;/code&gt;ã¾ã§ã‚¤ãƒƒã‚­ã«ã„ããŸã‹ã£ãŸãŒï½¤ã‚‚ã†ä¸€ç™ºå¤§æ”¹ä¿®ãŒå¿…è¦ãã†ã ã£ãŸã®ã§ä»Šå›ã¯è«¦ã‚ã¾ã—ãŸï½¡&lt;/p&gt;&lt;p&gt;ä»Šå›ã‚‚æ”¾æ˜ ã—ãŸ&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=D5ZkCvEomm4&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://i.ytimg.com/vi/D5ZkCvEomm4/maxresdefault.jpg&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=D5ZkCvEomm4&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;ãŠãŸããŒãƒœã‚½ãƒœã‚½å–‹ã‚ŠãªãŒã‚‰è¨€èªå®Ÿè£…ã™ã‚‹ written in OCaml 2&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;ã“ã‚Œã®å®Ÿè£…ç¶šã ã‚µãƒ ãƒã‚‚1ã¤å‰ã®ã‚„ã¤ https://nymphium.github.io/2020/05/03/nikkan-promise2.html&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ã¨ã“ã‚ã§ä¸­é€”åŠç«¯ã«&lt;code&gt;Base&lt;/code&gt;ã‚’ä½¿ã£ã¦ã„ãŸãŒï½¤ã„ã‚ˆã„ã‚ˆ&lt;code&gt;open Base&lt;/code&gt;ã—ãŸï½¡&lt;/p&gt;&lt;h1 id=&quot;2.+closure&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+closure&quot;&gt;2. closure&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å®Ÿè£…ã—ã¦ãªãã¦ï¾œï¾›ï¾€ãªã®ã§å®Ÿè£…ã—ãŸï½¡
ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã¨ã„ã†ã®ã¯ã§ã™ã­ãˆå¤‰æ•°ç’°å¢ƒã‚’closingã—ã¦ã„ã‚‹é–¢æ•°ã®ã“ã¨ã§ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;fãŒç’°å¢ƒ[{name: &quot;xâ€; value: 3}]ã‚’closingã—ã¦ã„ã‚‹&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ==&amp;gt; 3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;let&lt;/code&gt;ã«ã—ãŸå ´åˆ(å†…éƒ¨çš„ã«)reference cellã«ãªã‚‹ã®ã§å¤–å´ã‹ã‚‰æ›¸ãæ›ãˆãŒã§ãã¾ã™ãŒï½¤ä»Šå›ã®å®Ÿè£…ã¯JSã®ã‚µãƒ–ã‚»ãƒƒãƒˆã«ãªã£ã¦ãŠã‚Š&lt;code&gt;let&lt;/code&gt;ã¯omitã—ã¦ã„ã‚‹ã®ã§è€ƒãˆã¾ã›ã‚“ï½¡&lt;/p&gt;&lt;p&gt;ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ï½¤ã¾ãš&lt;em&gt;å®Ÿè¡Œæ™‚ã®å€¤&lt;/em&gt;ã‚’å®šç¾©ã™ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* ç¢ºã‹ã«ç’°å¢ƒã¯æŸç¸›ã•ã‚Œã¦ã„ã‚‹å¤‰æ•°ã¨ å®Ÿè¡Œæ™‚ã®å€¤ ã®ãƒšã‚¢ã®ãƒªã‚¹ãƒˆã§ã™ã­ *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runtime_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;list&lt;/span&gt;

&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runtime_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RNull&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RUnit&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RNum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;number&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RBuiltin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Closure&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Closure&lt;/code&gt; ä»¥å¤–ã¯ã‹ãªã‚Šä½œè€…éƒ½åˆã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã­ï½¡ã‚­ãƒ„ã„ï½¡
ãã—ã¦ãã‚Œã‚‰ã¨&lt;code&gt;value&lt;/code&gt;ã‚’ç›¸äº’ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®&lt;code&gt;value_of_rtv&lt;/code&gt;ã¨&lt;code&gt;rtv_of_value&lt;/code&gt;ã‚’å®šç¾©ã—ãŸï½¡
å¾Œè€…ã¯é–¢æ•°ã‹ã‚‰ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ä½œã‚‹ã¨ãã«ç’°å¢ƒã‚’æ³¨å…¥ã—ãŸã„ã®ã§&lt;code&gt;env&lt;/code&gt;ã‚’åŒæ™‚ã«å—ã‘å–ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* Value(Var(x)) -&amp;gt; lookup x env ãŒè¦ã‚‰ãªããªã£ãŸã‚“ã§ï½³ï¾šï½¼ *)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv_of_value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Closure&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env''&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bind_args&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env''&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv_of_value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env''&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;closingã—ãŸç’°å¢ƒã ã‘ã§ã‚„ã£ã¦ã„ãã®ã§ï½¤ç¾åœ¨ã®è©•ä¾¡ç’°å¢ƒã¯ä½¿ã„ã¾ã›ã‚“ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fun&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(**
   * const x = 5;
   * const f = (y) =&amp;gt; x + y;
   * const x = 10; // ãã‚‚ãã‚‚syntax errorã ãŒå¿µã®ãŸã‚
   * return f(12)
   *)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;f&quot;&lt;/span&gt;
          &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;y&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                 &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Op&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;y&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                 &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_program&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;equal_value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;17&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãƒ¨ã‚·!
â€¦â€¦ãã†ã„ãˆã°å†å¸°é–¢æ•°ãŒå®šç¾©ã§ããªã„ï½¡&lt;/p&gt;&lt;p&gt;closingã—ã¦ã„ã‚‹ç’°å¢ƒã«é–¢æ•°è‡ªèº«ã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï½¡
è‡ªèº«ãŒæŸç¸›ã•ã‚Œã‚‹å¤‰æ•°åã‚’æŒã£ã¦ãŠãå¿…è¦ã‚‚ã‚ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ã¾ï½¤ã¾ã‚ä»Šå›ã¯JSã®ã‚µãƒ–ã‚»ãƒƒãƒˆãªã‚“ã§å†å¸°é–¢æ•°ã¯å®Ÿè£…ã—ãªã„ã¨ã„ã†é€ƒã’ã®ä¸€æ‰‹ã§ã„ãã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;let-rec in&lt;/code&gt;ã®ã‚ˆã†ã«ç’°å¢ƒã‚’ä½œã‚‹å¤‰æ•°æŸç¸›ã ã£ãŸã‚‰ã‚·ãƒ¥ãƒƒã¨ã„ã‘ãŸã®ã«â€¦â€¦ï½¡&lt;/p&gt;&lt;h1 id=&quot;3.+%3Ccode%3EsetTimeout%3C%2Fcode%3E+%E3%82%92%E3%82%84%E3%82%8A%E3%81%AA%E3%81%8A%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86%E3%83%BC%EF%BD%BD%EF%BE%9A%EF%BE%8C%EF%BE%9F%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+%3Ccode%3EsetTimeout%3C%2Fcode%3E+%E3%82%92%E3%82%84%E3%82%8A%E3%81%AA%E3%81%8A%E3%81%97%E3%81%BE%E3%81%97%E3%82%87%E3%81%86%E3%83%BC%EF%BD%BD%EF%BE%9A%EF%BE%8C%EF%BE%9F%E3%81%A3%E3%81%BD%E3%81%84%E3%82%84%E3%81%A4&quot;&gt;3. &lt;code&gt;setTimeout&lt;/code&gt; ã‚’ã‚„ã‚ŠãªãŠã—ã¾ã—ã‚‡ã†ãƒ¼ï½½ï¾šï¾Œï¾Ÿã£ã½ã„ã‚„ã¤&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;å‰å›å•é¡Œã¨ã—ã¦æ®‹ã£ãŸã‚‚ã®ã¯&lt;code&gt;setTimeout&lt;/code&gt;ãŒåŒæœŸçš„ã«sleepã™ã‚‹ãŸã‚ã«ãªã‚“ã‚‚ã„ã„ã“ã¨ãŒãªã„ï½¤ã¨ã„ã†ã“ã¨ã§ã‚ã£ãŸï½¡&lt;/p&gt;&lt;p&gt;ã§ã¯ï½¤ã“ã†ã—ã¾ã—ã‚‡ã†ï½¡&lt;/p&gt;&lt;p&gt;ã¾ãšã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã‚’ä½œã‚‹ï½¡
&lt;code&gt;setTimeout&lt;/code&gt;ã«æ¸¡ã•ã‚ŒãŸé–¢æ•°ã‚’ã‚¹ãƒ¬ãƒ—ã«çªã£è¾¼ã‚€ï½¡
nãƒã‚¤ã‚¯ãƒ­ç§’ãšã¤sleepã—ã¦ã‹ã‚‰pendingï½¤nãƒã‚¤ã‚¯ãƒ­ç§’ãšã¤sleepã—ã¦ã‹ã‚‰pendingã‚’ç¹°ã‚Šè¿”ã™ï½¡
pendingã—ãŸã‚‰ã‚‚ã¨ã®å®Ÿè¡Œã«æˆ»ã‚‹ï½¡
åˆè¨ˆã—ã¦&lt;code&gt;setTimeout&lt;/code&gt;ã«æ¸¡ã•ã‚ŒãŸæ™‚é–“ã ã‘sleepã—ãŸã‚‰ï½¤æ¸¡ã•ã‚ŒãŸé–¢æ•°ã‚’å®Ÿè¡Œã—ï½¤çµ‚äº†ï½¡&lt;/p&gt;&lt;p&gt;ã‚¹ãƒ¬ãƒ—ã«ãƒ„ãƒƒã‚³ã¾ã‚Œã‚‹&quot;ã‚¹ãƒ¬ãƒƒãƒ‰&quot;ã¯ä»¥ä¸‹ã®å€¤ã‚’è¿”ã™thunkã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread_status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runtime_value&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Pending&lt;/code&gt;ã«OCamlãƒ¬ãƒ™ãƒ«ã®é–¢æ•°ã‚’æ¸¡ã™ã“ã¨ã§ï½¤ã„ã„æ„Ÿã˜ã«sleepã‚’èµ°ã‚‰ã›ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï½¡
ã‚¹ãƒ¬ãƒ—ã¯ã“ã®thunkãŒãƒ„ãƒƒã‚³ã¾ã‚ŒãŸã‚­ãƒ¥ãƒ¼ã«ãªã£ã¦ã„ã‚‹ï½¡
&lt;code&gt;Thread_pool&lt;/code&gt;ãŒã‚¹ãƒ¬ãƒ—ã‚’å®Ÿè£…ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹ï½¡
ã‚­ãƒ¥ãƒ¼è‡ªä½“ã¯éš è”½ã•ã‚Œã¦ã„ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;å‰å›å®šç¾©ã—ãŸ&lt;code&gt;builtin&lt;/code&gt;ã‚’æ‹¡å¼µã—ï½¤ä»¥ä¸‹ã®ã‚ˆã†ã«é–¢æ•°ã‚’ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã™ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* ç¡çœ æ™‚é–“ã®æœ€å°å˜ä½ 20ms *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait_unit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtvs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nth_exn&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtvs&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value_of_rtv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;number_of_value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;(* ã‚„ã¯ã‚Šã‚«ãƒªãƒ¼åŒ–ã‚’ã‚„ã‚ãŸï½¡ç¬¬2å¼•æ•°ã«é–¢æ•°ã‚’å—ã‘å–ã‚‹ï½¡ *)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nth_exn&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtvs&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;(* ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãŒå½¹ã«ç«‹ã£ãŸğŸ˜ƒ ã¨ã‚Šã‚ãˆãšå¼•æ•°ã¯æ¨ã¦ã‚‹ï½¡ *)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Closure&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;c&quot;&gt;(* refã«ã¤ã£ã“ã‚€ *)&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ref&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;of_int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Thread_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enqueue&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;(* ãƒˆãƒ©ãƒ³ãƒãƒªãƒ³åŒ–ã®ã‚ˆã†ãªå½¢ã«ãªã£ã¦é¢ç™½ã„ï½¡ã“ã®é–¢æ•°ã‚’ã‚¹ãƒ¬ãƒ—ã«çªã£è¾¼ã‚€ï½¡ *)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;(* wait_unitç§’sleepã™ã‚‹ *)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Unix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleepf&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait_unit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
          &lt;span class=&quot;c&quot;&gt;(* æœ€æ‚ª19msä½™è¨ˆã«sleepã™ã‚‹ãŒï½¤ç²¾åº¦ã¯ãã‚“ãªã«ç²¾å¯†ã§ã‚ã‚‹å¿…è¦ã¯ãªã„ *)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait_unit&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Float&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RUnit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;nc&quot;&gt;RUnit&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failwith&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;second value of setTimeout should be a function&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã‚¹ãƒ¬ãƒ—ã‹ã‚‰ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’1ã¤å–ã‚Šå‡ºã—ã¦å®Ÿè¡Œã—ï½¤pendingã—ãŸã‚‰ã¾ãŸã‚¹ãƒ¬ãƒ—ã«æˆ»ã™ï½¤ã¨ã„ã†æ“ä½œã‚’&lt;code&gt;eval_exp&lt;/code&gt;1å›ã”ã¨ã«ãŠã“ãªã†ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Thread_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;eval_exp&lt;/code&gt;1å›ã‚ãŸã‚Šã®è©•ä¾¡æ™‚é–“ã‚’ç„¡è¦–ã—ã¦ã„ã‚‹ãŒï½¤ç„¡è¦–ã—ã¦ã„ã‚‹å®Ÿè¡Œæ™‚é–“ã«ã‚ˆã‚ŠsleepãŒã©ã‚“ã©ã‚“ã‚ºãƒ¬ã¦ã„ãã“ã¨ã«ãªã‚‹ãŒï½¤ã¾ã‚ã“ã®æ–¹æ³•ã§ã¯ä»•æ–¹ãªã„ï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;Thread_pool.run&lt;/code&gt;ã¯ã“ã‚“ãªæ„Ÿã˜ã«optionalã«&lt;code&gt;Done&lt;/code&gt;ã®æŒã¤å€¤ã‚’è¿”ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* ã‚­ãƒ¥ãƒ¼ã®å…ˆé ­ã‚’å–ã‚Šå‡ºã—ï½¤ *)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dequeue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;(* pendingã—ã¦ã„ãŸã‚‰ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ°ã‚‰ã›ã¦çµæœã‚’ã‚­ãƒ¥ãƒ¼ã‚¤ãƒ³ã‚°ã™ã‚‹ï½¡ *)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enqueue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã—ã‹ã—ã“ã‚Œã ã‘ã ã¨ï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;world&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¨ã„ã†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ãŸã¨ãã«ï½¤(500/20=)25å›ã‚‚å¼ã‚’è©•ä¾¡ã—ãªã„ãŸã‚ï½¤&lt;code&gt;setTimeout&lt;/code&gt;ã«æ¸¡ã•ã•ã‚ŒãŸé–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œãªã„ï½¡
ã§ã¯ã©ã†ã™ã‚‹ã‹?&lt;/p&gt;&lt;p&gt;ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰ï½¤ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã«å…¥ã£ã¦ã„ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå…¨ã¦&lt;code&gt;Done&lt;/code&gt;ã«ãªã‚‹ã¾ã§èµ°ã‚‰ã›ã‚Œã°è‰¯ã„ã§ã—ã‚‡ã†ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_program&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Thread_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run_all&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* å®Ÿè¡Œä¸–ç•Œã‹ã‚‰å¸°ã‚‹ã®ã§ã¨ã‚Šã‚ãˆãšå¤‰æ›ã—ã¦ã„ã‚‹ãŒâ€¦â€¦ *)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;value_of_rtv&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Thread_pool.run_all&lt;/code&gt;ã¯ã“ã‚“ãªã‹ã‚“ã˜&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_all&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;is_empty&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_all&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãƒ†ã‚¹ãƒˆã—ã¾ã™ã‚ˆãƒ¼ãƒ†ã‚¹ãƒˆ&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expect_test&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(**
   * const x = 100;
   * setTimeout(() =&amp;gt; console.log(x), 2000);
   * console.log(500);
   * setTimeout(() =&amp;gt; console.log(40), 500);
   *)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt;
                      &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;
             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
             &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;
                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;
                      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt;
                      &lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
               &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_program&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ignore&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;expect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¨™æº–å‡ºåŠ›ã®ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«&lt;a href=&quot;https://github.com/janestreet/ppx_expect&quot;&gt;&lt;code&gt;ppx_expect&lt;/code&gt;&lt;/a&gt;ã‚’ä½¿ã£ãŸï½¡
ã“ã„ã¤ãã™ã’ãˆã‚„ï½¡&lt;/p&gt;&lt;h1 id=&quot;4.+Promise%EF%BD%A4%E3%82%86%EF%BD%A4%E5%8F%8B%E3%81%98%E3%82%87%E2%80%A6%E2%80%A6&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+Promise%EF%BD%A4%E3%82%86%EF%BD%A4%E5%8F%8B%E3%81%98%E3%82%87%E2%80%A6%E2%80%A6&quot;&gt;4. Promiseï½¤ã‚†ï½¤å‹ã˜ã‚‡â€¦â€¦&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã‚¹ãƒ¬ãƒ—ã§ããŸã—ã‚‚ã†å‹¢ã„ã§&lt;code&gt;Promise&lt;/code&gt;å®Ÿè£…ã‚„ã£ã¡ã‚ƒã†ã‹ãƒ¼!!
ã¨æ€ã£ãŸã‚“ã§ã™ãŒãƒ€ãƒ¡ãã†ãªã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;new Promise&lt;/code&gt;ãŒè¿”ã™å®Ÿè¡Œæ™‚ã®å€¤ã¨ã—ã¦&lt;code&gt;RPromise&lt;/code&gt;ã‚’è¿½åŠ ã—ã¾ã™ï½¡
&lt;code&gt;Promise&lt;/code&gt;ãŒã‚¹ãƒ¬ãƒ—ã«ãƒ„ãƒƒã‚³ã¾ã‚Œã‚‹ã®ã§ï½¤ã‚¹ãƒ¬ãƒƒãƒ‰ã«å¯¾å¿œã™ã‚‹UUIDã‚’è¿”ã™ï½¡
ã¨ã“ã‚ã§UUIDã¯å†…éƒ¨ã§&lt;code&gt;core_kernel&lt;/code&gt;ã‚’ä½¿ã£ã¦ã„ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;runtime_repr.ml&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runtime_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RPromise&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;é€†ã«ã‚¹ãƒ¬ãƒ—ã«ã¯ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ãã‚Œã®UUIDã®tupleã‚’çªã£è¾¼ã‚€ï½¡
å¯¾å¿œã™ã‚‹UUIDã‚’è¿”ã™ã“ã¨ã§ï½¤&lt;code&gt;await&lt;/code&gt;ã§ã‚¹ãƒ¬ãƒ—ã‹ã‚‰å¯¾å¿œã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä¸€æ°—ã«èµ°ã‚‰ã›ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;thread_pool.ml&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;Uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread_status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;enqueue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enqueue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th'&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o_th&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Uuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;equal&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;q&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;o_th&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pending&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failwith&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;no such id&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ã‚ã¨ã¯ã‚„ã‚‹ã ã‘!w
ã¨æ€ã£ãŸã®ã§ã™ãŒâ€¦â€¦&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;eval_exp&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;  &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Promise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Constructor&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Unit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Thread_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;enqueue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Done&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
        &lt;span class=&quot;nc&quot;&gt;RPromise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failwith&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;this is not callable object&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Wait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;RPromise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Thread_pool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wait&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uuid&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rtv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ã†ã¾ãã„ã‹ãªã„ï½¡
ã¨ã‚Šã‚ãˆãšï½¤&lt;code&gt;Promise(Constructor(-))&lt;/code&gt;ã«æ¸¡ã•ã‚Œã‚‹ã‚‚ã®ãŒé–¢æ•°ãƒ¼ã•ã‚‰ã«ä»Šå›ã¯æ‰‹æŠœãã§é–¢æ•°&lt;em&gt;ãƒªãƒ†ãƒ©ãƒ«&lt;/em&gt;ã«åˆ¶é™ã—ã¦ã„ã‚‹ãƒ¼ã®å ´åˆã«ãã‚Œã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã—ã¦ã‚¹ãƒ¬ãƒ—ã«çªã£è¾¼ã¿ï½¤å¯¾å¿œã™ã‚‹UUIDã‚’&lt;code&gt;RPromise&lt;/code&gt;ã«åŒ…ã‚“ã§å®Ÿè¡Œæ™‚ã®å€¤ã«ã—ã¦è¿”ã™ï½¡
&lt;code&gt;Wait&lt;/code&gt;ã¯ãã®ã¾ã¾&lt;code&gt;Thread_pool.wait&lt;/code&gt;ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã«ãªã£ã¦ã„ã‚‹ï½¡
&lt;code&gt;Promise&lt;/code&gt;ä»¥å¤–ã‚’&lt;code&gt;await&lt;/code&gt;ã™ã‚‹ã¨ãã¯JSã¨åŒã˜ã‚ˆã†ã«ã‚µãƒƒã¨æµã™ï½¡
ãã†ã„ãˆã°ã“ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã«ã¯é…åˆ—ãŒãªã„ã®ã§&lt;code&gt;Promise(All(-))&lt;/code&gt;ã¯ã—ã‚Œã£ã¨æ¶ˆã—ãŸï½¡&lt;/p&gt;&lt;p&gt;ã—ã‹ã—ã“ã‚Œã§ã¯ã†ã¾ãã„ã‹ãªã„ï½¡
&lt;code&gt;Wait&lt;/code&gt;ãŒã†ã¾ãproimiseã‚’å¾…ã£ã¦ãã‚Œãªã„ï½¡
ã“ã‚Œã¯ã¾ã‚ã¾ã‚æ¤œè¨ãŒã¤ã„ã¦ã„ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;JSã®&lt;code&gt;Promise&lt;/code&gt;ã‚’æ€ã„å‡ºã—ã¦ã¿ã‚‹ã¨ï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;promise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;world&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãã†ã„ãˆã°&lt;code&gt;resolve&lt;/code&gt;ã¨ã‹ã„ã†ã‚„ã¤ã‚ã£ãŸãªï½¡
ä¸Šè¨˜ã®JSãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§&lt;code&gt;resolve&lt;/code&gt;ã‚’&lt;code&gt;setTimeout&lt;/code&gt;å†…ã§å‘¼ã°ãªã„ã¨çµæ§‹é¢ç™½ã„çµæœãŒå¾—ã‚‰ã‚Œã‚‹ï½¡
â€¦â€¦ã©ã†ã§ã™ã‹? çµæœã¯500ãƒŸãƒªç§’ã®æ²ˆé»™ã®ã®ã¡ã«&lt;code&gt;hello&lt;/code&gt;ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã®ã¿ã§ã‚ã‚‹ï½¡
&lt;code&gt;await&lt;/code&gt;ã¯ä½•ãªã®ã‹ã‚’æ€ã„å‡ºã—ã¦ã¿ã‚‹ã¨ï½¤&lt;code&gt;await&lt;/code&gt;ã‚’ä½¿ã‚ãªã‘ã‚Œã°ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰å½¢ã§ãã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;promise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;setTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;nx&quot;&gt;promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;world&lt;/span&gt;&lt;span class=&quot;dl&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¾ã‚‹ã§&lt;code&gt;call/cc&lt;/code&gt;ã ãªï½¡
å®Ÿéš›ã®ã¨ã“ã‚ã¯ç¾åœ¨ã®scopeå†…ã®é™å®šç¶™ç¶šã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã®ã ãŒï½¡&lt;/p&gt;&lt;p&gt;ãµãƒ¼ã‚€ï½¤æŒ¯ã‚Šè¿”ã‚‹ã¾ã§ã‚‚ãªãã“ã®ã‚ˆã†ãªæŒ™å‹•ã«ã¯ãªã£ã¦ãªã„ï½¡
å‰å›ã¯ï½¢statementã®æ®‹ã‚Šã“ããŒç¶™ç¶šã§ã‚ã‚‹ï½£ã¨è¨€ã£ãŸãŒï½¤ã¾ã•ã«ã“ã‚Œã‚’åˆ©ç”¨ã™ã¹ãã§ï½¤&lt;code&gt;Promise&lt;/code&gt;å†…ã§&lt;code&gt;resolve&lt;/code&gt;ã®ã‚ˆã†ãªã‚‚ã®ã‚’å‘¼ã‚“ã ã‚‰&quot;ã“ã®æ®‹ã‚Šã®statement&quot;ã‚’è©•ä¾¡ã™ã‚Œã°ã‚ˆã„ï½¡&lt;/p&gt;&lt;p&gt;ã“ã‚Œã¯æ¬¡å›ã ãªï½¡
æœ¨æ›œã¯æœ‰çµ¦å–ã£ã¦ãªã„ã‚“ã§ã™ãŒä»Šã£ã¦æœ¨æ›œã®åˆå‰4æ™‚â€¦â€¦&lt;/p&gt;&lt;h1 id=&quot;5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;5. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;pending&lt;/p&gt;</description>
        <pubDate>Wed, 06 May 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/05/06/nikkan-promise3.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/05/06/nikkan-promise3.html</guid>
        
        <category>æ—¥åˆŠPromise</category>
        
        <category>JavaScript</category>
        
        
      </item>
    
      <item>
        <title>æ—¥åˆŠPromise(2) ã¨ã‚Šã‚ãˆãšPromiseã‚’ç½®ã„ã¦ã‘ã¼ã‚Šã«ã—ã¦è©•ä¾¡å™¨ã‚’å®Ÿè£…ã™ã‚‹</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/05/04/nikkan-promise2/thumb.png"></enclosure>
        <description>&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;1. ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
æ˜¨æ—¥ã®ç¶šãã‹ã‚‰ï½¤ã¨ã‚Šã‚ãˆãšè©•ä¾¡å™¨ã‚’å®Ÿè£…ã—ã¾ã™ï½¡
statement-basedã®è¨€èªã‚’å®Ÿè£…ã—ãŸã“ã¨ãŒã‚ã¾ã‚Šãªã„ã®ã§ï½¤ã¨ã‚Šã‚ãˆãšPromiseã®ã“ã¨ã‚’è€ƒãˆãšã«ã„ãã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ãªã‚“ã¨ãªãä½œæ¥­ã‚’æ”¾æ˜ ã—ãŸã®ã§æœ¬å½“ã«æš‡ãªäººã—ã‹è¦‹ãªã„ã§ãã ã•ã„ï½¡çµ¶å¯¾ã«è™šç„¡æ„Ÿã«è¥²ã‚ã‚Œã¦ã—ã¾ã„ã¾ã™ï½¡
&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=Omquszj_SPw&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;/pictures/no_image.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=Omquszj_SPw&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;YouTube&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;YouTube ã§ãŠæ°—ã«å…¥ã‚Šã®å‹•ç”»ã‚„éŸ³æ¥½ã‚’æ¥½ã—ã¿ã€ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å‹ã ã¡ã‚„å®¶æ—ã€ä¸–ç•Œä¸­ã®äººãŸã¡ã¨å…±æœ‰ã—ã¾ã—ã‚‡ã†ã€‚&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;h1 id=&quot;2.+%E5%AE%9F%E8%A3%85&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+%E5%AE%9F%E8%A3%85&quot;&gt;2. å®Ÿè£…&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã•ã£ããã‚„ã£ã¦ã„ãï½¡&lt;/p&gt;&lt;p&gt;å®Ÿè£…ã®å…¨ä½“ã¯ã‚³ãƒãƒ©&lt;/p&gt;&lt;div class=&quot;github-widget&quot; data-repo=&quot;nymphium/acom&quot;&gt;&lt;/div&gt;&lt;p&gt;ãƒªãƒã‚¸ãƒˆãƒªåã®acomã¯&quot;promise&quot;ã‹ã‚‰é€£æƒ³ã—ã¾ã—ãŸ(?)ï½¡&lt;/p&gt;&lt;p&gt;è©•ä¾¡å™¨ã‚’å®Ÿè£…ã™ã‚‹å‰ã«ï½¤syntaxã«ã„ãã¤ã‹å¤‰æ›´(è¿½åŠ )ãŒã‚ã£ãŸã®ã§è¨€åŠã‚¹ãƒ«ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;å‰å›ã‹ã‚‰ã®diff&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt;&lt;span class=&quot;gd&quot;&gt;-(* non-empty list *)
-type 'a nlist =
-  | Head of 'a
-  | Tail of 'a * 'a nlist
-
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ã‚„ã£ã±ã‚Šsyntaxã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«ã“ã‚ŒãŒã‚ã‚‹ã®ã¯ã‚¦ã‚±ã¦ã¾ã†ã‚“ã§åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«(ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«)ã«ç§»å‹•ã—ãŸï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-diff&quot; data-lang=&quot;diff&quot;&gt; type binop =
   | Add
   | Minus
&lt;span class=&quot;p&quot;&gt;@@ -19,18 +14,24 @@&lt;/span&gt; type variable = string
  * n     âˆˆ Numebrs
  * x     âˆˆ Variables
  * v    := n
&lt;span class=&quot;gi&quot;&gt;+ *       | x
&lt;/span&gt;  *       | function(x* ) { stmt+ }
&lt;span class=&quot;gi&quot;&gt;+ *       | null
+ *       | ()
&lt;/span&gt;  *)
 type value =
   | Num of number
&lt;span class=&quot;gi&quot;&gt;+  | Var of variable
&lt;/span&gt;   | Builtin of builtin
&lt;span class=&quot;gi&quot;&gt;+  | Null
+  | Unit
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤‰æ•°å®šç¾©ã—å¿˜ã‚Œã¦ãƒ¯ãƒ­ã¦ã¾ã†ã‚
ã‚ã¨&lt;code&gt;null&lt;/code&gt;ã«åŠ ãˆã¦&lt;code&gt;unit&lt;/code&gt;ã‚’è¿½åŠ ã—ã¦ãŠã„ãŸ(OCamlè„³)ï½¡&lt;/p&gt;&lt;p&gt;ãƒ¨ã‚·! ã„ã„æ„Ÿã˜ã ãªï½¡
ã§ã¯æ¬¡è¡Œã£ã¦ã¿ã‚ˆã†ï½¡
expressionã®evalã‚’å®Ÿè£…ã—ã¦ï½¤ãã‚Œã‚’å‘¼ã³å‡ºã™statementsã®evalã‚’å®Ÿè£…ã¨ã„ã†æµã‚Œï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* val eval_exp : (variable * value) list -&amp;gt; exp -&amp;gt; value *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;rec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lookup&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;binop&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¯ã„ãƒãƒƒãƒã—ã¾ã—ãŸï½¡
ã“ã®è¾ºã¯è§£èª¬ã™ã‚‹ã¾ã§ã‚‚ãªã„ã§ã™ã­ï½¡
å¤‰æ•°ãŒvalueãªã®ã¯ãªã‚“ã‹ãƒŸã‚¹ã£ãŸãªãƒ¼ã¾ã‚ã„ã„ã‚„ï½¡
&lt;code&gt;binop&lt;/code&gt; é–¢æ•°ã¯é©å½“ã« &lt;code&gt;Add | Mul | Minus&lt;/code&gt; ã‚’ãã‚Œãã‚Œå¯¾å¿œã™ã‚‹ç®—è¡“ã«mapã™ã‚‹ã‚„ã¤ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;é–¢æ•°ã®å®Ÿè£…ã‚‚ã¾ã‚ãƒŠã‚¤ãƒ¼ãƒ–ãªå®Ÿè£…ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;eval_expã¤ã¥ã&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bind_args&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;body&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failwith&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;this is not callable object&quot;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;user-definedãªé–¢æ•°ã¨çµ„ã¿è¾¼ã¿é–¢æ•°ã®å‘¼ã³å‡ºã—ã§åˆ†å²ã™ã‚‹ï½¡
&lt;code&gt;import&lt;/code&gt;ã¨ã‹ã¯ä»Šå›ç„¡ã„ã‚“ã§é–¢æ•°ã®ãƒœãƒ‡ã‚£ã¯ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã¨åŒæ§˜statement listã«ãªã£ã¦ã„ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ã‚¸ãƒ£ãƒã‚¹ã‚¯ãªã‚“ã§ã‚«ãƒªãƒ¼åŒ–ã¯ã•ã‚Œã¦ãŠã‚‰ãšï½¤å¼•æ•°ã¯expression listã§å—ã‘å–ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;bind_args&lt;/code&gt; ã¯ä»®å¼•æ•°ã¨å®Ÿå¼•æ•°ã‚’assoc listã«ã—ã¦ç’°å¢ƒã«çªã£è¾¼ã‚€é–¢æ•°ï½¡
ã‚¸ãƒ£ãƒã‚¹ã‚¯ã§å¼•æ•°ãŒè¶³ã‚Šãªã„ã¨ãã£ã¦ã©ã†ãªã‚‹ã‚“ã‚„ã£ã‘?
ã©ã†ã›ã¶ã£å£Šã‚Œè¨€èªãªã®ã§ï½¤ã¨ã‚Šã‚ãˆãš&lt;code&gt;null&lt;/code&gt;ã‚’åŸ‹ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;bind_argsã®å®Ÿè£…&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bind_args&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;combine&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
       &lt;span class=&quot;nn&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Null&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xl&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vl&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt;
        &lt;span class=&quot;nn&quot;&gt;Base&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;take&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;xl&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;&lt;code&gt;eval_exp&lt;/code&gt; ã«æˆ»ã‚Šã¾ã™ãŒï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;eval_expãŠã‚ã‚Š&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Promise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;failwith&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;undefined&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ä»Šå›ã¯æœ¬ä¸¸ã®promiseã‚’å®Œå…¨ã«ç„¡è¦–ã—ã¦ãç”·&lt;/p&gt;&lt;p&gt;æ®‹ã‚Šã® &lt;code&gt;eval_stmts&lt;/code&gt; ã¯é–¢æ•°ã®å®Ÿè£…ã§ã‚‚åˆ©ç”¨ã™ã‚‹ã®ã§ &lt;code&gt;eval_exp&lt;/code&gt; ã¨ç›¸äº’å†å¸°ã«ãªã£ã¦ã„ã‚‹ï½¡
ã“ã®å®Ÿè£…ã¯statement listãŒç©ºã®å ´åˆã‚’è¨±ã•ãªã„ç‹¬è‡ªå®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(* val eval_stmts : stmt Nlist.t -&amp;gt; (variable * value) list -&amp;gt; value *)&lt;/span&gt;
&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;End&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Unit&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ«å°¾ãŒ&lt;code&gt;return&lt;/code&gt;ã®å ´åˆã«ãã®expressionã®çµæœã‚’è¿”ã—ï½¤ä»–ã¯unitã‚’è¿”ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;eval_stmtsç¶šã&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tl&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env'&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eval_exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;å‰å›ã¯ï½¢&lt;code&gt;return&lt;/code&gt;ä½¿ã£ã¦è©•ä¾¡è„±å‡ºã™ã‚‹ãªã‚‰CPSã˜ã‚ƒãªãã‚ƒã‚¸ãƒ£ãƒ³ï½£ã¨ã¯è¨€ã£ãŸãŒï½¤å®Ÿéš›ã®ã¨ã“ã‚ã¯ç¶šãstatementsãŒå®Ÿè³ªcontinuationã«ãªã£ã¦ã„ã‚‹ãŸã‚ï½¤&lt;code&gt;Return&lt;/code&gt;ã®å®Ÿè£…ã§ã¯æ®‹ã‚Šã®statementsã‚’æ¨ã¦ã‚Œã°è‰¯ã„ï½¤ã¨ã„ã†æ°—ä»˜ããŒã‚ã£ãŸï½¡
statements-basedãªè¨€èªã®å®Ÿè£…ã‚‚ï½¤ç°¡å˜ã§ã™!&lt;/p&gt;&lt;p&gt;ç’°å¢ƒã¯ã¨ã‚Šã‚ãˆãšå¤–ã‹ã‚‰æ³¨å…¥ã™ã‚‹äºˆå®šãŒãªã„ã‚“ã§ï½¤é©å½“ã«ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’ä½œã£ã¦ãŠãï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_program&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eval_stmts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&quot;3.+%E3%83%86%E3%82%B9%E3%83%88&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+%E3%83%86%E3%82%B9%E3%83%88&quot;&gt;3. ãƒ†ã‚¹ãƒˆ&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;OCamlã§ãƒ†ã‚¹ãƒˆã¨ã„ãˆã°OUnitã ã£ãŸã¨æ€ã†ã‚“ã§ã™ãŒï½¤ä»Šå›ã¯&lt;code&gt;ppx_inline_test&lt;/code&gt;ã‚’ä½¿ã£ãŸã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(**
   * (setTimeout(5000))(() =&amp;gt; {
   *   console.log(100);
   * });
   *)&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; 
     &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))])&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
         &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))]))]))]))]&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run_program&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmts&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Unit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‹æ‰‹ã«&lt;code&gt;setTimeout&lt;/code&gt;ã‚’é«˜éšã«ã—ãŸã‘ã©ç‰¹ã«è‰¯ã„ã“ã¨ãªã‹ã£ãŸãœï½¡
ãªã‚“ã‹å‹•ã„ã¦ã‚‹ã£ã½ã„ã‚“ã§ãƒ¨ã‚·! ã§ã™ãŒå®Ÿéš›ã¯ã‚ã¾ã‚Šã‚ˆããªã„ï½¡
çµ„ã¿è¾¼ã¿é–¢æ•°ã‚’ã©ã†ã«ã‹ã™ã‚‹å®Ÿè£…ã¯ã“ã¡ã‚‰ãªã‚“ã§ã™ãŒï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coerce_number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nth&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vs&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Unix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sleepf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;float_of_int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/.&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;(* (f) =&amp;gt; { f(); } *)&lt;/span&gt;
    &lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;Nlist&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Var&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;f&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;......&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãªã‚“ã‹ã¡ã‚ƒã†ã‚ˆãªâ€¦â€¦ï½¡
ã“ã‚Œã ã¨åŒæœŸçš„ã«sleepã—ã¦ã¾ã†ã‚“ã§ä½•ã‹å¯¾ç­–ã‚’è¬›ã˜ãŸã„ï½¡
Lwtã‹ãªã‚“ã‹ä½¿ã£ã¡ã‚ƒã„ã¾ã™ã‹? ã§ã‚‚ãã‚Œã¯ã¡ã‚‡ã£ã¨é•ã†ã˜ã‚ƒãªã„ã§ã™ã‹ï½¡
ç¡çœ æ™‚é–“ã‚’ç´°åˆ‡ã‚Œã«ã—ã¦ã‚¹ãƒ¬ãƒƒãƒ‰ãƒãƒãƒ¼ã‚¸ãƒ£ãŒåº¦ã€…å•ã„åˆã‚ã›ã‚‹ã¿ãŸã„ãªæ„Ÿã˜ã§ã‚„ã‚‹ã‹ï½¡
ã“ã‚Œã¯æ¬¡å›ã¨ã„ã†ã“ã¨ã§ï½¤ä»Šå›ã¯ã“ã®è¾ºã§ï½¡&lt;/p&gt;&lt;h1 id=&quot;4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;4. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã¨ã‚Šã‚ãˆãšè¨€èªã®å®Ÿè£…ã®ä½“è£ã¯å–ã‚Œã¦ããŸãŒï½¤è‚å¿ƒã®promiseã«ã¯ã¾ã ã¾ã å±Šã„ã¦ã„ã¾ã›ã‚“ï½¡
ã“ã‚Œã‹ã‚‰ç§ã©ã†ãªã£ã¡ã‚ƒã†ã®ã€œã€œ?&lt;/p&gt;</description>
        <pubDate>Mon, 04 May 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/05/04/nikkan-promise2.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/05/04/nikkan-promise2.html</guid>
        
        <category>æ—¥åˆŠPromise</category>
        
        <category>JavaScript</category>
        
        
      </item>
    
      <item>
        <title>æ—¥åˆŠPromise(1) åˆå›ã¯å¬‰ã—ã„ASTã®å®šç¾©ä»˜ã</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/05/03/nikkan-promise1/thumb.png"></enclosure>
        <description>&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;1. ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
æœ€è¿‘ã¯ç¥çµµå¸«ã«ãªã£ã¦ã—ã¾ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒæ€§ãŒè–„ã‚Œã¦ãã¦ãƒã‚ºã„ã®ã§æ‰‹æ…£ã‚‰ã—ã«ãªã‚“ã‹ã‚„ã‚ã†ã¨æ€ã£ã¦ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¦ã‚£ãƒ¼ã‚¯ãªã‚“ã§è„³ã‚’ã—ã£ã‹ã‚Šä½¿ãˆã‚‹çŸ¥è‚²ç©å…·ã¨ã„ã†ã“ã¨ã§Promiseã‚’å«ã‚€JavaScriptã®ã‚µãƒ–ã‚»ãƒƒãƒˆã‚’å®Ÿè£…ã—ã‚ˆã†ã‹ãªã¨æ€ã„ã¾ã™(ãŠãŸãæ—©å£)ï½¡&lt;/p&gt;&lt;p&gt;ã¨ã‚Šã‚ãˆãšå‹˜ã§ã‚„ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ï½¡&lt;/p&gt;&lt;h1 id=&quot;2.+Promise%E3%81%AF%E3%81%A9%E3%81%86%E3%81%84%E3%81%A3%E3%81%9F%E9%9B%B0%E5%9B%B2%E6%B0%97%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B%3F&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+Promise%E3%81%AF%E3%81%A9%E3%81%86%E3%81%84%E3%81%A3%E3%81%9F%E9%9B%B0%E5%9B%B2%E6%B0%97%E3%81%A7%E3%81%97%E3%82%87%E3%81%86%E3%81%8B%3F&quot;&gt;2. Promiseã¯ã©ã†ã„ã£ãŸé›°å›²æ°—ã§ã—ã‚‡ã†ã‹?&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã¨ã‚Šã‚ãˆãšå‹˜ã§é€²ã‚ã‚‹ã‚“ã§ï½¤å‹˜ã§è€ƒãˆã¾ã™ï½¡
Promiseã¯ä¸¦è¡Œï½¥éåŒæœŸå‡¦ç†ã®ãŸã‚ã®æ©Ÿèƒ½ã§ã™ã­ï½¡
ã¨ã‚Šã‚ãˆãšã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã«çªã£è¾¼ã‚“ã§ãŠã‘ã°è‰¯ã„ã‚“ã§ã—ã‚‡ï½¤ã‚ã‹ã‚‹ã‚ã‹ã‚‹
ï½½ï¾šï¾Œï¾Ÿã‹ã‚‰1ã¤promiseã‚’popã—ã¦ï½¤pendingã—ãŸã‚‰æ–°ãŸã«popã—ãŸã‚ã¨pendingã—ãŸã‚‚ã®ã‚’pushã—ã¦ï½¤â€¦â€¦ã¨ã„ã†æ„Ÿã˜ã§ã„ã‘ã°è‰¯ã„æ°—ãŒã™ã‚‹ï½¡
ãƒ¨ã‚·ï½¤ã‚ã¨ã¯ã‚„ã‚‹ã ã‘ã ï½¡&lt;/p&gt;&lt;p&gt;ã“ã“ã«å®Ÿè£…ã‚’ç½®ã„ã¦ã„ãï½¡&lt;/p&gt;&lt;div class=&quot;github-widget&quot; data-repo=&quot;nymphium/acom&quot;&gt;&lt;/div&gt;&lt;h1 id=&quot;3.+%E6%A7%8B%E6%96%87&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+%E6%A7%8B%E6%96%87&quot;&gt;3. æ§‹æ–‡&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;åˆå›ãªã®ã§æ§‹æ–‡ã‚’è€ƒãˆã‚ˆã†ï½¡
å…·ä½“æ§‹æ–‡ã¯æ„Ÿå¿ƒãŒãªã„ã‚“ã§æœ€å¾Œã®æœ€å¾Œ(ã‚ã‚‹ã„ã¯ã‚„ã‚‰ãªã„)ã§ã„ã„ã§ã—ã‚‡ã†ï½¡&lt;/p&gt;&lt;p&gt;ã¾ãšã¯å€¤ã‹ã‚‰ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(**
 * n     âˆˆ Numebrs
 * x     âˆˆ Variables
 * v    := n
 *       | function(x* ) { stmt+ }
 *)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;number&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;string&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Num&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;number&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Fun&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;list&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nlist&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Builtin&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯åº¦ä½•åº¦ã‚‚&lt;code&gt;let-in&lt;/code&gt;ã‚’æ›¸ããƒ—ãƒ­ã‚°ãƒ©ãƒ è¨€èªã‚’ä½œã‚‹ã®ã‚‚é£½ããŸ&lt;sup id=&quot;fnref1&quot; title=&quot;æ›¸ãã®ã¯é£½ãã¦ãªã„ã—ã‚€ã—ã‚ã‚¸ãƒ£ãƒã‚¹ã‚¯ã«ã‚‚let-inå…¥ã‚Œã‚ã¨ã„ã†ã‹ã‚‚ã†ã‚¸ãƒ£ãƒã‚¹ã‚¯æ›¸ããŸãªã„ã§ã™â€¦â€¦Â &quot;&gt;&lt;a href=&quot;#fn1&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;ã®ã§statement-list basedãªæ§‹æ–‡ã«ã—ã¾ã™ï½¡
ã—ãŸãŒã£ã¦å¾Œè¿°ã®ã¨ãŠã‚Š&lt;code&gt;return&lt;/code&gt;ãŒã‚ã‚‹ã®ã§ï½¤ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿ãŒCPSã«ãªã‚‹ã®ãŒã™ã§ã«æ˜ã‚‰ã‹ãã†ã§ã™ãªï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;builtin&lt;/code&gt;ã¯çµ„ã¿è¾¼ã¿ã®å®šæ•°ã‚’çªã£è¾¼ã‚€ã‚¹ãƒšãƒ¼ã‚¹ï½¡
ã¨ã‚Šã‚ãˆãšãªã‚“ã‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ å‹•ã„ã¦ã‚‹æ„Ÿã‚’å‡ºã™ãŸã‚ã«&lt;code&gt;console.log&lt;/code&gt;ï½¤promiseãŒå‹•ã„ã¦ã‚‹ä¾‹ã‚’æ›¸ãã‚„ã™ã„ãŸã‚ã«&lt;code&gt;setTimeout&lt;/code&gt;ã‚’æŒã¤ã‚ˆã†ã«ã™ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;builtin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SetTimeout&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ConsoleLog&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¼ã¯ã‚ã‚“ã¾ãŠã‚‚ã‚“ãªã„ãŒ&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(**
 * exp  := v
 *       | exp op exp
 *       | exp(exp* )
 *       | promise
 *)&lt;/span&gt;
&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Op&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;binop&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Call&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;list&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Promise&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;promise&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;Promise&lt;/code&gt;ã¯ç¨®é¡ã‚’åˆ†ã‘ã‚‹ãŸã‚ã«æ–°ãŸãªtypeã‚’å®šç¾©ã—ãŸï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;promise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Constructor&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;All&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nlist&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* await *)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Wait&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãƒ–ãƒ³!w&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;c&quot;&gt;(**
 * stmt := exp
 *       | const x = exp
 *       | return exp
 *)&lt;/span&gt;
&lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stmt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Expression&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Def&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¨ã“ã‚ã§&lt;code&gt;'a nlist&lt;/code&gt; ã¯non-empty listã§ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nlist&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Head&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Tail&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nlist&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&quot;4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;4. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã¾ã‚ä»Šæ—¥ã¯ã“ã‚“ãªã¨ã“ã‚ã§å‹˜å¼ã—ã¨ã„ã¦ã‚„ã‚‹ã‚ï½¡
ã‚´ãƒ«ã‚¦ã‚£ãƒ¼ä¸­ã«ã¯interpreterå®Œæˆã•ã›ã‚‹ã!!&lt;/p&gt;&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;

&lt;li id=&quot;fn1&quot;&gt;
&lt;p&gt;æ›¸ãã®ã¯é£½ãã¦ãªã„ã—ã‚€ã—ã‚ã‚¸ãƒ£ãƒã‚¹ã‚¯ã«ã‚‚&lt;code&gt;let-in&lt;/code&gt;å…¥ã‚Œã‚ã¨ã„ã†ã‹ã‚‚ã†ã‚¸ãƒ£ãƒã‚¹ã‚¯æ›¸ããŸãªã„ã§ã™â€¦â€¦Â &lt;a href=&quot;#fnref1&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;/ol&gt;
&lt;/div&gt;</description>
        <pubDate>Sun, 03 May 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/05/03/nikkan-promise1.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/05/03/nikkan-promise1.html</guid>
        
        <category>JavaScript</category>
        
        <category>Promise</category>
        
        <category>æ—¥åˆŠPromise</category>
        
        
      </item>
    
      <item>
        <title>å¿œæ´ã—ã¦ãã‚Œã¦ã„ã‚‹çš†æ§˜ã¸</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/04/01/shaka/thumb.png"></enclosure>
        <description>&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
ä»Šå›ã¯æƒ…å ±é‡ç„¡ã„ã®ã§ãŠæ€¥ãã®æ–¹ã¯æœ€å¾Œã ã‘ãŠèª­ã¿ãã ã•ã„ï½¡&lt;/p&gt;&lt;p&gt;ã“ã®åº¦æ™´ã‚Œã¦å­¦éƒ¨5å¹´é–“+ä¿®å£«ã®2å¹´é–“ã‚’éã”ã—ãŸç­‘æ³¢å¤§å­¦ã‚’è„±å‡ºã™ã‚‹ã“ã¨ã«æˆåŠŸã—ã¾ã—ãŸï½¡
æœ€è¿‘ã¯ç¥çµµå¸«æ¥­ã«åœ§è¿«ã•ã‚Œã¦ã»ã¨ã‚“ã©è¶£å‘³ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ›¸ã„ãŸã‚Šã—ã¦ãªã„ã‚“ã§ã™ãŒï½¤ç ”ç©¶å†…å®¹ã¯ã¾ã è¦šãˆã¦ã‚‹ã‚“ã§è©³ã—ãèããŸã„äººã¯ç§ã‚’é©å½“ã«æ•ã¾ãˆã¦ãã ã•ã„ï½¡
ã‚¨ãƒ¢ã‚„ã¾è©±ã§ã‚‚ã—ã‚ˆã†ã¨æ€ã£ãŸã‘ã©å¿è€ã®è³œç‰©ã“ããŒä¿®å£«å·ãªã®ã§ï½¤ä¿®å£«å·ã‚’æŒã£ã¦ã„ã‚‹ã“ã¨ãŒå…¨ã¦ã‚’ç‰©èªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã¤ã„ã§ã«ï½¤æ˜¨æ—¥ã¯1å¹´ã¨5ãƒ¶æœˆãã‚‰ã„ã‚¢ãƒ«ãƒã‚¤ãƒˆã—ã¦ã„ãŸæ ªå¼ä¼šç¤¾HERPã‚’ã‚„ã‚ãŸã‚“ã§ã™ãŒï½¤ä»Šæ—¥ã¯æ ªå¼ä¼šç¤¾HERPã«å…¥ç¤¾ã—ã¾ã—ãŸï½¡
å…¥ç¤¾å³æ‹ ç‚¹é•·ã§ã™ï½¡
å°±æ´»ã¯å¤§å¤‰ã§ã—ãŸï½¡å˜˜ã§ã™ï½¡ã‚¨ã‚¤ãƒ—ãƒªãƒ«ãƒ•ãƒ¼ãƒ«ãªã®ã§ï½¡
å®Ÿã¯æ•°ç¤¾å—ã‘ãŸã‚“ã§ã™ãŒï½¤ã‚¦ã‚§ãƒ–ãƒ†ã‚¹ãƒˆã§ç«¶ãƒ—ãƒ­ãŒå§‹ã¾ã£ãŸã‚‰ãƒ€ãƒ«ããªã£ã¡ã‚ƒã£ã¦ã‚„ã‚ã¾ã—ãŸï½¡
åˆ¶é™æ™‚é–“å†…ã«ãªã‚“ã‹ã‚„ã‚‹ç³»ã¯åˆ‡ç¾½è©°ã¾ã£ã¦ãã‚‹ã¨ã‚¹ã‚²ãƒ¼ã‚¤ãƒ©ã‚¤ãƒ©ã™ã‚‹ä¸Šã«ãƒŸã‚¹ãŒå¢—ãˆã‚‹ã®ã§å…¨ãå‘ã„ã¦ãªã„ï½¡
ã§ï½¤ãƒã‚¤ãƒˆé–‹å§‹æ•°ãƒ¶æœˆå¾Œã®é¢è«‡ã§ï½¢å°±æ´»ã©ã†? ã¦ã„ã†ã‹ã©ã“ä½ã¿? å†…å®šã„ã‚‹?ï½£ã¨ãªã£ã¦å°±æ´»ã‚¿ãƒ¼ãƒ³ã‚¨ãƒ³ãƒ‰ã—ã¾ã—ãŸï½¡&lt;/p&gt;&lt;p&gt;ä¸€èˆ¬ã«åŠ´åƒã¯ã¤ã‚‰ã„ã§ã™ãŒï½¤ãã®ä¸­ã§ã‚‚å¼Šç¤¾ã¯åŠ´åƒã®ã¤ã‚‰ã•ãŒå°‘ãªã„ã§ã™ï½¡
æŠ€è¡“é¢ã«é–¢ã—ã¦ã¯çš†ã•ã‚“ã™ã”ãã‚¹ã‚­ãƒ«ãŒé«˜ã„ãï½¤ã‚‚ã¡ã‚ã‚“æœ€æ–°ã®æƒ…å ±ã‚’è¿½ã£ã¦ã„ã‚‹ã—ï½¤è¨ˆç®—ç§‘å­¦ã«é–¢ã™ã‚‹ç´ é¤Šã‚‚ã‚ã‚‹ã®ã§ãã†ã„ã£ãŸè­°è«–ã‚‚ã§ãã‚‹ï½¡
ã‚ã¨äººæ•°ãŒã¾ã 3æ¡ã«æº€ãŸãªã„ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãªã‚“ã§ï½¤ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ä»¥å¤–ã§ã‚‚ã ã„ãŸã„ã¿ã‚“ãªãŒä½•è€…ãªã®ã‹ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒ¼ãƒ‰ãƒ«ã‚‚ä½ã„ï½¡
Tå¸‚ã«ã‚ªãƒ•ã‚£ã‚¹ãŒã§ããŸã®ã§ä½å±…ã‚„é£Ÿäº‹ã«å¤‰åŒ–ã¯ãªã„ã§ã™ãŒï½¤ç‰¹ã«å¾Œè€…ã¯å¬‰ã—ã„(ç¾å‘³ã—ã„é£¯å±‹ã¯Tå¸‚å”¯ä¸€ã®ã‚¢ãƒ”ãƒ¼ãƒ«ãƒã‚¤ãƒ³ãƒˆãªã®ã§)ï½¡&lt;/p&gt;&lt;p&gt;ä»¥ä¸‹ï½¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.amazon.jp/hz/wishlist/ls/133BSBJ4QYBSY?ref_=wl_share&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://m.media-amazon.com/images/G/01/wishlist/collablists_graphic_2x_1060x768._CB454600986_.jpg&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.amazon.jp/hz/wishlist/ls/133BSBJ4QYBSY?ref_=wl_share&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Amazonã»ã—ã„ç‰©ãƒªã‚¹ãƒˆã‚’ä¸€ç·’ã«ç·¨é›†ã—ã¾ã—ã‚‡ã†&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.wantedly.com/projects/402071&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://d2v9k5u4v94ulw.cloudfront.net/small_light(dw=1440,dh=1440,da=l,ds=n,cc=FFFFFF)/assets/images/4436611/original/da3adce3-e564-4170-9bda-55698d25bcbc?1583224129&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.wantedly.com/projects/402071&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;è¶£å‘³ã‚„ç ”ç©¶ä»¥å¤–ã§ã‚‚é–¢æ•°å‹è¨€èªã‚’æ›¸ããŸã„ã¤ãã°ã®å­¦ç”Ÿã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³å‹Ÿé›†! by æ ªå¼ä¼šç¤¾HERP&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;2019å¹´11æœˆã‚ˆã‚Šç­‘æ³¢å¤§å­¦ä»˜è¿‘ã®å¤©ä¹…ä¿2ä¸ç›®ã«é–‹è¨­ã—ãŸç­‘æ³¢ã‚ªãƒ•ã‚£ã‚¹ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³ã‚’å‹Ÿé›†ã—ã¦ã¾ã™ï¼æ±äº¬ã€äº¬éƒ½æ‹ ç‚¹ã¨ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ç¹‹ãŒâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;</description>
        <pubDate>Wed, 01 Apr 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/04/01/shaka.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/04/01/shaka.html</guid>
        
        <category>é›‘æ„Ÿ</category>
        
        
      </item>
    
      <item>
        <title>Algebraic Effectsã¨Extensible Effectsã®é•ã„ã£ã¦ãªã‚“ã‚„? é–¢ä¿‚ã‚ã‚“ã®?</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/03/15/ae-ee/thumb.png"></enclosure>
        <description>&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;1. ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æœ€è¿‘ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ 2å¤§ãƒ›ãƒƒãƒˆãƒˆãƒ”ãƒƒã‚¯ã¨ã„ãˆã°Algebraic Effectsã¨Extensible Effectsã ã‚ã† &lt;em&gt;[è¦å‡ºå…¸]&lt;/em&gt;ï½¡&lt;/p&gt;&lt;p&gt;åº¦ã€…ã“ã®2ã¤ã®é•ã„ã¯ä½•ãªã®ã‹ã¨ã„ã†è³ªå•ã‚’è¦‹ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;æ¯”è¼ƒã¨ã„ã†ã‚ã‘ã§ã‚‚ç„¡ã„ã‚“ã§ã™ãŒï½¤ä»Šå›ã¯ã“ã®2ã¤ã‚’ä¸¦ã¹ã¦è¦‹æ¯”ã¹ã¦ã¿ã¾ã—ã‚‡ã†ï½¡&lt;/p&gt;&lt;p&gt;ãã„ã†ãˆã°ã ã„ã¶å‰ã®&lt;a href=&quot;/pdf/ae_from_0.html&quot;&gt;ç™ºè¡¨&lt;/a&gt;ã§ã“ã‚“ãªã“ã¨è¨€ã£ã¦ã¾ã—ãŸã‘ã©&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;/pictures//2020/03/15/ae-ee/%E3%81%93%E3%82%93%E3%81%AA%E3%81%93%E3%81%A8.png&quot; alt=&quot;/pictures/2020/03/15/ae-ee/ã“ã‚“ãªã“ã¨.png&quot;&gt;
&lt;/p&gt;&lt;center&gt;å›³&lt;a href=&quot;#fig:compare&quot;&gt;1.1&lt;/a&gt;
. é›‘ãªæ¯”è¼ƒ&lt;/center&gt;&lt;label id=&quot;fig:compare&quot;&gt;&lt;/label&gt;&lt;p&gt;æœ¬å½“ã‹ã—ã‚‰&lt;/p&gt;&lt;h1 id=&quot;2.+Algebraic+Effects+and+Handlers&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+Algebraic+Effects+and+Handlers&quot;&gt;2. Algebraic Effects and Handlers&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Plotkinã¨Powerã«ã‚ˆã‚Šã‚‚ãŸã‚‰ã•ã‚ŒãŸï½¤è¨ˆç®—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ä»£æ•°çš„ã«è¡¨ç¾ã™ã‚‹ã¨ã„ã†è€ƒãˆæ–¹&lt;span class=&quot;cite&quot;&gt;[&lt;a href=&quot;#fn1&quot; title=&quot;Plotkin, Gordon, and John Power. â€œAdequacy for algebraic effects.â€ International Conference on Foundations of Software Science and Computation Structures. Springer, Berlin, Heidelberg, 2001.Â &quot; id=&quot;fnref1&quot;&gt;1&lt;/a&gt;]&lt;/span&gt;
ã«ï½¤Plotkinã¨PretnarãŒãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ ã—ãŸã‚‚ã®&lt;span class=&quot;cite&quot;&gt;[&lt;a href=&quot;#fn2&quot; title=&quot;Plotkin, Gordon, and Matija Pretnar. â€œHandlers of algebraic effects.â€ European Symposium on Programming. Springer, Berlin, Heidelberg, 2009.Â &quot; id=&quot;fnref2&quot;&gt;2&lt;/a&gt;]&lt;/span&gt;
ã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;è©³ç´°ã¯ã‚«ãƒ„ã‚¢ã‚¤ã—ã¾ã™ã‚“ã§ï½¤æœ¬ãƒ–ãƒ­ã‚°ã‚’ã”å·¡å›ãã ã•ã„ï½¡
ç°¡å˜ã«ã¾ã¨ã‚ã‚‹ã¨ï½¤&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;æ–°ãŸãªè¨€èªæ©Ÿèƒ½

&lt;ul&gt;
&lt;li&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ(ä»•æ§˜)ã¨ãƒãƒ³ãƒ‰ãƒ©(å®Ÿè£…)ãŒåˆ†é›¢ã§ãã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãªæ‰‹æ³•&lt;/li&gt;
&lt;li&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦è¨ˆç®—ä¸­ã«ã©ã®ã‚ˆã†ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç¾ã‚Œã‚‹ã®ã‹ãŒåˆ†ã‹ã‚‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;shallow/deep handler, set/row-based effect system, polymorphic/parameterized effects ãªã©æ§˜ã€…ãªãƒ´ã‚¡ãƒªã‚¢ãƒ³ãƒˆãŒã‚ã‚‹ï½¡&lt;/li&gt;
&lt;li&gt;è¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ãŒã‚ã‚‹

&lt;ul&gt;
&lt;li&gt;ã€ä½™è«‡ã€‘ã—ã°ã—ã°å‹(ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ)ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦ã¯ãªã„ãŒã—ã‚ã«ã•ã‚ŒãŒã¡ãªå°è±¡ãŒã‚ã‚‹ï½¡
ãŸã¾ã«è¦‹ã‚‹æ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ã«ã¯value handlerãŒãªãï½¤è­°è«–ã™ã‚‰ã•ã‚Œã¦ã„ãªã„ï½¡
computationã®çµæœã®å‹ã‚’èª¿æ•´ã—ãŸã‚Šã™ã‚‹ãŸã‚ã®é‡è¦ãªclauseãªã®ã«â€¦â€¦ï½¡
ã¾ã‚å…¥é–€ç”¨ã«ã¯ãã‚“ãªã«å¿…è¦ãªæ¦‚å¿µã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œãªã„ï½¡
ãƒœã‚¯ã‚‚ç°¡å˜ãªèª¬æ˜ã®ã¨ãã«ã¯çœç•¥ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ï½¡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;Kokaã®ä¾‹&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;effect reader&amp;lt;a&amp;gt; {
  fun ask() : a
}

// `e` ã¯èµ·ãã†ã‚‹ä»–ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ(ã®åˆ—)
fun run&amp;lt;s, a, e&amp;gt;(v : s, th : () -&amp;gt; &amp;lt;reader&amp;lt;s&amp;gt; | e&amp;gt; a) : e a {
  handle(th) {
    ask() -&amp;gt; v . resume()
  }
}

fun main() : console () {
  run(&quot;hello, &quot;) {
    val e = ask()
    // print : string -&amp;gt; console ()
    // ãªã®ã§â†‘ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆåˆ—å¤‰æ•° `e` ã¯ `&amp;lt;console&amp;gt;` ã«instantiateã•ã‚Œã‚‹
    print(e + &quot;world&quot;)
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;h1 id=&quot;3.+Extensible+Effects&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+Extensible+Effects&quot;&gt;3. Extensible Effects&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Kiselyovã‚‰ã«ã‚ˆã‚Šè€ƒæ¡ˆã•ã‚ŒãŸï½¤Monad Transformerã«ä»£ã‚ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã‚„ã‚‹æ–¹æ³•ã§ã‚ã‚‹&lt;span class=&quot;cite&quot;&gt;[&lt;a href=&quot;#fn3&quot; title=&quot;Kiselyov, Oleg, Amr Sabry, and Cameron Swords. â€œExtensible effects: an alternative to monad transformers.â€ ACM SIGPLAN Notices 48.12 (2013): 59-70.Â &quot; id=&quot;fnref3&quot;&gt;3&lt;/a&gt;]&lt;/span&gt;
ï½¡
è«–æ–‡ã‚’èª­ã‚€ã¨åˆ†ã‹ã‚‹ã¨ãŠã‚Šï½¤ã“ã¡ã‚‰ã¯è¨ˆç®—ä½“ç³»ã®ã‚ˆã†ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã§ã¯ãªãï½¤ã„ã„æ„Ÿã˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…æ‰‹æ³•ã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;p&gt;è€³ã‚¿ã‚³ã ã¨æ€ã„ã¾ã™ãŒï½¤ç°¡å˜ã«è¨€ã†ã¨ï½¤Freeãƒ¢ãƒŠãƒ‰ã®ãŠæ‰‹è»½monadic interpreterä½œæˆæ©Ÿèƒ½ã«Open Unionã§å‹å®‰å…¨ã«æ‹¡å¼µæ€§ã‚’ã‚²ãƒƒãƒˆ(ã®ã¡ã«Freerã¨ã‹TASeqãŒç››ã‚‰ã‚Œã¦æ—©ããªã£ãŸã‚Š)ã¨ã„ã†æ„Ÿã˜ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;ç­†è€…ã¯ã‚ã¾ã‚Šè©³ã—ããªã„ã‚“ã§ã™ãŒã¾ã¨ã‚ã¦ã¿ã‚‹ã¨ã“ã‚“ãªæ‰€æ„Ÿ&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;ãƒ¢ãƒŠãƒ‰ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼ã«ä»£ã‚ã‚‹æ–°ãŸãªãƒ¢ãƒŠãƒ‰ã®åˆæˆæ‰‹æ³•

&lt;ul&gt;
&lt;li&gt;liftåœ°ç„ã‚„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å¤§é‡ç”Ÿæˆåœ°ç„ã‹ã‚‰ã®è§£æ”¾&lt;/li&gt;
&lt;li&gt;Free(-er)ãƒ¢ãƒŠãƒ‰+Open Unionã‚’ä½¿ã£ã¦1ã¤ã®ãƒ¢ãƒŠãƒ‰ã«æ‹¡å¼µçš„ã«æŠ¼ã—è¾¼ã‚€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ãƒªãƒƒãƒãªå‹ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹

&lt;ul&gt;
&lt;li&gt;Haskellã¨Scalaã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå®Ÿè£…ãŒæ´»ç™ºã§ã™ã­&lt;/li&gt;
&lt;li&gt;ã‚€ã—ã‚ä»–ã«å®Ÿè£…ã§ãã‚‹è¨€èªã‚ã‚‹ã‚“ã‹ã„ãª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;Unionã‚’äºŒåˆ†æ¢ç´¢ã—ãŸã‚Šã™ã‚‹ã®ã¯ã¾ã‚ã„ã„ã‹ãªï½¤ãƒãƒ³ãƒ‰ãƒ©ã®ã‚ãŸã‚Šã‚’ã¡ã‚‡ã£ã¨è«–æ–‡ã‹ã‚‰å¼•ç”¨ã—ã¾ã™ï½¡
&lt;code&gt;Eff e w&lt;/code&gt;ã¨ã„ã†ã®ãŒã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;code&gt;e&lt;/code&gt;ãŒç™ºç”Ÿã—ã†ã‚‹&lt;code&gt;w&lt;/code&gt;å‹ã®å€¤ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;&lt;label id=&quot;lst:run&quot;&gt;&lt;/label&gt;&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;Fig&lt;a href=&quot;#lst:run&quot;&gt;3.1&lt;/a&gt;
. run&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Pure&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ãƒ—ãƒ­ã‚°ãƒ©ãƒ &lt;a href=&quot;#lst:run&quot;&gt;3.1&lt;/a&gt;
ã¯&lt;code&gt;Void&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã™ã‚‹(ã¤ã¾ã‚Šã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã—ãªã„)å€¤ã‹ã‚‰ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‰¥ãŒã™æ“ä½œã§ã™ï½¡
&lt;code&gt;admin&lt;/code&gt;ã¯è«–æ–‡ã®ã‚¿ãƒ¼ãƒŸãƒãƒ­ã‚¸ãƒ¼ã‚’ä½¿ãˆã°ï½¤ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ã‚°ãƒ«ã‚°ãƒ«èµ°ã‚‰ã›ã¦æœ€çµ‚çš„ãªçµæœã¾ã§å®Ÿè¡Œã™ã‚‹é–¢æ•°ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;ç¶šã„ã¦ &lt;code&gt;Reader&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ã¿ã¾ã—ã‚‡ã†(å›³&lt;a href=&quot;#lst:reader&quot;&gt;3.2&lt;/a&gt;
)ï½¡&lt;/p&gt;&lt;p&gt;&lt;label id=&quot;lst:reader&quot;&gt;&lt;/label&gt;&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;Fig&lt;a href=&quot;#lst:reader&quot;&gt;3.2&lt;/a&gt;
. Readerã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span class=&quot;kr&quot;&gt;newtype&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;kr&quot;&gt;deriving&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Typeable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Functor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Typeable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Member&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inj&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;----&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;handle_relay&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Typeable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Union&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;handle_relay&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
             &lt;span class=&quot;kr&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decomp&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;of&lt;/span&gt;
               &lt;span class=&quot;kt&quot;&gt;Right&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
               &lt;span class=&quot;kt&quot;&gt;Left&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;send&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;runReader&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Typeable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;runReader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;admin&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;where&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;E&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;handle_relay&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;p&gt;ã¾ãš &lt;code&gt;Reader&lt;/code&gt; ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã—ã¾ã™ï½¡
&lt;code&gt;e -&amp;gt; v&lt;/code&gt; ã¨ã„ã†ã®ã¯ç¶™ç¶šã¨èª­ã‚ã°ã„ã„ã®ã‹ã—ã‚‰ï½¡ &lt;code&gt;e&lt;/code&gt;å‹ã®holeãŒã‚ã‚‹ã®ã§ï½¤&lt;code&gt;Reader&lt;/code&gt;ã£ã½ãä½•ã‹&lt;code&gt;e&lt;/code&gt;å‹ã®å€¤ã‚’æ¯åº¦æ¸¡ã—ã¦ã„ã£ã¦æœ€çµ‚çš„ã«&lt;code&gt;v&lt;/code&gt;å‹ã®å€¤ãŒæˆ»ã£ã¦ãã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;&lt;code&gt;ask&lt;/code&gt;ãŒã‚¹ãƒã‚³ãƒ³ã¨ã„ã†ã‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã™ã‚‹é …ã§ã™ï½¡
&lt;code&gt;send&lt;/code&gt;ã§&lt;code&gt;Reader&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ©ã¾ã§é£›ã°ã—ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ãƒãƒ³ãƒ‰ãƒ©ã¯&lt;code&gt;runReader&lt;/code&gt;ãŒãƒãƒ³ãƒ‰ãƒ©ã§ã™ï½¡
&lt;code&gt;admin m&lt;/code&gt;ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’å›ã—ã¾ãã£ã¦åº¦ã€…suspendã•ã‚Œã‚‹ã®ã‚’&lt;code&gt;loop&lt;/code&gt;é–¢æ•°ã§æ‹¾ã†ï½¤ã¨ã„ã†æµã‚Œã§ã™ï½¡
&lt;code&gt;Val&lt;/code&gt;ã¨&lt;code&gt;E&lt;/code&gt;ã¨ã„ã†ã®ãŒï½¤å†…éƒ¨ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹Freeã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§ã™ï½¡&lt;code&gt;E&lt;/code&gt;ã¯ãªã«ã‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã—ãŸã¨ãã§ï½¤&lt;code&gt;handle_relay&lt;/code&gt;ã§&lt;code&gt;u&lt;/code&gt;ãŒåˆ†è§£ã•ã‚Œã¦ç¬¬2å¼•æ•°ã‹ç¬¬3å¼•æ•°ã«åˆ†è§£ã•ã‚ŒãŸå€¤ãŒæ¸¡ã•ã‚Œã¦ã„ãã¾ã™ï½¡
è£œåŠ©é–¢æ•°&lt;code&gt;handle_relay&lt;/code&gt;ã«å‘³ãŒã‚ã£ã¦&lt;sup id=&quot;fnref4&quot; title=&quot;ãªã‚“ã§ã“ã®é–¢æ•°ã ã‘ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ãªã‚“ã ã‚ã†ï½¡å†™çµŒã—ã¦ã‚‹ã¨ãã«hlintã«ã‚‚æ€’ã‚‰ã‚ŒãŸï½¡Â &quot;&gt;&lt;a href=&quot;#fn4&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;ï½¤ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ãŸã„ã‘ã©ãƒãƒ³ãƒ‰ãƒ«ã§ããªã„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã ã£ãŸã¨ãã«é©å®œä¸Šä½ã®ãƒãƒ³ãƒ‰ãƒ©ã«å†é€ã—ã¦ãã‚Œã‚‹å¥´ã§ã™ï½¡
ã“ã®ã¸ã‚“ã§&lt;code&gt;Typeable&lt;/code&gt;ã¨ã‹ãŒã‚¬ãƒãƒ£ã‚¬ãƒãƒ£ã‚„ã£ã¦ï½¤&lt;code&gt;Reader&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã ã£ãŸã¨ãã«&lt;code&gt;decomp u&lt;/code&gt;ãŒ&lt;code&gt;Right&lt;/code&gt;ã‚’è¿”ã™ã‚ˆã†ã«ãªã£ã¦ã„ã„æ„Ÿã˜ã«ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã“ã‚“ãªæ„Ÿã˜ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã”ã¨ã®ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã£ã¦ï½¤é–¢æ•°åˆæˆã§æ§˜ã€…ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹é–¢æ•°ã‚’ä½œã‚Šã¾ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span class=&quot;c1&quot;&gt;-- ã‚ã‚“ã¾è‡ªä¿¡ãªã„ï½¤é›°å›²æ°—ã­é›°å›²æ°—&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Eff&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Reader&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Exc&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Either&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runExc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;runReader&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;42&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã“ã®ãƒãƒ³ãƒ‰ãƒ©ã«&lt;code&gt;Reader&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨&lt;code&gt;Exc&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;em&gt;ã ã‘&lt;/em&gt;ãŒç™ºç”Ÿã™ã‚‹é …ã‚’æ¸¡ã™ã¨ï½¤ã“ã‚Œã‚‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ã„ã„æ„Ÿã˜ã«å‡¦ç†ã—ã¦ãã‚Œã¦æœ€çµ‚çš„ã«&lt;code&gt;Either String a&lt;/code&gt;ãŒå‡ºã¦ãã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-haskell&quot; data-lang=&quot;haskell&quot;&gt;&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;::&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Either&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;run&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ask&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;throwError&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;the env should return the value more than 10&quot;&lt;/span&gt;
  &lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- 45&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&quot;4.+%E4%BA%8C%E8%80%85%E3%81%AE%E9%81%95%E3%81%84&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+%E4%BA%8C%E8%80%85%E3%81%AE%E9%81%95%E3%81%84&quot;&gt;4. äºŒè€…ã®é•ã„&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã”è¦§ã®é€šã‚Šå…¨ç„¶é•ã†ã¨æ€ã†ã‚“ã§ã™ãŒï½¤ã§ã¯é€†ã« &lt;em&gt;å®Ÿç¾å¯èƒ½ãã†ãªã“ã¨&lt;/em&gt; ã¯ã ã„ãŸã„åŒã˜ã«ã¿ãˆã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã„ãšã‚Œã‚‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã—ã¦ã‹ã‚‰ï½¤ãƒãƒ³ãƒ‰ãƒ©ã‚’åˆ¥é€”å®šç¾©ã—ã¦æ„å‘³ã‚’ä¸ãˆã¦ã„ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã“ã®ã“ã¨ã¯ã„ãšã‚Œã‚‚Free(-er)ãƒ¢ãƒŠãƒ‰ã‚’åˆ©ç”¨ã—ãŸå®Ÿè£…æ–¹æ³•ãŒã‚ã‚‹(Extensible Effectsã¯ã‚€ã—ã‚FreeãŒå¿…é ˆã§ã™ãŒ)ã“ã¨ã‹ã‚‰ã‚‚æ„Ÿã˜å–ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã¨ã„ã†ã‹ãã“ä»¥å¤–ã¯å…¨éƒ¨é•ã†ã‚“ã˜ã‚ƒãªã„ã‹ã—ã‚‰
IãŒé•ã† æ˜ŸãŒé•ã† é•ã†ã ã‚ ã™ã¹ã¦ãŒ&lt;/p&gt;&lt;h2 id=&quot;4-1.+%E6%A6%82%E5%BF%B5%E7%9A%84%E3%81%AA%E9%81%95%E3%81%84&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4-1.+%E6%A6%82%E5%BF%B5%E7%9A%84%E3%81%AA%E9%81%95%E3%81%84&quot;&gt;4-1. æ¦‚å¿µçš„ãªé•ã„&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Algebraic Effects (and Handlers)ã¯Moggiã®æå”±ã—ãŸ$\lambda_{c}$ã‚ˆã‚Šã‚‚ã„ã„æ„Ÿã˜ã«è¨ˆç®—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’æ‰±ã†ãŸã‚ã®æ¦‚å¿µã¨ã—ã¦è€ƒãˆã‚‰ã‚ŒãŸï½¡&lt;/p&gt;&lt;p&gt;ä¸€æ–¹Extensible Effectsã¯Monad Transformerã«ä»£ã‚ã‚‹ãƒ¢ãƒŠãƒ‰ã®åˆæˆæ–¹æ³•ã¨ã—ã¦ææ¡ˆã•ã‚ŒãŸå®Ÿè£…æ‰‹æ³•ã§ã‚ã‚‹ï½¡&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;Algebraic Effectsã¯æ¦‚å¿µ

&lt;ul&gt;
&lt;li&gt;æ¦‚å¿µãªã®ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„è¨€èªçµ„ã¿è¾¼ã¿ã®æ©Ÿèƒ½ã¨ã—ã¦è€ƒãˆã‚‹ã“ã¨ãŒã§ãã‚‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Extensible Effectsã¯å®Ÿè£…æ‰‹æ³•

&lt;ul&gt;
&lt;li&gt;ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ã®å®Ÿè£…æ–¹æ³•ã«ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’æŒã¤ã®ã§ï½¤è¨€èªçµ„ã¿è¾¼ã¿ã®æ©Ÿèƒ½ã¿ãŸã„ãªã“ã¨ã¯ãã‚‚ãã‚‚è€ƒãˆã‚‰ã‚Œãªã„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;4-2.+%E5%AE%9F%E8%A3%85%E3%81%AE%E9%81%95%E3%81%84&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4-2.+%E5%AE%9F%E8%A3%85%E3%81%AE%E9%81%95%E3%81%84&quot;&gt;4-2. å®Ÿè£…ã®é•ã„&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Extensible Effectsã«ã¯FreeãŒå¿…é ˆã§ã—ãŸï½¡
ã§ã¯Algebraic Effectsã®å®Ÿè£…ã¯ã©ã†ã‹ã¨ã„ã†ã¨è‰²ã€…è€ƒãˆã‚‰ã‚Œã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;è©³ç´°ã¯ã“ã¡ã‚‰ã«!!!!(éš™ã‚ã‚‰ã°æˆ‘ç”°å¼•æ°´)&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/pdf/effect_study.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://nymphium.github.io/pdf/effect_study.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/pdf/effect_study.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;How do you implement Algebraic Effects? - lilyum ensemble&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;Algebraic EFfectsã¯å®Ÿè£…ãŒè‰²ã€…è€ƒãˆã‚‰ã‚Œã‚‹&lt;/li&gt;
&lt;li&gt;Extensible Effectsã¯Freeã¨Open Unionã‚’ä½¿ã£ãŸå®Ÿè£…æ–¹æ³•ã—ã‹ãªã„

&lt;ul&gt;
&lt;li&gt;ãã‚‚ãã‚‚Freeã¨Open Unionã‚’ä½¿ã£ãŸå®Ÿè£…æ–¹æ³•ã‚’æŒ‡ã—ã¦Extensible Effectsã¨å‘¼ã‚“ã§ã‚‹ã®ã§â€¦â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h2 id=&quot;4-3.+%E3%81%9D%E3%81%AE%E4%BB%96&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4-3.+%E3%81%9D%E3%81%AE%E4%BB%96&quot;&gt;4-3. ãã®ä»–&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Algebraic Effectsã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ãŠã‚ˆã³value handlerã‚’1ã¤ã®ãƒãƒ³ãƒ‰ãƒ©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦å®šç¾©ã§ãã‚‹ï½¡
ä¸€æ–¹Extensible Effectsã¯ãã‚Œãã‚Œã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«ãŸã„ã—ã¦é–¢æ•°ã‚’å®šç¾©ã—ï½¤é–¢æ•°åˆæˆã§1ã¤ã«ã¾ã¨ã‚ã‚‹ï½¡
å‰è€…ã¯å„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå”èª¿ã™ã‚‹ã‚ˆã†ãªãƒãƒ³ãƒ‰ãƒ©ã‚’æ›¸ãã‚„ã™ã„ï½¡
ä¸€æ–¹å¾Œè€…ã¯ãƒãƒ³ãƒ‰ãƒ©ã‚’ã‚ˆã‚Šãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã«å®šç¾©ã§ãã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ä»–ã«ã‚‚ã„ã‚ã„ã‚ã‚ã‚Šãã†ã ãŒï½¤æœ¬æ—¥ã¯ã“ã®è¾ºã§â€¦â€¦ï½¡&lt;/p&gt;&lt;h1 id=&quot;5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#5.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;5. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Extensible Effectsã¯å¿…é ˆã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒã‚ã‚‹ã®ã§ï½¤å›³&lt;a href=&quot;#fig:compare&quot;&gt;1.1&lt;/a&gt;
ã¯ã¾ã‚ãªã‚“ã¨ãªãã‚ãŸã£ã¦ã‚‹ã‚ˆã†ãªãã†ã§ã‚‚ãªã„ã‚ˆã†ãªâ€¦â€¦ï½¡
ã¾ï½¤ãƒ¦ãƒ¼ã‚¶ã«ã¨ã£ã¡ã‚ƒã‚ã‚ã‚“ã¾é–¢ä¿‚ã­ãˆè©±ã«ã‚ƒã‚“ã§ã™ãŒâ€¦â€¦(ãŠã‚ã‚Š)&lt;/p&gt;&lt;div class=&quot;footnotes&quot;&gt;
&lt;hr&gt;
&lt;ol&gt;

&lt;li id=&quot;fn1&quot;&gt;
&lt;p&gt;Plotkin, Gordon, and John Power. â€œAdequacy for algebraic effects.â€ International Conference on Foundations of Software Science and Computation Structures. Springer, Berlin, Heidelberg, 2001.Â &lt;a href=&quot;#fnref1&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li id=&quot;fn2&quot;&gt;
&lt;p&gt;Plotkin, Gordon, and Matija Pretnar. â€œHandlers of algebraic effects.â€ European Symposium on Programming. Springer, Berlin, Heidelberg, 2009.Â &lt;a href=&quot;#fnref2&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li id=&quot;fn3&quot;&gt;
&lt;p&gt;Kiselyov, Oleg, Amr Sabry, and Cameron Swords. â€œExtensible effects: an alternative to monad transformers.â€ ACM SIGPLAN Notices 48.12 (2013): 59-70.Â &lt;a href=&quot;#fnref3&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;li id=&quot;fn4&quot;&gt;
&lt;p&gt;ãªã‚“ã§ã“ã®é–¢æ•°ã ã‘ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹ãªã‚“ã ã‚ã†ï½¡å†™çµŒã—ã¦ã‚‹ã¨ãã«hlintã«ã‚‚æ€’ã‚‰ã‚ŒãŸï½¡Â &lt;a href=&quot;#fnref4&quot;&gt;â†©&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;

&lt;/ol&gt;
&lt;/div&gt;</description>
        <pubDate>Sun, 15 Mar 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/03/15/ae-ee.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/03/15/ae-ee.html</guid>
        
        <category>Algebraic Effects</category>
        
        <category>Extensible Effects</category>
        
        
      </item>
    
      <item>
        <title>fcontrol/runã§shallow effect handler</title>
        <enclosure type="image/png" length="0" url="/pictures/2020/02/20/shallow_effec_handler_with_fcontrol/thumb.png"></enclosure>
        <description>&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
æ°—ã¥ã‘ã°2020å¹´ã«ãªã£ã¦ã¾ã—ãŸï½¡
2020å¹´ã£ã¦ãªã‚“ã ? SFã§ã™ã‹?&lt;/p&gt;&lt;hr&gt;&lt;h1 id=&quot;1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB+-+Algebraic+Effects%E3%81%8A%E3%81%95%E3%82%89%E3%81%84&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB+-+Algebraic+Effects%E3%81%8A%E3%81%95%E3%82%89%E3%81%84&quot;&gt;1. ã¯ã˜ã‚ã« - Algebraic EffectsãŠã•ã‚‰ã„&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;æœ¬æ—¥ã¯shallow effect handlerã‚’å®Ÿè£…ã—ã¾ã™ï½¡
ã¾ãš &lt;em&gt;shallow&lt;/em&gt; effect handlerã¨ã¯ãªã‚“ã§ã—ã‚‡ã†?
æœ€åˆã«algebraic effects and handlersã«ã¤ã„ã¦ãŠã•ã‚‰ã„ã—ã¾ã™ï½¡
ã‚ã‚Œã¨ã‹ã“ã‚Œã¨ã‹ãã‚Œã¨ã‹ã‚’èª­ã‚“ã§ãŠã•ã‚‰ã„ã—ã¦ãã ã•ã„ï½¡&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/2018/08/13/algebraic_effects_tutorial.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://nymphium.github.io/pictures/github_icon.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/2018/08/13/algebraic_effects_tutorial.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Algebraic Effectsã§ã‚ãã¼ã† - lilyum ensemble&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡ã“ã“ã—ã°ã‚‰ã20è¡Œ/æ—¥ãã‚‰ã„ã—ã‹ã‚³ãƒ¼ãƒ‰æ›¸ã„ã¦ã¾ã›ã‚“ï½¡ã„ã‚„ã‚‚ã£ã¨å°‘ãªã„ã‹ã‚‚â€¦ï½¡ã„ã‚„ç ”ç©¶ã—ã¦ã¾ã™ã‚“ã§! ã„ã‚„ã€œç ”ç©¶ã‚‚ãã‚“ãªã«ã—ã¦ãªã„ãªâ€¦ã˜ã‚ƒã‚ä½•ã‚’â€¦1. ã¯ã˜ã‚ã«Algâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/pdf/mlday2.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://nymphium.github.io/pdf/mlday2.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/pdf/mlday2.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Dive into Algebraic Effects - lilyum ensemble&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://qiita.com/Nymphium/items/e6ce580da8b87ded912b&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://qiita-user-contents.imgix.net/https%3A%2F%2Fcdn.qiita.com%2Fassets%2Fpublic%2Fogp-background-1150d8b18a7c15795b701a55ae908f94.png?ixlib=rb-1.2.2&amp;amp;w=1200&amp;amp;mark=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D380%26txt%3DAlgebraic%2520Effects%25E3%2581%25A8%25E3%2581%25AF%253F%2520%25E5%2587%25BA%25E8%25BA%25AB%25E3%2581%25AF%253F%2520%25E4%25BD%25BF%25E3%2581%2584%25E6%2596%25B9%25E3%2581%25AF%253F%2520%25E3%2581%259D%25E3%2581%25AE%25E7%2589%25B9%25E5%25BE%25B4%25E3%2581%25A8%25E3%2581%25AF%253F%2520%25E8%25AA%25BF%25E3%2581%25B9%25E3%2581%25A6%25E3%2581%25BF%25E3%2581%25BE%25E3%2581%2597%25E3%2581%259F%2521%26txt-color%3D%2523333%26txt-font%3DAvenir-Black%26txt-size%3D54%26txt-clip%3Dellipsis%26txt-align%3Dcenter%252Cmiddle%26s%3D1caabdbc9f6c0e53b796c74eee4ee35b&amp;amp;mark-align=center%2Cmiddle&amp;amp;blend=https%3A%2F%2Fqiita-user-contents.imgix.net%2F~text%3Fixlib%3Drb-1.2.2%26w%3D840%26h%3D500%26txt%3D%2540Nymphium%26txt-color%3D%2523333%26txt-font%3DAvenir-Black%26txt-size%3D45%26txt-align%3Dright%252Cbottom%26s%3Dfd6494ecf386fd4832ae2af2ec363e6c&amp;amp;blend-align=center%2Cmiddle&amp;amp;blend-mode=normal&amp;amp;s=d981ca15ae673b02388b321b0c2231ea&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://qiita.com/Nymphium/items/e6ce580da8b87ded912b&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Algebraic Effectsã¨ã¯? å‡ºèº«ã¯? ä½¿ã„æ–¹ã¯? ãã®ç‰¹å¾´ã¨ã¯? èª¿ã¹ã¦ã¿ã¾ã—ãŸ! - Qiita&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;Reactã®HooksãŒå®Ÿè³ªalgebraic effectsãªã‚“ã˜ã‚ƒãªã„ã‹ã¨ã„ã†ã“ã¨ã§algebraic effectsã«é–¢ã™ã‚‹æ€ªæ–‡æ›¸ãŒæµå¸ƒã—ã¦é¼»ç™½ã‚“ã§ã—ã¾ã†ï½¤ãã‚“ãªæœªæ¥ã‚’é˜»æ­¢ã™ã‚‹ãŸã‚ï½¤æ›²ãŒã‚Šãªã‚Šã«ã‚‚algebraic effectâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ãªã‚‹ã»ã©ï½¤ &lt;strong&gt;å¾©å¸°å¯èƒ½ãªä¾‹å¤–&lt;/strong&gt; ã§ã™ã­ï½¡æ‰¿çŸ¥ã—ã¾ã—ãŸï½¡&lt;/p&gt;&lt;h1 id=&quot;2.+shallow+effect+handler&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2.+shallow+effect+handler&quot;&gt;2. shallow effect handler&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã§ã¯æ”¹ã‚ã¦ï½¤ &lt;em&gt;shallow&lt;/em&gt; effect handlerã¨ã¯ãªã‚“ã§ã—ã‚‡ã†?
ä¸Šã«æŒ™ã’ã‚‰ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ã§ã¯ï½¤ãƒãƒ³ãƒ‰ãƒ©ãŒå–ã£ã¦ããŸç¶™ç¶šã‚’èµ·å‹•ã•ã›ãŸã¨ãã«ã¾ãŸç™ºç”Ÿã™ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒï½¤ã¾ãŸåŒã˜ãƒãƒ³ãƒ‰ãƒ©ã«ã‚ˆã£ã¦æ•æ‰ã•ã‚Œã¦ã„ã¾ã™ï½¡
é€†ã« &lt;em&gt;shallow&lt;/em&gt; effect handler ã¯ï½¤ãƒãƒ³ãƒ‰ãƒ©ãŒå–å¾—ã—ãŸç¶™ç¶šã®ä¸­ã§ç™ºç”Ÿã™ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯åŒã˜ãƒãƒ³ãƒ‰ãƒ©ã«ã‚ˆã£ã¦ã¯æ•æ‰ã•ã‚Œãšï½¤ä¸€ã¤å¤–å´ã®ãƒãƒ³ãƒ‰ãƒ©ã¾ã§åˆ°é”ã—ã¾ã™ï½¡
è«–æ–‡ã¯ã“ã¡ã‚‰:&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://link.springer.com/chapter/10.1007/978-3-030-02768-1_22&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://static-content.springer.com/cover/book/978-3-030-02768-1.jpg&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://link.springer.com/chapter/10.1007/978-3-030-02768-1_22&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Shallow Effect Handlers&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;Plotkin and Pretnarâ€™s effect handlers offer a versatile abstraction for modular programming with user-defined effects. Traditional deep handlersare defined by folds over computation trees. In thisâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;æ„Ÿè¦šã¨ã—ã¦ã¯ï½¤ &lt;code&gt;shift/reset&lt;/code&gt; ã® &lt;code&gt;shift&lt;/code&gt; ãŒç¶™ç¶šã‚’åˆ‡ã‚Šå–ã‚‹ã¨ãã« &lt;code&gt;reset&lt;/code&gt; ãŒãã£ã¤ã„ã¦ãã‚‹ã‘ã©ï½¤ &lt;code&gt;shift0/reset0&lt;/code&gt; ã§ã¯ãã£ã¤ã„ã¦ã“ãªã„ã¨ã„ã†é–¢ä¿‚ã¨åŒã˜ã§ã™ã­ï½¡
&lt;code&gt;shift/reset&lt;/code&gt; ãªã©ã«ã¤ã„ã¦ã¯ã‚³ãƒãƒ©&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/2018/07/19/delimited-continuation%E3%81%AE%E5%A4%8F.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://nymphium.github.io/pictures/github_icon.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://nymphium.github.io/2018/07/19/delimited-continuation%E3%81%AE%E5%A4%8F.html&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;delimited continuationã®å¤ - lilyum ensemble&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡control/promptã¨prompt tagã¸ã®ç†è§£ãŒå¿…è¦ã«ãªã£ãŸãŸã‚ï½¤ã‚„ã£ã¦ã„ãã¾ã—ã‚‡ã†ï½¡1. continuation??? ç¶™ç¶š??? is powerâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ã”ã¡ã‚ƒã”ã¡ã‚ƒè¨€ã£ãŸã‘ã©&lt;a href=&quot;https://www.eff-lang.org/&quot;&gt;Effè¨€èª&lt;/a&gt;ã§ã‚µã‚¯ãƒƒã¨ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï½¡
ã“ã‚“ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¨é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ï½¡
ãƒãƒ³ãƒ‰ãƒ©&lt;code&gt;h&lt;/code&gt;ã§&lt;code&gt;P&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒ2å›ç™ºç”Ÿã™ã‚‹å¼ã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;h&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã»ã‚“ã§&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã†ã‚“ï½¤ã‚ˆã•ãã†ã ï½¡
&lt;code&gt;(+)&lt;/code&gt; ã®è©•ä¾¡ã¯å·¦è¾ºã®éƒ¨åˆ†é …ã‚’è©•ä¾¡ã—ã¦ã‹ã‚‰å³è¾ºã«ç§»ã‚‹ï½¤ã¨è‡ªç„¶ã«è€ƒãˆã‚‹ã¨ï½¤æœ€åˆã«&lt;code&gt;P&lt;/code&gt;ãŒç™ºç”Ÿã—ãŸã¨ãã«ãƒãƒ³ãƒ‰ãƒ©ãŒå–å¾—ã™ã‚‹ç¶™ç¶š &lt;code&gt;k&lt;/code&gt; ã¯ &lt;code&gt;with h handle â–¡ + perform (P 3)&lt;/code&gt; ã¨ãªã‚‹ï½¡
&lt;code&gt;â–¡&lt;/code&gt;ã«&lt;code&gt;(i + i)[i/2]&lt;/code&gt;ã‚’æ”¾ã‚Šè¾¼ã‚€ã®ã§(ä¸­ç•¥) &lt;code&gt;4 + 9 (= 13)&lt;/code&gt; ã¨ã„ã†çµæœãŒå¾—ã‚‰ã‚Œã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ç¶šã„ã¦shallow handlerã‚’ä½¿ã„ã¾ã™ï½¡
ã‚¸ãƒƒã‚µã‚¤ã®Effã«ã¯ãªã„ã‚“ã§ã™ãŒï½¤ &lt;code&gt;handlerâ€ &lt;/code&gt; ã‚’shallow handlerã¨ã—ã¾ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;â€ &lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effecf&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;â€ &lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;P&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãƒ•ãƒ¼ãƒ å¦™ã ï½¤å¦™ã ãªâ€¦â€¦ï½¡
æœ€åˆã«&lt;code&gt;perform (P 2)&lt;/code&gt;ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ã¨ï½¤å–å¾—ã™ã‚‹ç¶™ç¶š &lt;code&gt;k&lt;/code&gt; ã¯ &lt;code&gt;â–¡ + perform (P 3)&lt;/code&gt; ã§ã™ï½¡
ãŠã‚„ï½¤ã“ã‚Œã¯&lt;code&gt;a1&lt;/code&gt;ã®è©•ä¾¡ã¨ç•°ãªã‚Šã¾ã™ã­ï½¡
ã“ã‚ŒãŒ &lt;strong&gt;shallow&lt;/strong&gt; ã§ã™ï½¡
ãƒãƒ³ãƒ‰ãƒ©ã¯ç¶™ç¶šã®ä¸­ã¾ã§è¿½ã£ã¦ã„ãã¾ã›ã‚“ï½¡
ãªã®ã§2å›ã‚ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ç™ºç”Ÿã¯ï½¤ &lt;code&gt;P&lt;/code&gt; ã®ãƒãƒƒãƒã‚¢ãƒ¼ãƒ å†…ã§æ–°ãŸã«å®šç¾©ã—ã¦ã„ã‚‹ãƒãƒ³ãƒ‰ãƒ©ã«ã‚ˆã£ã¦ãƒãƒ³ãƒ‰ãƒ«ã•ã‚Œã¾ã™ï½¡
ãªã®ã§ &lt;code&gt;4 + 10 (= 14)&lt;/code&gt; ãŒè¿”ã£ã¦ãã¾ã™ï½¡&lt;/p&gt;&lt;h2 id=&quot;2-1.+%E5%BD%B9%E3%81%AB%E7%AB%8B%E3%81%A4%E3%82%93%E3%81%A7%E3%81%99%E3%81%8B%3F&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#2-1.+%E5%BD%B9%E3%81%AB%E7%AB%8B%E3%81%A4%E3%82%93%E3%81%A7%E3%81%99%E3%81%8B%3F&quot;&gt;2-1. å½¹ã«ç«‹ã¤ã‚“ã§ã™ã‹?&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;HillerstrÃ¶mã‚‰ã®è«–æ–‡ã§ã¯ï½¤pipe/copipeã®ã‚ˆã†ã«ç”Ÿæˆã¨æ¶ˆè²»ã‚’ãŠã“ãªã†ç›¸äº’å†å¸°é–¢æ•°ã‚’ä¾‹ã«ã‚ã’ã¦ã„ã‚‹ï½¡
ã¾ãŸã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ã‚ˆã†ã«ãƒªã‚¿ãƒ¼ãƒ³ãƒã‚¤ãƒ³ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ©ã§å®Ÿè£…ã™ã‚‹ã¨ããªã©ã‚‚ï½¤shallow handlerã§äº‹è¶³ã‚Šã‚‹ã ã‚ã†ï½¡&lt;/p&gt;&lt;h1 id=&quot;3.+%3Ccode%3Efcontrol%2Frun%3C%2Fcode%3E%E3%81%A7shallow+effect+handler%E3%81%AE%E5%AE%9F%E8%A3%85&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#3.+%3Ccode%3Efcontrol%2Frun%3C%2Fcode%3E%E3%81%A7shallow+effect+handler%E3%81%AE%E5%AE%9F%E8%A3%85&quot;&gt;3. &lt;code&gt;fcontrol/run&lt;/code&gt;ã§shallow effect handlerã®å®Ÿè£…&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã¨ã“ã‚ã§ã‚ãŸãã—&lt;a href=&quot;http://logic.cs.tsukuba.ac.jp/%7Esat/pdf/tfp2020.pdf&quot;&gt;ã“ã†ã„ã†ç ”ç©¶&lt;/a&gt;ã‚’ã—ã¦ã‚‹ã‚“ã§ã™ãŒï½¤å®Ÿã¯å…ˆæ—¥ã‚‚ãƒãƒ¼ãƒ©ãƒ³ãƒ‰ã«è¡Œã£ã¦&lt;a href=&quot;http://logic.cs.tsukuba.ac.jp/%7Esat/pdf/tfp2020-slide.pdf&quot;&gt;ç™ºè¡¨ã—ã¾ã—ãŸ&lt;/a&gt;(éš™è‡ªèª)ï½¡
ã“ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«ã‚ˆã‚‹algebraic effectsã®å®Ÿè£…ã¯ï½¤ãƒãƒ³ãƒ‰ãƒ©ãŒdeepã«ãªã£ã¦ã¾ã™ï½¡
&lt;a href=&quot;http://logic.cs.tsukuba.ac.jp/%7Esat/pdf/master_thesis.pdf&quot;&gt;ä¿®è«–&lt;/a&gt;ã§ã¯shallowãªæ–¹ã®åŸ‹ã‚è¾¼ã¿æ–¹æ³•ã‚‚ä¹—ã›ã¦ã„ã‚‹ã‚“ã§ã™ãŒï½¤ã”è¦§ã®é€šã‚Šãªã‚“ã‹ã±ã£ã¨ã—ãªã„ã—åŠ¹ç‡ã‚‚ã‚ˆãç„¡ã•ãã†ã ï½¡&lt;/p&gt;&lt;p&gt;ã¨ã“ã‚ã§ &lt;code&gt;fcontrol/run&lt;/code&gt; ã¨ã„ã†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãŒã‚ã‚‹ã®ã§ã™ãŒ
&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.7256&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;/images/csx_logo_front.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.7256&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Handling Control&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;CiteSeerX - Document Details (Isaac Councill, Lee Giles, Pradeep Teregowda): Non-local control transfer and exception handling have a long tradition in higher-order programming languages such as Common Lisp, Scheme and ML. However, each language stops short of providing a full and complementary approach â€” control handling is provided only  if the corresponding control operator is first-order. In this work, we describe handlers in a higher-order control setting. We invoke our earlier theoretical result that all denotational models of control languages invariably include capabilities that handle control. These capabilities, when incorporated into the language, form an elegant and powerful higher-order generalization of the first-order exception-handling mechanism.  1 Introduction  Control manipulation in applicative programming languages comes in two flavors. First-order control operators allow computations to abort to a dynamically enclosing control context, e.g., Common Lispâ€™s [23, 24]  throw and MLâ€™s [9, 17] raise. They are invariably accompanied by forms thâ€¦&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ã‚ã‚“ã¾ã‚Šã„ã„æ„Ÿã˜ã«æ„å‘³è«–ãŒæ›¸ã‹ã‚Œã¦ãªã„ã‚“ã§&lt;a href=&quot;https://docs.racket-lang.org/reference/cont.html#%28def._%28%28lib._racket%2Fcontrol..rkt%29._fcontrol%29%29&quot;&gt;&lt;code&gt;racket/control&lt;/code&gt; ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ&lt;/a&gt;ã‚ˆã‚Šå¼•ç”¨ã™ã‚‹ã¨&lt;/p&gt;&lt;p&gt;$$
\begin{array}{rcll}
    \left(\%\ \mathit{val}\ \mathit{proc}\right) &amp;amp; \rightarrow &amp;amp; \mathit{val} &amp;amp; \cr
    \left(\%\ E \left[\left(\mathtt{fcontrol}\ \mathit{val}\right)\right] \mathit{proc} \right) &amp;amp; \rightarrow &amp;amp; \left(\mathit{proc}\ \mathit{val}\ \left(\lambda \left(x\right)\ E\left[x\right]\right)\right) &amp;amp; \text{$E$ has no $\%$}
\end{array}
$$&lt;/p&gt;&lt;p&gt;ã¨ãªã£ã¦ã„ã¾ã™ï½¡
&lt;code&gt;%&lt;/code&gt; ã¯&lt;code&gt;run&lt;/code&gt;ã®wrapperã§ï½¤&lt;code&gt;(% exp handler) === (run (Î» () exp) handler)&lt;/code&gt;ã¨ã®ã“ã¨ã§ã™ï½¡
&lt;code&gt;%&lt;/code&gt; ãŒdelimiterã§ &lt;code&gt;fcontrol&lt;/code&gt; ãŒç¶™ç¶šã‚’å–ã‚Šå‡ºã™ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã§ã™ï½¡
é¢ç™½ã„ã®ã¯ &lt;code&gt;shift/reset&lt;/code&gt; ã‚„ &lt;code&gt;control/prompt&lt;/code&gt; ã¨é•ã„ï½¤ &lt;code&gt;fcontrol&lt;/code&gt; è‡ªä½“ã¯ç¶™ç¶šã‚’æ‰±ã‚ãšã«delimiterã® &lt;code&gt;%&lt;/code&gt; ã®å¼•æ•°ã® &lt;code&gt;proc&lt;/code&gt; ãŒç¶™ç¶šã‚’ä½¿ã„ã¾ã™ï½¡
ã‚¢ãƒ¬ãƒƒ?! ã“ã‚Œã™ã§ã« &lt;code&gt;(% â–¡ proc)&lt;/code&gt; ãŒãƒãƒ³ãƒ‰ãƒ©ã§ &lt;code&gt;fcontrol&lt;/code&gt; ãŒã‚¨ãƒ•ã‚§ã‚¯ãƒˆç™ºç”Ÿã˜ã‚ƒã‚“?!
ã¨ã“ã‚ã§Racketã® &lt;code&gt;fcontrol/run&lt;/code&gt; ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚°ãŒä½¿ãˆã¾ã™ï½¡
ã¤ã¾ã‚Š &lt;code&gt;fcontrol&lt;/code&gt; ãŒè©•ä¾¡ã•ã‚ŒãŸã¨ãã«ï½¤ã©ã®delimiterã¾ã§æˆ»ã‚Œã°ã„ã„ã‹ã‚’ã‚¿ã‚°ã«ã‚ˆã‚ŠæŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚“ã§ã™ã­ãˆï½¡
ã“ã“ã§å‰å ±ã§ã™ï½¡multi-prompt shift/resetã«ã‚ˆã‚‹Effè¨€èªã®åŸ‹ã‚è¾¼ã¿ã¯Kiselyovã‚‰ã«ã‚ˆã‚Šç¤ºã•ã‚Œã¦ã„ã¾ã™ï½¡
&lt;/p&gt;&lt;div class=&quot;twicard&quot;&gt;
  &lt;span class=&quot;image&quot;&gt;&lt;a href=&quot;https://www.researchgate.net/publication/308969161_Eff_Directly_in_OCaml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;&lt;div&gt;&lt;img src=&quot;https://i1.rgstatic.net/publication/308969161_Eff_Directly_in_OCaml/links/57fb885c08ae280dd0c4b6d3/largepreview.png&quot;&gt;&lt;/div&gt;&lt;/a&gt;&lt;/span&gt;
  &lt;span class=&quot;txt&quot;&gt;
    &lt;div class=&quot;title&quot;&gt;&lt;a href=&quot;https://www.researchgate.net/publication/308969161_Eff_Directly_in_OCaml&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;(PDF) Eff Directly in OCaml&lt;/a&gt;&lt;/div&gt;
    &lt;div class=&quot;description&quot;&gt;PDF | We present the embedding of the language Eff into OCaml, using the library of delimited continuations or the OCaml-effects branch. The embeddingâ€¦ | Find, read and cite all the research you need on ResearchGate&lt;/div&gt;
  &lt;/span&gt;
&lt;/div&gt;&lt;p&gt;ã‚ˆã—! ã§ã¯å®Ÿè£…ã—ã¾ã—ãŸã¯ã„ã“ã¡ã‚‰&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-racket&quot; data-lang=&quot;racket&quot;&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;lang&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;racket&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;racket/control&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fcontrol&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;prompt-tag&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;default-continuation-prompt-tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;call-with-composable-continuation&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;lambda&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;abort-current-continuation&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;prompt-tag&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;f&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
   &lt;span class=&quot;nv&quot;&gt;prompt-tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Racket v7.6ä»¥å‰ã¯&lt;code&gt;fcontrol/run&lt;/code&gt;ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚°ã‚’æŒ‡å®šã—ã¦ä½¿ã†å ´åˆã«ãƒã‚°ãŒã‚ã£ãŸã®ã§ï½¤æœ€æ–°ã®ç’°å¢ƒã§ãªã„å ´åˆã¯ä¸Šè¨˜ã®ã‚ˆã†ã«&lt;code&gt;fcontrol&lt;/code&gt;ã‚’ä¸Šæ›¸ãã—ã¾ã™ï½¡
æ¬¡ã“ãæœ¬é¡Œã§ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-racket&quot; data-lang=&quot;racket&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;eff&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fcontrol&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;eff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new-effect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-continuation-prompt-tag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;code&gt;eff&lt;/code&gt;ã‚’å¼•æ•°&lt;code&gt;v&lt;/code&gt;ã‚’æ¸¡ã—ã¦ç™ºç”Ÿã•ã›ã‚‹ã®ã§ï½¤ãã®ã¾ã¾&lt;code&gt;fcontrol&lt;/code&gt;ã‚’ä½¿ã„ã¾ã™ï½¡
Racketã®&lt;code&gt;fcontrol&lt;/code&gt;ã§ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«å¼•æ•°&lt;code&gt;#:tag&lt;/code&gt;ã§ã‚¿ã‚°ã‚’æ¸¡ã›ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚°ã«å¯¾å¿œã™ã‚‹ã®ã§ãã®ã¾ã¾ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;ãƒãƒ³ãƒ‰ãƒ©ã®å®Ÿè£…ãŒãƒ¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒƒã‚·ãƒ¥ã§ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-racket&quot; data-lang=&quot;racket&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call-with-shallow-handler&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;eff&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;vh&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;effh&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;th&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let*&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;make-continuation-prompt-tag&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;'return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;effh~&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fcontrol&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;effh&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))]&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;%&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;th&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;effh~&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;eff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))]&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;vh&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:tag&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;(call-with-shalow-handler effe vh effh)&lt;/code&gt;ã§ï½¤ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;code&gt;eff&lt;/code&gt;ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©ã‚’ä½œã‚Šã¾ã™ï½¡
ã‚“ã§ã‚µãƒ³ã‚¯&lt;code&gt;th&lt;/code&gt;ã‚’ã“ã®ãƒãƒ³ãƒ‰ãƒ©ã«æ¸¡ã™ã¨ï½¤ãƒãƒ³ãƒ‰ãƒ©ã®ã‚‚ã¨ã§ã‚µãƒ³ã‚¯ãŒæ½°ã‚Œã¦è©•ä¾¡ãŒèµ°ã‚Šã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;åŸºæœ¬çš„ãªè€ƒãˆæ–¹ã¯éå¸¸ã«ç°¡å˜ï½¤&lt;code&gt;fcontrol/run&lt;/code&gt;ãŒalgebraic effects &amp;amp; handlersã§ã‚ã‚‹ã¨ã„ã†ç›´æ„Ÿã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™ï½¡
&lt;code&gt;(% (th) effh #:tag eff)&lt;/code&gt; ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ&lt;code&gt;eff&lt;/code&gt;ãŒèµ·ããŸã¨ãã«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©&lt;code&gt;effh&lt;/code&gt;ã§ãƒãƒ³ãƒ‰ãƒ«ã—ã¾ã™ï½¡
ã—ã‹ã—&lt;code&gt;fcontrol/run&lt;/code&gt;ã«è¶³ã‚Šãªã„ã‚‚ã®ãŒã‚ã‚‹ï½¡ãªã«ã‹ï½¡value handlerã§ã‚ã‚‹ï½¡
shallow effect handlerã«ãŠã„ã¦value handlerãŒä»‹å…¥ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯deepãªå ´åˆã¨åŒã˜ï½¤å€¤ã‚’ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹å ´åˆã®ã¿ã§ã™ï½¡
ãã—ã¦shallowãªã®ã§ä¸€åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ«ã—ãŸã‚‰ãƒãƒ³ãƒ‰ãƒ©ã¯æ’¤é€€ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ï½¡
ãªã®ã§ã“ã†ã„ã†æˆ¦ç•¥ã§ã„ãã¾ã™ï½¡&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;æˆ»ã‚Šå€¤ã¯å¸¸ã«value handlerã§å–ã‚‹ã‚ˆã†ã«ã™ã‚‹&lt;/li&gt;
&lt;li&gt;ã—ã‹ã—ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã—ãŸã‚‰value handlerã‚’è¿‚å›ã™ã‚‹&lt;/li&gt;
&lt;/ul&gt;&lt;p&gt;ãƒ™ã‚¹ãƒˆã‹? ã¨è¨€ã‚ã‚Œã‚‹ã¨è‡ªä¿¡ãªã„ã§ã™ãŒï½¤ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚ŒãŸå¼ã‚’è©•ä¾¡ã—ãŸã¨ãã«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ã§ãƒãƒ³ãƒ‰ãƒ«ã•ã‚ŒãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°ã‚’æŒã£ã¦ãŠãã®ã¯ãªã‚“ã‹ãƒ€ã‚µã„ã—çŠ¶æ…‹ã‚’æŒã¡ãŸããªã„ã¨ã„ã†ã®ã¯ãƒ”ãƒ¥ã‚¢ãªæ„Ÿè¦šã§ã™ï½¡
ã¾ãŸã‚¿ã‚°ã‚’ã¤ã‘ãŸã‚Šå¤–ã—ãŸã‚Šã‚‚ã¡ã‚‡ã£ã¨é¢å€’ã§ã™ï½¡
ãªã®ã§ä»Šå›ã¯ã©ã†ã«ã‹ã—ã¦è¿‚å›ã—ã¾ã™ï½¡
å¹¸ã„ä»Šå›ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãŒ1ã¤ï½¤&lt;code&gt;fcontrol/run&lt;/code&gt;ãŒä¸ãˆã‚‰ã‚Œã¦ã„ã¾ã™ï½¡
ã—ã‹ã‚‚ä»Šå›ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¿ã‚°ã®ãŠã¾ã‘ä»˜ãã ï½¡
ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æˆ»ã‚Šå€¤ã‚’&lt;code&gt;fcontrol&lt;/code&gt;ã§é£›ã°ã—ã¦value handlerã«æ¸¡ã‚‹ã®ã‚’é˜»æ­¢ã—ã¾ã—ãŸï½¡
å¹ã£é£›ã‚“ã ã¨ãã®ç¶™ç¶šã¯ä½¿ã‚ãªãã¦ã„ã„ã®ã§ï½¤&lt;code&gt;const&lt;/code&gt;é–¢æ•°ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãƒãƒ³ãƒ‰ãƒ©ã®æˆ»ã‚Šå€¤ã ã‘å—ã‘å–ã£ã¦è¿”ã—ã¾ã™ï½¡&lt;/p&gt;&lt;p&gt;ã„ã„æ„Ÿã˜ã˜ã‚ƒãªã„ã§ã™ã‹ï½¡
ãã‚Œã§ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-racket&quot; data-lang=&quot;racket&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;coroutine&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;it&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:mutable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;#:extra-name&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Coroutine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Yield&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new-effect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Yield&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;resume&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;call-with-shallow-handler&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Yield&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
                                   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;set-coroutine-it!&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                                   &lt;span class=&quot;nv&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;coroutine-it&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;co&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;yield&lt;/code&gt;ã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ç™ºç”Ÿï½¤&lt;code&gt;resume&lt;/code&gt;ã¯ãƒãƒ³ãƒ‰ãƒ©ï½¤ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ç¶™ç¶šãŒä¿å­˜ã•ã‚ŒãŸã‚»ãƒ«ã§ã™ï½¡
å®Ÿè£…ã†ã¾ãã„ã£ãŸã‹ãª?&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-racket&quot; data-lang=&quot;racket&quot;&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;coroutine&lt;/span&gt;
           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Î»&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;display&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;hello,&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;displayln&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
                &lt;span class=&quot;p&quot;&gt;))))]&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;begin&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;resume&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;resume&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;co&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;world&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã“ã„ã¤ï½¤å‹•ããâ€¦â€¦!&lt;/p&gt;&lt;h1 id=&quot;4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB&quot;&gt;4. ãŠã‚ã‚Šã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;&lt;code&gt;fcontrol/run&lt;/code&gt;ã¨ã„ã†ãŠã‚‚ã—ã‚ã„ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã¨ãã‚Œã‚’åˆ©ç”¨ã—ãŸshallow effect handlerã®å®Ÿè£…ã‚’ç´¹ä»‹ã—ã¾ã—ãŸï½¡
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒã¨ã‹ä»–ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã¨ã®é–¢ä¿‚ã¯èª­è€…ã®çš†ã•ã‚“ã®èª²é¡Œã¨å‹æ‰‹ã«ã•ã›ã¦ï½¤ãˆãˆï½¤ã„ãŸã ãã¾ã™ï½¡
å¤ä¼‘ã¿æœ€çµ‚æ—¥ã«çµ¶æœ›ã™ã‚‹å°å­¦ç”Ÿã«ãªã‚‰ãªã„ã‚ˆã†ã«ï½¤æ—¥ã€…ã“ã¤ã“ã¤ã¨å–ã‚Šçµ„ã‚“ã§ãã ã•ã„ï½¡&lt;/p&gt;&lt;hr&gt;&lt;p&gt;ã‚¨ãƒƒä¿®è«–?! ä¿ºã¯å’æ¥­ã—ãŸã®ã‹â€¦â€¦ï½¡&lt;/p&gt;</description>
        <pubDate>Thu, 20 Feb 2020 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2020/02/20/shallow_effec_handler_with_fcontrol.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2020/02/20/shallow_effec_handler_with_fcontrol.html</guid>
        
        <category>Algebraic Effects</category>
        
        <category>Delimited Continuation</category>
        
        <category>Racket</category>
        
        
      </item>
    
      <item>
        <title>ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«éƒ¨åˆ†å‹ã®ã‚ã‚‹ä»£æ•°çš„åŠ¹æœã€</title>
        <enclosure type="image/png" length="0" url="/pictures/github_icon.png"></enclosure>
        <description>&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
ã“ã‚Œã¯&lt;a href=&quot;https://qiita.com/advent-calendar/2019/type&quot;&gt;å‹Advent Calendar 2019&lt;/a&gt;ã®9æ—¥ç›®ã®è¨˜äº‹ã®è¨˜äº‹ã§ã™ï½¡
ç©ºã„ã¦ã‚‹ã®ã§9æ—¥ç›®ã«ã‚¿ã‚¤ãƒ ã‚¹ãƒªãƒƒãƒ—ã—ã¦&lt;a href=&quot;https://nymphium.github.io/2019/12/09/ae-poly.html&quot;&gt;å‰æ—¥&lt;/a&gt;ã«ç¶šã„ã¦è¨˜äº‹ã‚’çªã£è¾¼ã¿ã¾ã—ãŸï½¡&lt;/p&gt;&lt;p&gt;å®Ÿéš›ã®è¨˜äº‹ã¯ã“ã¡ã‚‰: &lt;a href=&quot;/src/2019/12/22/effsub/main.pdf&quot;&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«éƒ¨åˆ†å‹ã®ã‚ã‚‹ä»£æ•°çš„åŠ¹æœ(pdf)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;å®Ÿè£…ãŒå…ˆç«‹ã£ã¦ãŸã‚‚ã®ã‚’é©å½“ã«å®šå¼åŒ–ã—ã¾ã—ãŸï½¡&lt;/p&gt;</description>
        <pubDate>Sun, 22 Dec 2019 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2019/12/22/effsub.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2019/12/22/effsub.html</guid>
        
        <category>å‹</category>
        
        <category>Advent Calendar</category>
        
        
      </item>
    
      <item>
        <title>ã€ãã®è¨€èªï½¤å®šç¾©ã•ã‚Œã¦ã¾ã™ã‹ã€</title>
        <enclosure type="image/png" length="0" url="/pictures/github_icon.png"></enclosure>
        <description>&lt;p&gt;ã“ã‚“ã«ã¡ã¯ï½¤ã³ã—ã‚‡ã€œã˜ã‚‡ã§ã™ï½¡
ã“ã‚Œã¯&lt;a href=&quot;https://qiita.com/advent-calendar/2019/lang_dev&quot;&gt;è¨€èªå®Ÿè£…Advent Calendar 2019&lt;/a&gt;ã®15æ—¥ç›®ã®è¨˜äº‹ã®è¨˜äº‹ã§ã™ï½¡&lt;/p&gt;&lt;p&gt;å®Ÿéš›ã®è¨˜äº‹ã¯ã“ã¡ã‚‰: &lt;a href=&quot;/src/2019/12/15/%E3%80%8E%E3%81%9D%E3%81%AE%E8%A8%80%E8%AA%9E%EF%BD%A4%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B%E3%80%8F/main.pdf&quot;&gt;ãã®è¨€èªï½¤å®šç¾©ã•ã‚Œã¦ã¾ã™ã‹(pdf)&lt;/a&gt;&lt;/p&gt;&lt;p&gt;\(\LaTeX\)è¨˜æ³•ã‚’ãƒãƒ³ãƒãƒ³ä½¿ã†ãŸã‚\(\KaTeX\)ã¯ã‚¤ãƒ©ã‚¤ãƒ©ã—ã¦å°ãƒ‘ãƒ³ã—ã¡ã‚ƒã†ã¨æ€ã†ã‚“ã§ï½¤ç´ ç›´ã«\(\LaTeX\)ä½¿ã‚ã›ã¦ã„ãŸã ãã¾ã™ï½¡
æœ¬è¨˜äº‹ã¯ã€ãã®è¨€èªï½¤å®šç¾©ã•ã‚Œã¦ã¾ã™ã‹ã€ã®ãƒã‚¤ãƒ³ã‚¿ã§ã™ï½¡&lt;/p&gt;</description>
        <pubDate>Sun, 15 Dec 2019 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2019/12/15/%E3%81%9D%E3%81%AE%E8%A8%80%E8%AA%9E-%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2019/12/15/%E3%81%9D%E3%81%AE%E8%A8%80%E8%AA%9E-%E5%AE%9A%E7%BE%A9%E3%81%95%E3%82%8C%E3%81%A6%E3%81%BE%E3%81%99%E3%81%8B.html</guid>
        
        <category>è¨€èªå®Ÿè£…</category>
        
        <category>Advent Calendar</category>
        
        
      </item>
    
      <item>
        <title>Algebraic Effectsã®å‹ã‚·ã‚¹ãƒ†ãƒ å…¥é–€(2) å¤šç›¸ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ</title>
        <enclosure type="image/png" length="0" url="/pictures/github_icon.png"></enclosure>
        <description>&lt;h1 id=&quot;%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB&quot;&gt;ã¯ã˜ã‚ã«&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã‚Œã¯&lt;a href=&quot;https://nymphium.github.io/2019/08/10/ae-type-system.html&quot;&gt;å‰å›&lt;/a&gt;ã®ç¶šãã§ã‚ã‚Šï½¤&lt;a href=&quot;https://qiita.com/advent-calendar/2019/type&quot;&gt;å‹ Advent Calendar 2019&lt;/a&gt;ã®8æ—¥ç›®ã®è¨˜äº‹ã§ï½¤è§¦ã‚Œã‚‰ã‚Œãªã‹ã£ãŸå¤šç›¸ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã§ã™ï½¡&lt;/p&gt;&lt;hr&gt;&lt;p&gt;ä¸€ç¬å‡ºã¦ããŸå¤šç›¸ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with_option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;None&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¾ãšã¯ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®šç¾©ã‚’ã˜ã£ã¨çœºã‚ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;'a option&lt;/code&gt;ã‚’å—ã‘å–ã£ã¦ç¶™ç¶šã«&lt;code&gt;'a&lt;/code&gt;ã‚’æ¸¡ã™ã¨ã„ã†å‹ã§ã‚ã‚‹ï½¡&lt;code&gt;'a&lt;/code&gt;ã¨ã„ã†å‹å¤‰æ•°ã§å…¨ç§°é‡åŒ–ã•ã‚Œã¦ã„ã‚‹ã®ã§å¤šç›¸ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï½¡&lt;/p&gt;&lt;p&gt;ãƒãƒ³ãƒ‰ãƒ©&lt;code&gt;with_option&lt;/code&gt;ã¯&lt;code&gt;'a option -&amp;gt; ('a -&amp;gt; 'b) -&amp;gt; 'b&lt;/code&gt; ã®ã‚ˆã†ã«ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’å‰¥ãŒã—ã¦ãã‚Œã‚‹ï½¡
ãã—ã¦&lt;code&gt;None&lt;/code&gt;ãŒæ¸¡ã•ã‚ŒãŸå ´åˆã«ã¯&lt;code&gt;None&lt;/code&gt;ã‚’ãã®ã¾ã¾è¿”ã™ï½¡
å‰å›ã®å†…å®¹ã«æ²¿ã†ã¨ï½¤ãƒãƒ³ãƒ‰ãƒ©ã®å‹ã¯&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with_option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ã¨ãªã‚‹ï½¡
ã™ãªã‚ã¡ï½¤&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;with_option&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string_of_int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* ==&amp;gt; Some &quot;8&quot; *)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Option Monadãƒ©ã‚¤ã‚¯ãªã“ã¨ãŒã§ãã‚‹ï½¡&lt;/p&gt;&lt;p&gt;ã¨ã“ã‚ã§&lt;code&gt;int option&lt;/code&gt;ã®ä¸­èº«ã®&lt;code&gt;int&lt;/code&gt;ã‚’ã©ã†ã«ã‹ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with_add5_option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;c&quot;&gt;(* ... *)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Ÿã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã¯å•é¡ŒãŒã‚ã‚‹ï½¡
ãŸã¨ãˆã°&lt;code&gt;t&lt;/code&gt;ã‚’è¿”ã—ã¤ã¤&lt;code&gt;Option&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒç™ºç”Ÿã™ã‚‹å¼ã®å‹ã¯&lt;code&gt;t!{Option}&lt;/code&gt;ã¨ãªã‚Šï½¤å®Ÿéš›ã«&lt;code&gt;Option&lt;/code&gt;ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã«æ¸¡ã•ã‚Œã‚‹&lt;code&gt;'a option&lt;/code&gt;ã®&lt;code&gt;'a&lt;/code&gt;ã¯ä½•å‹ãªã®ã‹æƒ…å ±ãŒãªã„ï½¡
ã¤ã¾ã‚Šãƒãƒ³ãƒ‰ãƒ©ã§ã¯&lt;code&gt;'a option&lt;/code&gt;ã®&lt;code&gt;'a&lt;/code&gt;ã«æ”¾ã‚Šè¾¼ã¾ã‚Œã‚‹å‹æƒ…å ±ã‚’ä½¿ãˆãªã„ãŸã‚ï½¤ä¸Šè¨˜ã®ã‚ˆã†ã«å…·ä½“çš„ãªå‹(&lt;code&gt;int&lt;/code&gt;)ã‚’ä½¿ã£ãŸã‚³ãƒ¼ãƒ‰ã¯æ›¸ã‘ãªã„ï½¡
ãŠæ‰‹å…ƒã®Multicore OCamlã‚„Effã§&lt;code&gt;with_add5_option&lt;/code&gt;ã®ã‚ˆã†ãªé–¢æ•°ã‚’æ›¸ãã¨ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒæ€’ã£ã¦ãã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;
&lt;span class=&quot;listing-name&quot;&gt;4.06.1+multicoreã«èµ·ã“ã‚‰ã‚Œã‚‹ä¾‹&lt;/span&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with_add5_option&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;match&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;th&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;continue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;(* ... *)&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;Error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;This&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expression&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;has&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;but&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;an&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expression&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;was&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;type&lt;/span&gt;
         &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;(* `'a` ãŒ `effect` ã¨ã„ã†å‹åã«unifyã•ã‚Œã¦ã„ã‚‹ *)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;h1 id=&quot;polymorphic+effects+and+parameterized+effects&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#polymorphic+effects+and+parameterized+effects&quot;&gt;polymorphic effects and parameterized effects&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ä»–ã«ã‚‚å¤šç›¸ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚¶ã‚¤ãƒ³æ–¹æ³•ãŒã‚ã‚‹ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;n&quot;&gt;effect&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kokaã‚„Linksãªã©ã§ã¯ã“ã®ã‚ˆã†ã«ï½¤å‹å¤‰æ•°ãŒã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å¼•æ•°ã®å¤–å´ã«ã‚ã‚‹ï½¤ã¤ã¾ã‚Š&lt;code&gt;'a&lt;/code&gt;ã§ãƒ‘ãƒ©ãƒ¡ã‚¿ãƒ©ã‚¤ã‚ºã•ã‚Œã¦ã„ã‚‹ï½¡
ã“ã®ã‚ˆã†ãªå¤šç›¸ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®è¡¨ç¾æ–¹æ³•ã‚’ &lt;strong&gt;parameterized effects&lt;/strong&gt; ã¨å‘¼ã¶ï½¡
ä¸€æ–¹ï½¤ã“ã‚Œã¾ã§ã«ç´¹ä»‹ã—ã¦ããŸï½¤Effãªã©ã®å¤šç›¸ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®šç¾©ã‚’ &lt;strong&gt;polymorphic effects&lt;/strong&gt; ã¨å‘¼ã¶ï½¡&lt;/p&gt;&lt;p&gt;parameterized effectsãªã‚‰ä¸Šè¨˜ã®ã‚ˆã†ãªãƒãƒ³ãƒ‰ãƒ©å†…ã§å…·ä½“çš„ãªå‹ã®å®Ÿè£…ãŒã§ããã†ã ï½¡&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ocaml&quot; data-lang=&quot;ocaml&quot;&gt;&lt;span class=&quot;k&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with_add5_option&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;option&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ãŸã¨ãˆã°parameterized effectsã‚’æ¡ç”¨ã—ã¦ã„ã‚‹Kokaè¨€èªãªã‚‰OK&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-&quot; data-lang=&quot;&quot;&gt;effect option&amp;lt;a&amp;gt; {
  fun option(v : maybe&amp;lt;a&amp;gt;): a
}

val with_add5_option : forall &amp;lt;a&amp;gt; (() -&amp;gt; &amp;lt;option&amp;lt;int&amp;gt;&amp;gt; maybe&amp;lt;a&amp;gt;) -&amp;gt; maybe&amp;lt;a&amp;gt;
= handler {
  option(m) -&amp;gt; match(m) {
    Just(v) -&amp;gt; resume(v + 5)
    Nothing -&amp;gt; Nothing
  }
  return x -&amp;gt; x
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»–ã«ã‚‚ï½¤continuation monadã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯parameterized effectsã§ã¯ã§ãã¾ã™ãŒpolymorphic effectsã§ã¯ã§ãã¾ã›ã‚“ï½¡&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;Multicore OCamlã«ã‚ˆã‚‹å®Ÿè£…(RTEã™ã‚‹) &lt;a href=&quot;https://gist.github.com/Nymphium/01619c1c63595afef20ae35984680358&quot;&gt;https://gist.github.com/Nymphium/01619c1c63595afef20ae35984680358&lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;Kokaã«ã‚ˆã‚‹å®Ÿè£…(well-typed) &lt;a href=&quot;https://gist.github.com/Nymphium/3632858aa979d97a07f113ec0a7f629f&quot;&gt;https://gist.github.com/Nymphium/3632858aa979d97a07f113ec0a7f629f&lt;/a&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;h1 id=&quot;%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB%28%E6%9C%AA%E5%AE%8C%29&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB%28%E6%9C%AA%E5%AE%8C%29&quot;&gt;ãŠã‚ã‚Šã«(æœªå®Œ)&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;row-based effect systemã¨ã‹ã«è©±ã‚’ã¤ãªã’ã¦ã„ããŸã‹ã£ãŸãŒç­†è€…ã®èªè­˜ãŒé–“é•ã„ã¾ãã£ã¦ãŸã®ã§æ–‡çŒ®ã‚’è¦‹ç›´ã™å¿…è¦ãŒã‚ã‚‹ã®ã§ã¾ãŸä»Šåº¦â€¦ï½¡&lt;/p&gt;&lt;h1 id=&quot;%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE&quot;&gt;&lt;a class=&quot;headerlink&quot; href=&quot;#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE&quot;&gt;å‚è€ƒæ–‡çŒ®&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;ã“ã®ã‚ãŸã‚Šã‚’èª­ã‚€ã¨æœ¬è¨˜äº‹ã§æœ¬æ¥æ›¸ã‹ã‚Œã‚‹ã¯ãšã ã£ãŸå†…å®¹ãŒåˆ†ã‹ã‚Šã¾ã™ï½¡&lt;/p&gt;&lt;ul&gt;
&lt;li&gt;Sekiyama, Taro, and Atsushi Igarashi. â€œHandling polymorphic algebraic effects.â€ European Symposium on Programming. Springer, Cham, 2019.&lt;/li&gt;
&lt;li&gt;Kammar, Ohad, and Matija Pretnar. â€œNo value restriction is needed for algebraic effects and handlers.â€ Journal of Functional Programming 27 (2017).&lt;/li&gt;
&lt;li&gt;Leijen, Daan. Algebraic Effects for Functional Programming. Technical Report. 15 pages. &lt;a href=&quot;https://www.microsoft.com/en-us/research/publication/algebraic-effects-for-functional-programming&quot;&gt;https://www.microsoft.com/en-us/research/publication/algebraic-effects-for-functional-programming&lt;/a&gt;, 2016.&lt;/li&gt;
&lt;/ul&gt;</description>
        <pubDate>Mon, 09 Dec 2019 00:00:00 +0900</pubDate>
        <link>https://nymphium.github.io/2019/12/09/ae-poly.html</link>
        <guid isPermaLink="true">https://nymphium.github.io/2019/12/09/ae-poly.html</guid>
        
        <category>OCaml</category>
        
        <category>å‹ã‚·ã‚¹ãƒ†ãƒ </category>
        
        <category>Algebraic Effects</category>
        
        <category>Koka</category>
        
        <category>Advent Calendar</category>
        
        
      </item>
    
  </channel>
</rss>
