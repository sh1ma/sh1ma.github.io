<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=UTF-8" http-equiv="content-type"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="format-detection" content="telephone=no"/>

    <title>Menhirが便利 - lilyum ensemble</title>
    <meta itemprop="name" content="Menhirが便利 - lilyum ensemble"/>
    <meta name="keywords" content="OCaml,WORD"/>
    <meta name="thumbnail" content="https://nymphium.github.io/pictures/github_icon.png"/>
    <meta itemprop="image" content="https://nymphium.github.io/pictures/github_icon.png"/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="lilyum ensemble"/>
    <meta name="twitter:title" content="Menhirが便利 - lilyum ensemble"/>
    <meta name="twitter:url" content="https://nymphium.github.io/2017/12/03/Menhir%E3%81%8C%E4%BE%BF%E5%88%A9.html"/> 
    <meta name="twitter:text:description" content="こんにちは､びしょ〜じょです｡これはWORD Advent Calendar 2017の記事です｡12月3日といえば冴草きいちゃんの誕生日!!!! みんなで祝いましょう｡と思ったら『NEW GA..."/>
    <meta name="twitter:image:src" content="https://nymphium.github.io/pictures/github_icon.png"/>

    <link rel="icon" type="image/x-icon" href="/favicon.ico"/>
    <link rel="stylesheet" href="/css/main.css"/>
    <link rel="alternate" type="application/rss+xml" title="lilyum ensemble" href="https://nymphium.github.io/feed.xml"/>
    <link href="https://fonts.googleapis.com/css?family=Comfortaa:300%7CDroid+Sans+Mono%7CCrimson+Text:400,400i" rel="stylesheet"/>
<!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.4" />
<meta property="og:title" content="Menhirが便利" />
<meta name="author" content="Satoru Kawahara" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="lily, Aikatsu, Programming language, and more" />
<meta property="og:description" content="lily, Aikatsu, Programming language, and more" />
<link rel="canonical" href="https://nymphium.github.io/2017/12/03/Menhir%E3%81%8C%E4%BE%BF%E5%88%A9.html" />
<meta property="og:url" content="https://nymphium.github.io/2017/12/03/Menhir%E3%81%8C%E4%BE%BF%E5%88%A9.html" />
<meta property="og:site_name" content="lilyum ensemble" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-12-03T00:00:00+09:00" />
<script type="application/ld+json">
{"description":"lily, Aikatsu, Programming language, and more","@type":"BlogPosting","url":"https://nymphium.github.io/2017/12/03/Menhir%E3%81%8C%E4%BE%BF%E5%88%A9.html","headline":"Menhirが便利","dateModified":"2017-12-03T00:00:00+09:00","datePublished":"2017-12-03T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nymphium.github.io/2017/12/03/Menhir%E3%81%8C%E4%BE%BF%E5%88%A9.html"},"author":{"@type":"Person","name":"Satoru Kawahara"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta property="og:image" content="https://nymphium.github.io/pictures/github_icon.png"/>
  </head>

  <body>
    <header class="site-header">
      <div class="wrapper" style="font-family: 'Comfortaa';">
        <a class="site-title" href="/">lilyum ensemble</a>
        <nav class="site-nav">
          <div class="trigger">
            <a class="page-link" href="/aboutme.html">About</a>
            <a class="page-link" href="/slide.html">Slides</a>
            <a class="page-link" href="/tags.html">Tags</a>
          </div>
        </nav>
      </div>
    </header>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">Menhirが便利</h1>
            <span class="post-meta">
              <time datetime="2017-12-03T00:00:00+09:00" itemprop="datePublished">Dec 3, 2017</time>
              <p class="tags">tag: {<a href="/tags.html#OCaml-ref">OCaml</a>, <a href="/tags.html#WORD-ref">WORD</a>}</p>
              <a class="twitter-share-button" href="https://twitter.com/intent/tweet" target="_blank" rel="noopener noreferrer">Tweet</a>
            </span>
            <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
            <script type="text/javascript" src="/js/GithubRepoWidget.min.js"></script>
            <script type="text/javascript">setTimeout(GithubRepoWidget.init, 3000);</script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.css" integrity="sha384-9tPv11A+glH/on/wEu99NVwDPwkMQESOocs/ZGXPoIiLE8MU/qkqUcZ3zzL+6DuH" crossorigin="anonymous">
            <!-- The loading of KaTeX is deferred to speed up page rendering -->
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/katex.min.js" integrity="sha384-U8Vrjwb8fuHMt6ewaCy8uqeUXv4oitYACKdB0VziCerzt011iQ/0TqlSlv8MReCm" crossorigin="anonymous"></script>
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0-beta/dist/contrib/auto-render.min.js" integrity="sha384-aGfk5kvhIq5x1x5YdvCp4upKZYnA8ckafviDpmWEKp4afOZEqOli7gqSnh8I6enH" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
          </header>
          <div class="post-content" itemprop="articleBody">
<p>こんにちは､びしょ〜じょです｡これは<a href="https://adventar.org/calendars/2573" target="_blank" rel="noopener noreferrer">WORD Advent Calendar 2017</a>の記事です｡</p>
<p>12月3日といえば冴草きいちゃんの誕生日!!!! みんなで祝いましょう｡
と思ったら『NEW GAME!』の遠山りんさんの誕生日でもあるのか!! この日はめでたいなぁ､国民の祝日にしましょう｡</p>
<h1 id="WORD%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B"><a class="headerlink" href="#WORD%E3%81%A8%E3%81%AF%E4%BD%95%E3%81%8B">WORDとは何か</a></h1>
<p></p>
<center>
<span style="font-size: XX-LARGE">!!!以下に詳細が!!!</span>

<p><a href="https://www.word-ac.net/about/" target="_blank" rel="noopener noreferrer">https://www.word-ac.net/about/</a>
</p>
</center>
<h1 id="1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB"><a class="headerlink" href="#1.+%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">1. はじめに</a></h1>
<p>みなさんOCamlは書いてますか｡今年はほとんどOCamlとLaTeXしか書いてません｡
OCamlといえばメタランゲージとのことですので､メタランゲージでランゲージを作りたくなります｡
syntax.mlみたいなファイルにデータタイプを定義して､そのあとどうしますか｡
全部手打ちでしょうか､それとも…</p>
<h1 id="2.+%E3%83%91%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC"><a class="headerlink" href="#2.+%E3%83%91%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%8D%E3%83%AC%E3%83%BC%E3%82%BF%E3%83%BC">2. パーザージェネレーター</a></h1>
<p>人類は偉い!
人類は偉いのでパーザー自体を書かずともいい雰囲気のものを書くとパーザーを作ってくれる<em>パーザージェネレーター</em>というものがあります｡
(中略)</p>
<h1 id="3.+Menhir"><a class="headerlink" href="#3.+Menhir">3. Menhir</a></h1>
<p>OCamlといえばocamlyaccを先に思いつきがちですが､Menhir<sup id="fnref1" title="http://gallium.inria.fr/~fpottier/menhir/ "><a href="#fn1" rel="footnote">1</a></sup>という便利なLR(1)パーザージェネレーターがあります｡
ocamlyaccよりも高機能で､menhirコマンドにも多くの便利オプションがあります｡</p>
<h2 id="3-1.+%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3"><a class="headerlink" href="#3-1.+%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3">3-1. セッション</a></h2>
<p>まずMenhirをインストールしてください｡OPAMやOSのパッケージマネージャーを使ってください｡</p>
<div class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><span class="gp">$</span> opam <span class="nb">install </span>menhir
<span class="gp">#</span> とか
<span class="gp">$</span> yaourt <span class="nt">-S</span> ocaml-menhir <span class="c"># Archには公式リポジトリーに入ってない! 残念</span>
</code></pre></div>
<p>以下のようなuntyped lambda calculus + listを考える｡</p>
<div>
$$
\begin{array}{rcl}
S    &amp; \leftarrow &amp; Term\\
Term &amp; \leftarrow &amp; Lamb\ /\ Var\ /\ List\ /\ App\\
Lamb &amp; \leftarrow &amp; “\backslash”\ Var\ “.”\ Term\\
Var  &amp; \leftarrow &amp; \left[a\text{-}zA\text{-}Z\right]\left[a\text{-}zA\text{-}Z0\text{-}9\right]*\\
List &amp; \leftarrow &amp; “\left[” \left(\left(Term\ “,”\right)*\ Term\right)? “\right]”\\
App  &amp; \leftarrow &amp; Term\ Term
\end{array}
$$
</div>
<p>こんな感じだろうか｡</p>
<p><a href="/src/menhir_example/syntax.ml">src/menhir_example/syntax.ml</a></p>
<div class="codeline with_caption"><pre>1
2
3
4
5</pre></div>
<div class="highlight">
<span class="listing-name">syntax.ml</span><pre><code class="language-ocaml" data-lang="ocaml"><span class="k">type</span> <span class="n">term</span> <span class="o">=</span>
  <span class="o">|</span> <span class="nc">Var</span> <span class="k">of</span> <span class="kt">string</span>
  <span class="o">|</span> <span class="nc">Lamb</span> <span class="k">of</span> <span class="kt">string</span> <span class="o">*</span> <span class="n">term</span>
  <span class="o">|</span> <span class="nc">App</span> <span class="k">of</span> <span class="n">term</span> <span class="o">*</span> <span class="n">term</span>
  <span class="o">|</span> <span class="nc">List</span> <span class="k">of</span> <span class="n">term</span> <span class="kt">list</span>
</code></pre>
</div>
<p>今回はシンタックスだけ考えればいいから､もうええわ｡</p>
<p>パーザーにレキサーあり､という格言の通り､対応するレキサーを書きます｡</p>
<p><a href="/src/menhir_example/lexer.mll">src/menhir_example/lexer.mll</a></p>
<div class="codeline with_caption"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div>
<div class="highlight">
<span class="listing-name">lexer.mll</span><pre><code class="language-ocaml" data-lang="ocaml"><span class="p">{</span>
    <span class="k">open</span> <span class="nc">Parser</span>
    <span class="k">open</span> <span class="nc">Lexing</span>
    <span class="k">exception</span> <span class="nc">Error</span> <span class="k">of</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">let</span> <span class="n">space</span> <span class="o">=</span> <span class="p">[</span><span class="k">'</span> <span class="k">'</span> <span class="sc">'\t'</span> <span class="sc">'\n'</span> <span class="sc">'\r'</span><span class="p">]</span>
<span class="k">let</span> <span class="n">digit</span> <span class="o">=</span> <span class="p">[</span><span class="k">'</span><span class="mi">0</span><span class="k">'</span><span class="o">-</span><span class="k">'</span><span class="mi">9</span><span class="k">'</span><span class="p">]</span>
<span class="k">let</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="k">'</span><span class="n">a'</span><span class="o">-</span><span class="k">'</span><span class="n">z'</span> <span class="k">'</span><span class="nc">A'</span><span class="o">-</span><span class="k">'</span><span class="nc">Z'</span><span class="p">]</span>
<span class="k">let</span> <span class="n">alnum</span> <span class="o">=</span> <span class="n">digit</span> <span class="o">|</span> <span class="n">alpha</span>

<span class="n">rule</span> <span class="n">token</span> <span class="o">=</span> <span class="n">parse</span>
    <span class="o">|</span> <span class="sc">'\\'</span>          <span class="p">{</span> <span class="nc">BACKSLASH</span>                            <span class="p">}</span>
    <span class="o">|</span> <span class="sc">'.'</span>           <span class="p">{</span> <span class="nc">DOT</span>                                  <span class="p">}</span>
    <span class="o">|</span> <span class="k">'</span><span class="o">,</span><span class="k">'</span>           <span class="p">{</span> <span class="nc">COMMA</span>                                <span class="p">}</span>
    <span class="o">|</span> <span class="k">'</span><span class="p">[</span><span class="k">'</span>           <span class="p">{</span> <span class="nc">LBRAC</span>                                <span class="p">}</span>
    <span class="o">|</span> <span class="k">'</span><span class="p">]</span><span class="k">'</span>           <span class="p">{</span> <span class="nc">RBRAC</span>                                <span class="p">}</span>
    <span class="o">|</span> <span class="k">'</span><span class="p">(</span><span class="k">'</span>           <span class="p">{</span> <span class="nc">LPAREN</span>                               <span class="p">}</span>
    <span class="o">|</span> <span class="k">'</span><span class="p">)</span><span class="k">'</span>           <span class="p">{</span> <span class="nc">RPAREN</span>                               <span class="p">}</span>
    <span class="o">|</span> <span class="n">xlower</span> <span class="n">alnum</span><span class="o">*</span> <span class="p">{</span> <span class="nc">VAR</span> <span class="p">(</span><span class="n">lexeme</span> <span class="n">lexbuf</span><span class="p">)</span>                  <span class="p">}</span>
    <span class="o">|</span> <span class="n">space</span><span class="o">+</span>        <span class="p">{</span> <span class="n">token</span> <span class="n">lexbuf</span>                         <span class="p">}</span>
    <span class="o">|</span> <span class="n">eof</span>           <span class="p">{</span> <span class="nc">EOF</span>                                  <span class="p">}</span>
    <span class="o">|</span> <span class="n">_</span>             <span class="p">{</span> <span class="k">raise</span> <span class="p">(</span><span class="nc">Error</span> <span class="p">(</span><span class="nn">Printf</span><span class="p">.</span><span class="n">sprintf</span> <span class="s2">"At offset %d: unexpected character.</span><span class="se">\n</span><span class="s2">"</span> <span class="p">(</span><span class="nn">Lexing</span><span class="p">.</span><span class="n">lexeme_start</span> <span class="n">lexbuf</span><span class="p">)))</span>
                                                           <span class="p">}</span>
</code></pre>
</div>
<p>Menhirもocamllexを呼んでる(と思う)んでここは共通やね｡</p>
<h2 id="3-2.+review+ocamlyacc"><a class="headerlink" href="#3-2.+review+ocamlyacc">3-2. review ocamlyacc</a></h2>
<p>リメンバーocamlyacc､ということじゃ｡</p>
<p><a href="/src/menhir_example/parser.mly">src/menhir_example/parser.mly</a></p>
<div class="codeline with_caption"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div>
<div class="highlight">
<span class="listing-name">parser1.mly</span><pre><code class="language-ocaml" data-lang="ocaml"><span class="o">%</span><span class="p">{</span>
<span class="k">open</span> <span class="nc">Syntax</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%</span><span class="n">token</span> <span class="nc">LBRAC</span> <span class="nc">RBRAC</span> <span class="nc">LPAREN</span> <span class="nc">RPAREN</span> <span class="nc">BACKSLASH</span> <span class="nc">DOT</span> <span class="nc">COMMA</span>
<span class="o">%</span><span class="n">token</span> <span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span> <span class="nc">VAR</span>
<span class="o">%</span><span class="n">token</span> <span class="nc">EOF</span>

<span class="o">%</span><span class="n">start</span> <span class="n">parse</span>
<span class="o">%</span><span class="k">type</span> <span class="o">&lt;</span><span class="n">term</span><span class="o">&gt;</span> <span class="n">parse</span>
<span class="o">%%</span>

<span class="n">parse</span><span class="o">:</span> <span class="o">|</span> <span class="n">term</span> <span class="nc">EOF</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
<span class="n">term</span><span class="o">:</span>  <span class="o">|</span> <span class="n">lamb</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="nc">VAR</span> <span class="p">{</span> <span class="nc">Var</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">lst</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">app</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="nc">LPAREN</span> <span class="n">term</span> <span class="nc">RPAREN</span> <span class="p">{</span> <span class="o">$</span><span class="mi">2</span> <span class="p">}</span>
<span class="n">lamb</span><span class="o">:</span>  <span class="o">|</span> <span class="nc">BACKSLASH</span> <span class="nc">VAR</span> <span class="nc">DOT</span> <span class="n">term</span> <span class="p">{</span> <span class="nc">Lamb</span><span class="p">(</span><span class="o">$</span><span class="mi">2</span><span class="o">,</span> <span class="o">$</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
<span class="n">app</span><span class="o">:</span>   <span class="o">|</span> <span class="n">term</span> <span class="n">term</span> <span class="p">{</span> <span class="nc">App</span><span class="p">(</span><span class="o">$</span><span class="mi">1</span><span class="o">,</span> <span class="o">$</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="n">lstcont</span><span class="o">:</span>
       <span class="o">|</span> <span class="p">{</span> <span class="bp">[]</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">term</span> <span class="p">{</span> <span class="p">[</span><span class="o">$</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">term</span> <span class="nc">COMMA</span> <span class="n">lstcont</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="o">::</span> <span class="o">$</span><span class="mi">3</span> <span class="p">}</span>
<span class="n">lst</span><span class="o">:</span>   <span class="o">|</span> <span class="nc">LBRAC</span> <span class="n">lstcont</span> <span class="nc">RBRAC</span> <span class="p">{</span> <span class="nc">List</span> <span class="o">$</span><span class="mi">2</span> <span class="p">}</span>
</code></pre>
</div>
<p>[<a href="#fn1">1</a>]によるとocamlyaccと90%の互換性があるということで､ocamlyaccが受理できるmlyファイルはmenhirも受理します｡</p>
<div class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><span class="gp">$</span> <span class="nb">ls</span>
<span class="go">lexer.mll  parser.mly  syntax.ml
</span><span class="gp">$</span> ocamlyacc parser.mly
<span class="go">8 shift/reduce conflicts.
</span><span class="gp">$</span> menhir parse.mly
<span class="go">Warning: 2 states have shift/reduce conflicts.
Warning: 8 shift/reduce conflicts were arbitrarily resolved.
</span></code></pre></div>
<p>ええですな｡</p>
<h2 id="3-3.+dive+to+deep"><a class="headerlink" href="#3-3.+dive+to+deep">3-3. dive to deep</a></h2>
<h3 id="3-3-1.+naming+token"><a class="headerlink" href="#3-3-1.+naming+token">3-3-1. naming token</a></h3>
<p><code>{}</code>の中でトークンを参照するときに<code>$1</code>とかやるの面倒くさい!
複雑になってくると何番目のトークンかをいちいち数えるのは面倒ですね｡
ここでトークンに名前を付けられるという素晴らしいアレがあります｡
<code>lamb</code>ルールをやっていっましょう｡</p>
<div class="highlight"><pre><code class="language-ocaml" data-lang="ocaml"><span class="n">lamb</span><span class="o">:</span> <span class="o">|</span> <span class="nc">BACKSLASH</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">VAR</span> <span class="nc">DOT</span> <span class="n">t</span> <span class="o">=</span> <span class="n">term</span> <span class="p">{</span> <span class="nc">Lamb</span><span class="p">(</span><span class="n">x</span><span class="o">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
<p>オオ! これはわかりやすい｡</p>
<h3 id="3-3-2.+parameterized+rule"><a class="headerlink" href="#3-3-2.+parameterized+rule">3-3-2. parameterized rule</a></h3>
<p>非常に便利な関数がいくつか用意されている｡
<code>lstcont</code>､<code>lst</code>ルールをもっと賢くエイヤッとやってみましょう｡</p>
<div class="highlight"><pre><code class="language-ocaml" data-lang="ocaml"><span class="n">lst</span><span class="o">:</span> <span class="o">|</span> <span class="nc">LBRAC</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">separated_list</span><span class="p">(</span><span class="nc">COMMA</span><span class="o">,</span> <span class="n">term</span><span class="p">)</span> <span class="nc">RBRAC</span> <span class="p">{</span> <span class="nc">List</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div>
<p>オオッ､なんかインテリジェンスが高まっているな｡
<code>separated_list(SEP, RULE)</code>で<code>(RULE SEP)* RULE</code>みたいなものを発射してくれます｡
偉い｡</p>
<p>他にも偉い関数の数々</p>
<ul>
<li>
<p><code>option(X)</code></p>

<p>ルール<code>X</code>にマッチすれば<code>Some(Xが返す値)</code>を返し､なければ<code>None</code>を返す</p>
</li>
<li>
<p><code>list(X)</code></p>

<p><code>X*</code>みたいなやつ</p>
</li>
<li>
<p><code>nonempty_list(X)</code></p>

<p><code>X+</code></p>
</li>
<li>
<p><code>nonempty_separated_list(SEP, X)</code></p>

<p>はい</p>
</li>
</ul>
<h3 id="3-3-3.+user+defined+parameterized+rule"><a class="headerlink" href="#3-3-3.+user+defined+parameterized+rule">3-3-3. user defined parameterized rule</a></h3>
<p><code>separated_list</code>みたいなものをユーザーも定義できる｡最高｡</p>
<div class="highlight"><pre><code class="language-" data-lang="">%public xlist(X):
   | LBRAC lst = separated_list(COMMA, X) RBRAC { lst }
</code></pre></div>
<p>何かを詰め込んだリストがホラこんな簡単に! 作れるわけだ｡</p>
<h3 id="3-3-4.+%E4%BB%96"><a class="headerlink" href="#3-3-4.+%E4%BB%96">3-3-4. 他</a></h3>
<p><code>%start</code>と<code>%type</code>を一緒にかける</p>
<div class="highlight"><pre><code class="language-ocaml" data-lang="ocaml"><span class="o">%</span><span class="n">start</span> <span class="o">&lt;</span><span class="n">term</span><span class="o">&gt;</span> <span class="n">parse</span>
</code></pre></div>
<p>で､こんな感じに</p>
<p><a href="/src/menhir_example/parser2.mly">src/menhir_example/parser2.mly</a></p>
<div class="codeline with_caption"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div>
<div class="highlight">
<span class="listing-name">parser2.mly</span><pre><code class="language-ocaml" data-lang="ocaml"><span class="o">%</span><span class="p">{</span>
<span class="k">open</span> <span class="nc">Syntax</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%</span><span class="n">token</span> <span class="nc">LBRAC</span> <span class="nc">RBRAC</span> <span class="nc">LPAREN</span> <span class="nc">RPAREN</span> <span class="nc">BACKSLASH</span> <span class="nc">DOT</span> <span class="nc">COMMA</span>
<span class="o">%</span><span class="n">token</span> <span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span> <span class="nc">VAR</span>
<span class="o">%</span><span class="n">token</span> <span class="nc">EOF</span>

<span class="o">%</span><span class="n">start</span> <span class="n">parse</span>
<span class="o">%</span><span class="k">type</span> <span class="o">&lt;</span><span class="n">term</span><span class="o">&gt;</span> <span class="n">parse</span>
<span class="o">%%</span>

<span class="n">parse</span><span class="o">:</span> <span class="o">|</span> <span class="n">term</span> <span class="nc">EOF</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
<span class="n">term</span><span class="o">:</span>  <span class="o">|</span> <span class="n">lamb</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="nc">VAR</span> <span class="p">{</span> <span class="nc">Var</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">lst</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="n">app</span> <span class="p">{</span> <span class="o">$</span><span class="mi">1</span> <span class="p">}</span>
       <span class="o">|</span> <span class="nc">LPAREN</span> <span class="n">t</span> <span class="o">=</span> <span class="n">term</span> <span class="nc">RPAREN</span> <span class="p">{</span> <span class="n">t</span> <span class="p">}</span>
<span class="n">lamb</span><span class="o">:</span>  <span class="o">|</span> <span class="nc">BACKSLASH</span> <span class="n">x</span> <span class="o">=</span> <span class="nc">VAR</span> <span class="nc">DOT</span> <span class="n">t</span> <span class="o">=</span> <span class="n">term</span> <span class="p">{</span> <span class="nc">Lamb</span><span class="p">(</span><span class="n">x</span><span class="o">,</span> <span class="n">t</span><span class="p">)</span> <span class="p">}</span>
<span class="n">app</span><span class="o">:</span>   <span class="o">|</span> <span class="n">term</span> <span class="n">term</span> <span class="p">{</span> <span class="nc">App</span><span class="p">(</span><span class="o">$</span><span class="mi">1</span><span class="o">,</span> <span class="o">$</span><span class="mi">2</span><span class="p">)</span> <span class="p">}</span>
<span class="n">lst</span><span class="o">:</span>   <span class="o">|</span> <span class="nc">LBRAC</span> <span class="n">lst</span> <span class="o">=</span> <span class="n">separated_list</span><span class="p">(</span><span class="nc">COMMA</span><span class="o">,</span> <span class="n">term</span><span class="p">)</span> <span class="nc">RBRAC</span> <span class="p">{</span> <span class="nc">List</span> <span class="n">lst</span> <span class="p">}</span>
</code></pre>
</div>
<p>この言語ではあまり味が出ないですね…!!!</p>
<h3 id="3-3-5.+%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E9%81%94"><a class="headerlink" href="#3-3-5.+%E4%BE%BF%E5%88%A9%E3%81%AA%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E9%81%94">3-3-5. 便利なオプション達</a></h3>
<p>menhirはパーザーをジェネレートするだけでなく､デバッグ機能などもいい感じです｡
詳細はヘルプなどを見ていただくとして､数点ピッカップします｡</p>
<h4 id="interactive-mode">interactive mode</h4>
<div class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><span class="gp">$</span> menhir <span class="nt">--interpret</span> <span class="nt">--interpret-show-cst</span> <span class="nt">--interpret-error</span> parser2.mly
<span class="go">Warning: 2 states have shift/reduce conflicts.
Warning: 8 shift/reduce conflicts were arbitrarily resolved.
LPAREN BACKSLASH VAR DOT LBRAC VAR COMMA VAR RBRAC RPAREN LPAREN BACKSLASH VAR DOT VAR RPAREN
ACCEPT
[parse:
  [term:
    [app:
      [term:
        LPAREN
        [term:
          [lamb:
            BACKSLASH
            VAR
            DOT
            [term:
              [lst:
                LBRAC
                [loption(separated_nonempty_list(COMMA,term)):
                  [separated_nonempty_list(COMMA,term):
                    [term: VAR]
                    COMMA
                    [separated_nonempty_list(COMMA,term): [term: VAR]]
                  ]
                ]
                RBRAC
              ]
            ]
          ]
        ]
        RPAREN
      ]
      [term:
        LPAREN
        [term: [lamb: BACKSLASH VAR DOT [term: VAR]]]
        RPAREN
      ]
    ]
  ]
  EOF
]
VAR VAR
ACCEPT
[parse: [term: [app: [term: VAR] [term: VAR]]] EOF]
INVALIDTOKEN
File "(stdin)", line 3, characters 0-12:
Error: "INVALIDTOKEN" is not a known terminal symbol.
</span></code></pre></div>
<p>すげぇ! 対話的にトークン列を渡すと解析木を出してくれる､偉い｡</p>
<h4 id="graph">graph</h4>
<div class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><span class="gp">$</span> menhir <span class="nt">--graph</span> parser2.mly
<span class="gp">$</span> dot <span class="nt">-Tpng</span> parser2.dot <span class="o">&gt;</span> parser2.png
</code></pre></div>
<p><img src="/pictures/2017-12-03-Menhir%E3%81%8C%E4%BE%BF%E5%88%A9/menhir.png" alt="menhir.png"></p>
<p>ウオ〜縦長だがどういう感じなのかわかりますね! これは偉大</p>
<hr>
<p>他にもいろんなオプションがあります｡<code>menhir --help</code>しろ｡</p>
<h1 id="4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><a class="headerlink" href="#4.+%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">4. おわりに</a></h1>
<p>もう12月4日になっちゃったッピ〜〜!!!! というわけで解散してください｡</p>
<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p><a href="http://gallium.inria.fr/%7Efpottier/menhir/" target="_blank" rel="noopener noreferrer">http://gallium.inria.fr/~fpottier/menhir/</a> <a href="#fnref1" rev="footnote">↩</a></p>
</li>

</ol>
</div>
          </div>
        </article>

      </div>
    </div>
    <footer>
      <div class="pagination btn-group" style="text-align: center; font-family: 'Comfortaa';">
        <a class="btn prev" href="/2017/11/18/OCaml%E3%81%A7eval%E3%81%97%E3%81%A6%E7%B5%90%E6%9E%9C%E3%82%92string%E3%81%A7%E5%BE%97%E3%82%8B.html" title="OCamlでevalして結果をstringで得る">← Prev</a>
        /<a class="btn" href="/">Top</a>/
        <a class="btn next" href="/2017/12/21/LaTeX%E3%83%A9%E3%82%A4%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0.html" title="LaTeXライティング">Next →</a>
      </div>
    </footer>

  </body>
</html>
